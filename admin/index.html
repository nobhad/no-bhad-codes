<!doctype html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - No Bhad Codes</title>
    <style>
      /* Inline fallbacks before main CSS loads - uses design system variables */
      :root {
        --page-bg: var(--color-neutral-300, #e0e0e0);
        --page-fg: var(--color-dark, #333333);
      }
      [data-theme='dark'] {
        --page-bg: var(--portal-bg-darkest, #1a1a1a);
        --page-fg: var(--portal-text-light, #f5f5f5);
      }
      html,
      body {
        background-color: var(--page-bg);
        color: var(--page-fg);
        margin: 0;
        padding: 0;
      }
    </style>
    <script>
      (function () {
        try {
          const savedTheme = localStorage.getItem('theme');
          document.documentElement.setAttribute('data-theme', savedTheme || 'light');
        } catch (e) {
          document.documentElement.setAttribute('data-theme', 'light');
        }
      })();
      (function () {
        var el = document.documentElement;
        var params = new URLSearchParams(window.location.search);
        var w = params.get('wireframe');
        if (w === '1') {
          el.setAttribute('data-wireframe', 'true');
          try { localStorage.setItem('wireframe', '1'); } catch (e) {}
        } else if (w === '0') {
          el.removeAttribute('data-wireframe');
          try { localStorage.removeItem('wireframe'); } catch (e) {}
        } else {
          try {
            if (localStorage.getItem('wireframe') === '1') {
              el.setAttribute('data-wireframe', 'true');
            }
          } catch (e) {}
        }

        if (w === '1' || w === '0') {
          try {
            params.delete('wireframe');
            var newUrl = window.location.pathname;
            var query = params.toString();
            if (query) newUrl += '?' + query;
            if (window.location.hash) newUrl += window.location.hash;
            window.history.replaceState({}, '', newUrl);
          } catch (e) {}
        }
      })();
    </script>
    <meta name="description" content="Admin Dashboard - Manage your site, leads, and analytics" />
    <meta name="robots" content="noindex, nofollow" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="theme-color" content="#e0e0e0" />
    <script type="module" src="/src/admin.ts"></script>
  </head>
  <body data-page="admin">
    <!-- Skip to main content link for accessibility -->
    <a href="#admin-main" class="skip-link">Skip to main content</a>

    <!-- Header - Exact copy from main site, only visible on login page -->
    <header class="header admin-header">
      <div class="container is--full">
        <nav class="nav-row">
          <a href="/" aria-label="no bhad codes - Go to homepage" class="nav-logo-row"> no bhad codes </a>
          <div class="nav-row__right">
            <!-- CLIENT PORTAL BUTTON -->
            <button class="portal-button" aria-label="Client Portal Login" id="portal-trigger">
              <div class="icon-wrap">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <path d="M18 20a6 6 0 0 0-12 0"/><circle cx="12" cy="10" r="4"/><circle cx="12" cy="12" r="10"/>
                </svg>
              </div>
            </button>

            <button id="toggle-theme" class="theme-button" aria-label="Toggle dark/light theme">
              <div class="icon-wrap">
                <svg
                  class="theme-icon sun-icon"
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                  aria-hidden="true"
                >
                  <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2"></circle>
                  <path
                    d="M12 2V4M12 20V22M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
                    stroke="currentColor"
                    stroke-width="2"
                  ></path>
                </svg>
                <svg
                  class="theme-icon moon-icon"
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                  aria-hidden="true"
                >
                  <path d="M21 12.79A9 9 0 1 1 11.21 3A7 7 0 0 0 21 12.79z"></path>
                </svg>
              </div>
            </button>
            <button data-menu-toggle="" class="menu-button" aria-label="Toggle navigation menu" aria-expanded="false">
              <div class="icon-wrap">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="100%"
                  viewBox="0 0 16 16"
                  fill="none"
                  class="menu-button-icon"
                  aria-hidden="true"
                >
                  <path
                    d="M7.33333 16L7.33333 -3.2055e-07L8.66667 -3.78832e-07L8.66667 16L7.33333 16Z"
                    fill="currentColor"
                  ></path>
                  <path
                    d="M16 8.66667L-2.62269e-07 8.66667L-3.78832e-07 7.33333L16 7.33333L16 8.66667Z"
                    fill="currentColor"
                  ></path>
                  <path
                    d="M6 7.33333L7.33333 7.33333L7.33333 6C7.33333 6.73637 6.73638 7.33333 6 7.33333Z"
                    fill="currentColor"
                  ></path>
                  <path
                    d="M10 7.33333L8.66667 7.33333L8.66667 6C8.66667 6.73638 9.26362 7.33333 10 7.33333Z"
                    fill="currentColor"
                  ></path>
                  <path
                    d="M6 8.66667L7.33333 8.66667L7.33333 10C7.33333 9.26362 6.73638 8.66667 6 8.66667Z"
                    fill="currentColor"
                  ></path>
                  <path
                    d="M10 8.66667L8.66667 8.66667L8.66667 10C8.66667 9.26362 9.26362 8.66667 10 8.66667Z"
                    fill="currentColor"
                  ></path>
                </svg>
              </div>
              <div class="menu-button-text">
                <p class="p-large">Menu</p>
                <p class="p-large">Close</p>
              </div>
            </button>
          </div>
        </nav>
      </div>
    </header>

    <!-- MOBILE/OVERLAY NAVIGATION - Same as main site -->
    <nav data-nav="closed" class="nav admin-nav">
      <div data-menu-toggle="" class="overlay"></div>
      <div class="menu">
        <div class="menu-bg">
          <div class="bg-panel first"></div>
          <div class="bg-panel second"></div>
          <div class="bg-panel"></div>
        </div>
        <div class="menu-inner">
          <ul class="menu-list">
            <li class="menu-list-item">
              <a href="/" class="menu-link">
                <p class="menu-link-heading" data-text="home">home</p>
                <p class="eyebrow">00</p>
                <div class="menu-link-bg"></div>
              </a>
            </li>
            <li class="menu-list-item">
              <a href="/#/about" class="menu-link">
                <p class="menu-link-heading" data-text="about">about</p>
                <p class="eyebrow">01</p>
                <div class="menu-link-bg"></div>
              </a>
            </li>
            <li class="menu-list-item">
              <a href="/#/contact" class="menu-link">
                <p class="menu-link-heading" data-text="contact">contact</p>
                <p class="eyebrow">02</p>
                <div class="menu-link-bg"></div>
              </a>
            </li>
            <li class="menu-list-item">
              <a href="/#/projects" class="menu-link">
                <p class="menu-link-heading" data-text="projects">projects</p>
                <p class="eyebrow">03</p>
                <div class="menu-link-bg"></div>
              </a>
            </li>
          </ul>
          <div class="menu-details" data-menu-fade>
            <p class="p-small">Socials</p>
            <div class="socials-row">
              <a href="https://github.com/nobhad" target="_blank" rel="noopener noreferrer" class="p-large text-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="social-icon" aria-hidden="true">
                  <path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/>
                  <path d="M9 18c-4.51 2-5-2-7-2"/>
                </svg>
                GitHub
              </a>
              <a href="https://www.linkedin.com/in/noelle-b-676286106/" target="_blank" rel="noopener noreferrer" class="p-large text-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="social-icon" aria-hidden="true">
                  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/>
                  <rect width="4" height="12" x="2" y="9"/>
                  <circle cx="4" cy="4" r="2"/>
                </svg>
                LinkedIn
              </a>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- Auth Gate - Login Form -->
    <div class="auth-gate" id="auth-gate">
      <div class="auth-gate-container">
        <div class="auth-gate-header">
          <img src="/images/avatar.svg" alt="No Bhad Codes" class="auth-gate-logo" />
          <h1>Admin Access</h1>
          <p>Enter your admin password to continue</p>
        </div>
        <form class="auth-gate-form" id="admin-login-form">
          <!-- Hidden username field for accessibility and password managers -->
          <input
            type="email"
            id="admin-username"
            name="username"
            value="admin@nobhad.codes"
            autocomplete="username"
            tabindex="-1"
            aria-hidden="true"
            style="position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0;"
          />
          <div class="form-group">
            <label for="admin-password" class="sr-only">Admin Password</label>
            <div class="password-input-wrapper">
              <input
                type="password"
                id="admin-password"
                name="password"
                placeholder="Admin Password"
                required
                autocomplete="current-password"
              />
              <button type="button" class="password-toggle" id="password-toggle" aria-label="Toggle password visibility">
                <svg class="eye-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              </button>
            </div>
          </div>
          <div class="auth-error" id="auth-error"></div>
          <button type="submit" class="btn btn-primary auth-submit">
            <span class="btn-text">Sign In</span>
            <span class="btn-loading" style="display: none;">Signing in...</span>
          </button>
        </form>
      </div>
    </div>

    <script>
      // Toggle auth button state based on input
      document.addEventListener('DOMContentLoaded', function() {
        const passwordInput = document.getElementById('admin-password');
        const submitBtn = document.querySelector('.auth-submit');
        if (passwordInput && submitBtn) {
          passwordInput.addEventListener('input', function() {
            if (this.value.trim().length > 0) {
              submitBtn.classList.add('active');
            } else {
              submitBtn.classList.remove('active');
            }
          });
        }
      });
    </script>

    <!-- Dashboard Layout (same structure as client portal) -->
    <div class="dashboard-container hidden" id="admin-dashboard">

      <!-- Full-Width Global Header -->
      <header class="portal-global-header">
        <div class="portal-global-header-left">
          <a href="/" class="header-logo" aria-label="Go to homepage">NO BHAD CODES</a>
          <span class="header-separator"></span>
          <nav class="breadcrumb-nav header-breadcrumb-nav" aria-label="Breadcrumb">
            <ul id="breadcrumb-list" class="breadcrumb-list"></ul>
          </nav>
        </div>
        <div class="portal-global-header-right">
          <button id="header-toggle-theme" class="header-theme-toggle" aria-label="Toggle dark/light theme">
            <svg class="theme-icon sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2"></circle>
              <path d="M12 2V4M12 20V22M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2"></path>
            </svg>
            <svg class="theme-icon moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M21 12.79A9 9 0 1 1 11.21 3A7 7 0 0 0 21 12.79z"></path>
            </svg>
          </button>
        </div>
      </header>

      <!-- Portal Body: Sidebar + Content -->
      <div class="portal-body">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
          <!-- Collapsed state avatar link (hidden by global header) -->
          <a href="/" class="sidebar-collapsed-logo" aria-label="Go to home">
            <img src="/images/avatar_small_sidebar.svg" alt="No Bhad Codes" class="sidebar-collapsed-logo-img" />
          </a>
          <div class="sidebar-content">
            <!-- Logo (hidden by global header) -->
            <a href="/" class="sidebar-logo">
              <img src="/images/avatar.svg" alt="No Bhad Codes" class="sidebar-logo-img" />
            </a>

            <!-- Admin Navigation Buttons -->
            <div class="sidebar-buttons">
              <!-- Sidebar Toggle (first button) -->
              <button class="btn btn-secondary sidebar-toggle-btn" id="btn-sidebar-toggle" aria-label="Toggle sidebar">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="btn-icon" aria-hidden="true">
                  <rect x="3" y="3" width="7" height="18" rx="1"/>
                  <path d="M15 3h6a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1h-6"/>
                </svg>
                <span class="btn-text">TOGGLE</span>
              </button>
              <button class="btn btn-secondary active" id="btn-overview" data-tab="overview" aria-label="Dashboard">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="btn-icon"><path d="m12 14 4-4"/><path d="M3.34 19a10 10 0 1 1 17.32 0"/></svg>
              <span class="btn-text">DASHBOARD</span>
            </button>
            <button class="btn btn-secondary" id="btn-work" data-tab="work" aria-label="Work">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="btn-icon"><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/></svg>
              <span class="btn-text">WORK</span>
            </button>
            <button class="btn btn-secondary" id="btn-crm" data-tab="crm" aria-label="CRM">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="btn-icon"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
              <span class="btn-text">CRM</span>
              <span class="sidebar-badge" id="crm-badge" style="display: none;"></span>
            </button>
            <button class="btn btn-secondary" id="btn-documents" data-tab="documents" aria-label="Documents">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="btn-icon"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M16 13H8"/><path d="M16 17H8"/><path d="M10 9H8"/></svg>
              <span class="btn-text">DOCUMENTS</span>
            </button>
            <button class="btn btn-secondary" id="btn-workflows" data-tab="workflows" aria-label="Workflows">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="btn-icon"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>
              <span class="btn-text">WORKFLOWS</span>
            </button>
            <button class="btn btn-secondary" id="btn-analytics" data-tab="analytics" aria-label="Analytics">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="btn-icon"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
              <span class="btn-text">ANALYTICS</span>
            </button>
            <button class="btn btn-secondary" id="btn-support" data-tab="support" aria-label="Knowledge Base">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="btn-icon"><circle cx="12" cy="12" r="10"/><path d="M8.5 8.5a4 4 0 0 1 7 3c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
              <span class="btn-text">KNOWLEDGE BASE</span>
            </button>
            <button class="btn btn-secondary" id="btn-system" data-tab="system" aria-label="System Status">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="btn-icon"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v10"/><path d="m4.93 4.93 4.24 4.24m5.66 5.66 4.24 4.24"/><path d="M1 12h6m6 0h10"/><path d="m4.93 19.07 4.24-4.24m5.66-5.66 4.24-4.24"/></svg>
              <span class="btn-text">SYSTEM</span>
            </button>
          </div>

          <!-- Sign Out Button -->
          <div class="sidebar-footer">
            <button type="button" class="btn btn-secondary btn-logout" id="btn-logout" aria-label="Sign out">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="btn-icon"><path d="m16 17 5-5-5-5"/><path d="M21 12H9"/><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/></svg>
              <span class="btn-text">SIGN OUT</span>
            </button>
          </div>
        </div>
      </aside>

      <!-- Secondary Sidebar (shown for multi-tab detail pages) -->
      <aside id="secondary-sidebar">
        <!-- Populated dynamically by createSecondarySidebar() -->
      </aside>

      <!-- Horizontal Tabs Fallback (mobile, when secondary sidebar is hidden) -->
      <div id="secondary-tabs-horizontal">
        <!-- Populated dynamically by createSecondarySidebar() -->
      </div>

      <!-- Content Area -->
      <div class="dashboard-content" id="dashboard-content">
        <div class="content-wrapper">
          <!-- Portal Page Header - Title and subtabs only (breadcrumbs in global header) -->
          <header class="portal-page-header">
            <div class="portal-header-title">
              <h1 id="admin-page-title">Dashboard</h1>
              <!-- Header Subtabs (shown for Analytics and Workflows tabs) -->
              <div class="header-subtabs">
                <!-- Work subtabs -->
                <div class="portal-subtabs header-subtab-group" data-for-tab="work" data-mode="primary">
                  <button class="portal-subtab active" data-subtab="projects">Projects</button>
                  <button class="portal-subtab" data-subtab="tasks">Tasks</button>
                  <button class="portal-subtab" data-subtab="ad-hoc-requests">Requests</button>
                </div>
                <!-- CRM subtabs -->
                <div class="portal-subtabs header-subtab-group" data-for-tab="crm" data-mode="primary">
                  <button class="portal-subtab active" data-subtab="leads">Leads</button>
                  <button class="portal-subtab" data-subtab="contacts">Contacts</button>
                  <button class="portal-subtab" data-subtab="messages">Messages</button>
                  <button class="portal-subtab" data-subtab="clients">Clients</button>
                </div>
                <!-- Documents subtabs -->
                <div class="portal-subtabs header-subtab-group" data-for-tab="documents" data-mode="primary">
                  <button class="portal-subtab active" data-subtab="invoices">Invoices</button>
                  <button class="portal-subtab" data-subtab="contracts">Contracts</button>
                  <button class="portal-subtab" data-subtab="document-requests">Document Requests</button>
                  <button class="portal-subtab" data-subtab="questionnaires">Questionnaires</button>
                </div>
                <!-- Support subtabs - removed, using view toggle instead -->
                <!-- Analytics subtabs -->
                <div class="analytics-subtabs header-subtab-group" data-for-tab="analytics">
                  <button type="button" class="analytics-subtab active" data-subtab="overview">Overview</button>
                  <button type="button" class="analytics-subtab" data-subtab="business">Business</button>
                  <button type="button" class="analytics-subtab" data-subtab="visitors">Visitors</button>
                  <button type="button" class="analytics-subtab" data-subtab="reports">Reports & Alerts</button>
                </div>
                <!-- Workflows subtabs -->
                <div class="portal-subtabs header-subtab-group" data-for-tab="workflows" id="workflows-subtabs">
                  <button class="portal-subtab active" data-subtab="approvals">Approvals</button>
                  <button class="portal-subtab" data-subtab="triggers">Triggers</button>
                  <button class="portal-subtab" data-subtab="email-templates">Email Templates</button>
                </div>
                <!-- Knowledge Base view toggle -->
                <div class="header-controls header-subtab-group" data-for-tab="knowledge-base">
                  <div id="kb-section-toggle-mount"></div>
                </div>
              </div>
            </div>
          </header>
          <!-- Overview Tab (Default) -->
          <div class="tab-content active" id="tab-overview">
            <!-- NEEDS ATTENTION (Urgent/Actionable Items) -->
            <h3 class="sr-only">Needs Attention</h3>
            <div class="attention-grid" aria-live="polite" aria-atomic="false">
              <button
                class="stat-card stat-card-clickable"
                data-tab="invoices"
                data-filter="overdue"
                type="button"
                id="attention-overdue-invoices"
              >
                <span class="stat-card-icon" aria-hidden="true">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                </span>
                <span class="stat-number" id="stat-overdue-invoices">-</span>
                <span class="stat-label">Overdue Invoices</span>
              </button>
              <button
                class="stat-card stat-card-clickable"
                data-tab="projects"
                data-filter="pending_contract"
                type="button"
                id="attention-pending-contracts"
              >
                <span class="stat-card-icon" aria-hidden="true">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="m9 15 2 2 4-4"/></svg>
                </span>
                <span class="stat-number" id="stat-pending-contracts">-</span>
                <span class="stat-label">Pending Contracts</span>
              </button>
              <button
                class="stat-card stat-card-clickable"
                data-tab="leads"
                data-filter="new_this_week"
                type="button"
                id="attention-new-leads"
              >
                <span class="stat-card-icon" aria-hidden="true">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg>
                </span>
                <span class="stat-number" id="stat-new-leads">-</span>
                <span class="stat-label">New Leads This Week</span>
              </button>
              <button
                class="stat-card stat-card-clickable"
                data-tab="messages"
                data-filter="unread"
                type="button"
                id="attention-unread-messages"
              >
                <span class="stat-card-icon" aria-hidden="true">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                </span>
                <span class="stat-number" id="stat-unread-messages">-</span>
                <span class="stat-label">Unread Messages</span>
              </button>
            </div>

            <!-- TODAY'S SNAPSHOT (At-a-Glance Business Metrics) -->
            <h3 class="sr-only">Today's Snapshot</h3>
            <div class="quick-stats" aria-live="polite" aria-atomic="false">
              <button
                class="stat-card stat-card-clickable"
                data-tab="projects"
                type="button"
              >
                <span class="stat-number" id="stat-active-projects">-</span>
                <span class="stat-label">Active Projects</span>
              </button>
              <button
                class="stat-card stat-card-clickable"
                data-tab="clients"
                type="button"
              >
                <span class="stat-number" id="stat-total-clients">-</span>
                <span class="stat-label">Clients</span>
              </button>
              <button
                class="stat-card stat-card-clickable"
                data-tab="invoices"
                type="button"
              >
                <span class="stat-number" id="stat-revenue-mtd">-</span>
                <span class="stat-label">Revenue MTD</span>
              </button>
              <button
                class="stat-card stat-card-clickable"
                data-tab="leads"
                type="button"
              >
                <span class="stat-number" id="stat-conversion-rate">-</span>
                <span class="stat-label">Conversion Rate</span>
              </button>
            </div>

            <!-- UPCOMING TASKS -->
            <div class="upcoming-tasks portal-shadow">
              <div class="section-header-inline">
                <h3>Upcoming Tasks</h3>
                <div class="section-header-actions">
                  <div id="dashboard-tasks-view-toggle-mount"></div>
                  <button type="button" class="btn btn-secondary btn-sm" data-tab="tasks" id="view-all-tasks-btn">
                    View All
                  </button>
                </div>
              </div>
              <div id="dashboard-tasks-kanban-container" class="dashboard-tasks-kanban" style="display: none;"></div>
              <div id="dashboard-tasks-list-container" class="dashboard-tasks-list">
                <ul id="upcoming-tasks-list" class="upcoming-tasks-list" aria-live="polite">
                  <li class="loading-row">Loading tasks...</li>
                </ul>
              </div>
            </div>

            <!-- RECENT ACTIVITY -->
            <div class="recent-activity portal-shadow">
              <h3>Recent Activity</h3>
              <ul class="activity-list" id="recent-activity-list" aria-live="polite" aria-atomic="false">
                <li>Loading...</li>
              </ul>
            </div>
          </div>

          <!-- Leads Tab -->
          <div class="tab-content" id="tab-leads">
            <!-- Leads Stats -->
            <div class="quick-stats">
              <button class="stat-card stat-card-clickable portal-shadow" data-filter="all" data-table="leads">
                <span class="stat-number" id="leads-total">-</span>
                <span class="stat-label">Total Leads</span>
              </button>
              <button class="stat-card stat-card-clickable portal-shadow" data-filter="pending" data-table="leads">
                <span class="stat-number" id="leads-pending">-</span>
                <span class="stat-label">Pending</span>
              </button>
              <button class="stat-card stat-card-clickable portal-shadow" data-filter="in_progress" data-table="leads">
                <span class="stat-number" id="leads-active">-</span>
                <span class="stat-label">In Progress</span>
              </button>
              <button class="stat-card stat-card-clickable portal-shadow" data-filter="completed" data-table="leads">
                <span class="stat-number" id="leads-completed">-</span>
                <span class="stat-label">Completed</span>
              </button>
            </div>

            <!-- Leads Table -->
            <div class="admin-table-card" id="intake-submissions-card">
              <div class="admin-table-header">
                <h3><span class="title-full">Intake Submissions</span><span class="title-mobile">Leads</span></h3>
                <div class="admin-table-actions" id="leads-filter-container">
                  <div id="leads-view-toggle"></div>
                  <button class="icon-btn" id="export-leads-btn" title="Export to CSV" aria-label="Export leads to CSV">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                  </button>
                  <button class="icon-btn" id="refresh-leads-btn" title="Refresh" aria-label="Refresh leads">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
                  </button>
                </div>
              </div>
              <!-- Bulk Action Toolbar (hidden initially) -->
              <div id="leads-bulk-toolbar" class="bulk-action-toolbar hidden"></div>
              <!-- Pipeline View Container -->
              <div class="leads-pipeline-container hidden" id="leads-pipeline-container"></div>
              <!-- Table View -->
              <div class="admin-table-container leads-table-container" id="leads-table-view">
                <div class="admin-table-scroll-wrapper">
                <table class="admin-table leads-table">
                  <thead>
                    <tr>
                      <th scope="col" class="bulk-select-cell">
                        <div class="portal-checkbox">
                          <input type="checkbox" id="leads-select-all" class="bulk-select-all" aria-label="Select all leads" />
                        </div>
                      </th>
                      <th scope="col">Lead</th>
                      <th scope="col" class="type-col">Type</th>
                      <th scope="col" class="status-col">Status</th>
                      <th scope="col" class="budget-col">Budget</th>
                      <th scope="col" class="date-col">Date</th>
                      <th scope="col" class="actions-col">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="leads-table-body" aria-live="polite" aria-atomic="false" aria-relevant="additions removals">
                    <tr>
                      <td colspan="7" class="loading-row">Loading leads...</td>
                    </tr>
                  </tbody>
                </table>
                </div>
              </div>
              <!-- Pagination -->
              <div id="leads-pagination" class="table-pagination"></div>
            </div>

            
          </div>

          <!-- Contacts Tab -->
          <div class="tab-content" id="tab-contacts">
            <div class="admin-table-card" id="contact-submissions-card">
              <div class="admin-table-header">
                <h3><span class="title-full">Contact Form Submissions</span><span class="title-mobile">Contacts</span></h3>
                <div class="admin-table-actions" id="contacts-filter-container">
                  <button class="icon-btn" id="export-contacts-btn" title="Export to CSV" aria-label="Export contact submissions to CSV">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                  </button>
                  <button class="icon-btn" id="refresh-contacts-btn" title="Refresh" aria-label="Refresh contact submissions">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
                  </button>
                </div>
              </div>
              <div id="contacts-bulk-toolbar" class="bulk-action-toolbar hidden"></div>
              <div class="admin-table-container contacts-table-container">
                <div class="admin-table-scroll-wrapper">
                <table class="admin-table contacts-table">
                  <thead>
                    <tr>
                      <th scope="col" class="bulk-select-cell">
                        <div class="portal-checkbox">
                          <input type="checkbox" id="contacts-select-all" class="bulk-select-all" aria-label="Select all contacts" />
                        </div>
                      </th>
                      <th scope="col" class="contact-col">Contact</th>
                      <th scope="col" class="email-col">Email</th>
                      <th scope="col">Message</th>
                      <th scope="col" class="status-col">Status</th>
                      <th scope="col" class="date-col">Date</th>
                      <th scope="col" class="actions-col">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="contacts-table-body" aria-live="polite" aria-atomic="false" aria-relevant="additions removals">
                    <tr>
                      <td colspan="7" class="loading-row">Loading contact submissions...</td>
                    </tr>
                  </tbody>
                </table>
                </div>
              </div>
              <div id="contacts-pagination" class="table-pagination"></div>
            </div>
          </div>

          <!-- Projects Tab -->
          <div class="tab-content" id="tab-projects">
            <!-- Projects Stats -->
            <div class="quick-stats">
              <button class="stat-card stat-card-clickable portal-shadow" data-filter="all" data-table="projects">
                <span class="stat-number" id="projects-total">-</span>
                <span class="stat-label">Total Projects</span>
              </button>
              <button class="stat-card stat-card-clickable portal-shadow" data-filter="active" data-table="projects">
                <span class="stat-number" id="projects-active">-</span>
                <span class="stat-label">Active</span>
              </button>
              <button class="stat-card stat-card-clickable portal-shadow" data-filter="completed" data-table="projects">
                <span class="stat-number" id="projects-completed">-</span>
                <span class="stat-label">Completed</span>
              </button>
              <button class="stat-card stat-card-clickable portal-shadow" data-filter="on_hold" data-table="projects">
                <span class="stat-number" id="projects-on-hold">-</span>
                <span class="stat-label">On Hold</span>
              </button>
            </div>

            <!-- Projects Table -->
            <div class="admin-table-card" id="projects-card">
              <div class="admin-table-header">
                <h3>Projects</h3>
                <div class="admin-table-actions" id="projects-filter-container">
                  <button class="icon-btn" id="export-projects-btn" title="Export to CSV" aria-label="Export projects to CSV">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                  </button>
                  <button class="icon-btn" id="refresh-projects-btn" title="Refresh" aria-label="Refresh projects">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
                  </button>
                  <button class="icon-btn" id="add-project-btn" title="Add Project" aria-label="Add project">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14"/><path d="M5 12h14"/></svg>
                  </button>
                </div>
              </div>
              <!-- Bulk Action Toolbar (hidden initially) -->
              <div id="projects-bulk-toolbar" class="bulk-action-toolbar hidden"></div>
              <div class="admin-table-container projects-table-container">
                <div class="admin-table-scroll-wrapper">
                <table class="admin-table projects-table">
                  <thead>
                    <tr>
                      <th scope="col" class="bulk-select-cell">
                        <div class="portal-checkbox">
                          <input type="checkbox" id="projects-select-all" class="bulk-select-all" aria-label="Select all projects" />
                        </div>
                      </th>
                      <th scope="col">Project</th>
                      <th scope="col" class="type-col">Type</th>
                      <th scope="col" class="status-col">Status</th>
                      <th scope="col" class="budget-col">Budget</th>
                      <th scope="col" class="timeline-col">Timeline</th>
                      <th scope="col" class="date-col start-col">Start</th>
                      <th scope="col" class="date-col target-col">Target</th>
                      <th scope="col" class="actions-col">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="projects-table-body" aria-live="polite" aria-atomic="false" aria-relevant="additions removals">
                    <tr>
                      <td colspan="9" class="loading-row">Loading projects...</td>
                    </tr>
                  </tbody>
                </table>
                </div>
              </div>
              <!-- Pagination -->
              <div id="projects-pagination" class="table-pagination"></div>
            </div>
          </div>

          <!-- Clients Tab -->
          <div class="tab-content" id="tab-clients">
            <!-- Clients Stats -->
            <div class="quick-stats">
              <button class="stat-card stat-card-clickable portal-shadow" data-filter="all" data-table="clients">
                <span class="stat-number" id="clients-total">-</span>
                <span class="stat-label">Total Clients</span>
              </button>
              <button class="stat-card stat-card-clickable portal-shadow" data-filter="active" data-table="clients">
                <span class="stat-number" id="clients-active">-</span>
                <span class="stat-label">Active</span>
              </button>
              <button class="stat-card stat-card-clickable portal-shadow" data-filter="pending" data-table="clients">
                <span class="stat-number" id="clients-pending">-</span>
                <span class="stat-label">Pending</span>
              </button>
              <button class="stat-card stat-card-clickable portal-shadow" data-filter="inactive" data-table="clients">
                <span class="stat-number" id="clients-inactive">-</span>
                <span class="stat-label">Inactive</span>
              </button>
            </div>

            <!-- Clients Table -->
            <div class="admin-table-card" id="clients-table-card">
              <div class="admin-table-header">
                <h3><span class="title-full">Client Accounts</span><span class="title-mobile">Clients</span></h3>
                <div class="admin-table-actions" id="clients-filter-container">
                  <button class="icon-btn" id="export-clients-btn" title="Export to CSV" aria-label="Export clients to CSV">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                  </button>
                  <button class="icon-btn" id="refresh-clients-btn" title="Refresh" aria-label="Refresh clients">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
                  </button>
                  <button class="icon-btn" id="add-client-btn" title="Add Client" aria-label="Add client">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" x2="19" y1="8" y2="14"/><line x1="22" x2="16" y1="11" y2="11"/></svg>
                  </button>
                </div>
              </div>
              <!-- Bulk Action Toolbar (hidden initially) -->
              <div id="clients-bulk-toolbar" class="bulk-action-toolbar hidden"></div>
              <div class="admin-table-container clients-table-container">
                <div class="admin-table-scroll-wrapper">
                <table class="admin-table clients-table">
                  <thead>
                    <tr>
                      <th scope="col" class="bulk-select-cell">
                        <div class="portal-checkbox">
                          <input type="checkbox" id="clients-select-all" class="bulk-select-all" aria-label="Select all clients" />
                        </div>
                      </th>
                      <th scope="col" class="contact-col">Client</th>
                      <th scope="col" class="type-col">Type</th>
                      <th scope="col" class="status-col">Status</th>
                      <th scope="col" class="count-col" title="Projects">#</th>
                      <th scope="col" class="date-col created-col">Created</th>
                      <th scope="col" class="date-col last-active-col">Last Active</th>
                      <th scope="col" class="actions-col">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="clients-table-body" aria-live="polite" aria-atomic="false" aria-relevant="additions removals">
                    <tr>
                      <td colspan="8" class="loading-row">Loading clients...</td>
                    </tr>
                  </tbody>
                </table>
                </div>
              </div>
              <!-- Pagination -->
              <div id="clients-pagination" class="table-pagination"></div>
            </div>
          </div>

          <!-- Invoices Tab -->
          <div class="tab-content" id="tab-invoices">
            <!-- Invoice Stats -->
            <div class="quick-stats">
              <button class="stat-card stat-card-clickable portal-shadow" data-filter="all" data-table="invoices">
                <span class="stat-number" id="invoices-total">-</span>
                <span class="stat-label">Total Invoices</span>
              </button>
              <button class="stat-card stat-card-clickable portal-shadow" data-filter="pending" data-table="invoices">
                <span class="stat-number" id="invoices-pending">-</span>
                <span class="stat-label">Pending</span>
              </button>
              <button class="stat-card stat-card-clickable portal-shadow" data-filter="paid" data-table="invoices">
                <span class="stat-number" id="invoices-paid">-</span>
                <span class="stat-label">Paid</span>
              </button>
              <button class="stat-card stat-card-clickable portal-shadow" data-filter="overdue" data-table="invoices">
                <span class="stat-number" id="invoices-overdue">-</span>
                <span class="stat-label">Overdue</span>
              </button>
            </div>

            <!-- Invoices Table -->
            <div class="admin-table-card" id="invoices-table-card">
              <div class="admin-table-header">
                <h3><span class="title-full">All Invoices</span><span class="title-mobile">Invoices</span></h3>
                <div class="admin-table-actions" id="invoices-filter-container">
                  <button class="icon-btn" id="export-invoices-btn" title="Export to CSV" aria-label="Export invoices to CSV">
                    <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg></span>
                  </button>
                  <button class="icon-btn" id="refresh-invoices-btn" title="Refresh" aria-label="Refresh invoices">
                    <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg></span>
                  </button>
                  <button class="icon-btn" id="create-invoice-btn" title="Add Invoice" aria-label="Add new invoice">
                    <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"/></svg></span>
                  </button>
                </div>
              </div>
              <!-- Bulk Action Toolbar (hidden initially) -->
              <div id="invoices-bulk-toolbar" class="bulk-action-toolbar hidden"></div>
              <div class="admin-table-container invoices-table-container">
                <div class="admin-table-scroll-wrapper">
                  <table class="admin-table invoices-table">
                    <thead>
                      <tr>
                        <th scope="col" class="bulk-select-cell">
                          <div class="portal-checkbox">
                            <input type="checkbox" id="invoices-select-all" class="bulk-select-all" aria-label="Select all invoices" />
                          </div>
                        </th>
                        <th scope="col">Invoice #</th>
                        <th scope="col" class="contact-col">Client</th>
                        <th scope="col">Project</th>
                        <th scope="col" class="budget-col">Amount</th>
                        <th scope="col" class="status-col">Status</th>
                        <th scope="col" class="date-col">Due Date</th>
                        <th scope="col" class="actions-col">Actions</th>
                      </tr>
                    </thead>
                    <tbody id="invoices-table-body" aria-live="polite" aria-atomic="false" aria-relevant="additions removals">
                      <tr>
                        <td colspan="8" class="loading-row">Loading invoices...</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <!-- Pagination -->
              <div id="invoices-pagination" class="table-pagination"></div>
            </div>
          </div>

          <!-- Contracts Tab -->
          <div class="tab-content" id="tab-contracts">
            <div class="quick-stats">
              <button class="stat-card stat-card-clickable portal-shadow" data-contract-filter="all">
                <span class="stat-number" id="contracts-total">-</span>
                <span class="stat-label">Total Contracts</span>
              </button>
              <button class="stat-card stat-card-clickable portal-shadow" data-contract-filter="draft">
                <span class="stat-number" id="contracts-draft">-</span>
                <span class="stat-label">Draft</span>
              </button>
              <button class="stat-card stat-card-clickable portal-shadow" data-contract-filter="sent">
                <span class="stat-number" id="contracts-sent">-</span>
                <span class="stat-label">Sent</span>
              </button>
              <button class="stat-card stat-card-clickable portal-shadow" data-contract-filter="viewed">
                <span class="stat-number" id="contracts-viewed">-</span>
                <span class="stat-label">Viewed</span>
              </button>
              <button class="stat-card stat-card-clickable portal-shadow" data-contract-filter="signed">
                <span class="stat-number" id="contracts-signed">-</span>
                <span class="stat-label">Signed</span>
              </button>
            </div>

            <div class="admin-table-card" id="contracts-table-card">
              <div class="admin-table-header">
                <h3>Contracts</h3>
                <div class="admin-table-actions" id="contracts-filter-container">
                  <button class="icon-btn" id="refresh-contracts-btn" title="Refresh" aria-label="Refresh contracts">
                    <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg></span>
                  </button>
                </div>
              </div>
              <div class="admin-table-container contracts-table-container">
                <div class="admin-table-scroll-wrapper">
                  <table class="admin-table contracts-table">
                    <thead>
                      <tr>
                        <th scope="col">Contract</th>
                        <th scope="col">Project</th>
                        <th scope="col" class="contact-col">Client</th>
                        <th scope="col" class="status-col">Status</th>
                        <th scope="col" class="date-col">Sent</th>
                        <th scope="col" class="date-col">Signed</th>
                        <th scope="col" class="date-col">Expires</th>
                        <th scope="col" class="actions-col">Actions</th>
                      </tr>
                    </thead>
                    <tbody id="contracts-table-body" aria-live="polite" aria-atomic="false" aria-relevant="additions removals">
                      <tr>
                        <td colspan="8" class="loading-row">Loading contracts...</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div id="contracts-pagination" class="table-pagination"></div>
            </div>

            <!-- Ad Hoc Requests Tab -->
            <div class="tab-content" id="tab-ad-hoc-requests">
              <div class="admin-table-card" id="ad-hoc-requests-table-card">
                <div class="admin-table-header">
                  <h3>Ad Hoc Requests</h3>
                  <div class="admin-table-actions" id="ad-hoc-requests-filter-container">
                    <button class="icon-btn" id="refresh-ad-hoc-requests-btn" title="Refresh" aria-label="Refresh ad hoc requests">
                      <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg></span>
                    </button>
                  </div>
                </div>
                <div class="admin-table-container ad-hoc-requests-table-container">
                  <div class="admin-table-scroll-wrapper">
                    <table class="admin-table ad-hoc-requests-table">
                      <thead>
                        <tr>
                          <th scope="col">Request</th>
                          <th scope="col" class="contact-col">Client</th>
                          <th scope="col">Project</th>
                          <th scope="col">Priority</th>
                          <th scope="col" class="status-col">Status</th>
                          <th scope="col" class="date-col">Submitted</th>
                          <th scope="col" class="actions-col">Actions</th>
                        </tr>
                      </thead>
                      <tbody id="ad-hoc-requests-table-body" aria-live="polite" aria-atomic="false" aria-relevant="additions removals">
                        <tr>
                          <td colspan="7" class="loading-row">Loading requests...</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div id="ad-hoc-requests-pagination" class="table-pagination"></div>
              </div>
            </div>
          </div>

          <!-- Tasks Tab (Global) -->
          <div class="tab-content" id="tab-tasks">
            <div class="admin-table-card portal-shadow tasks-main-container" id="global-tasks-card">
              <div class="admin-table-header">
                <h3>All Tasks</h3>
                <div class="admin-table-actions">
                  <div id="global-tasks-view-toggle-mount"></div>
                  <button class="icon-btn" id="refresh-global-tasks-btn" title="Refresh" aria-label="Refresh tasks">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
                  </button>
                </div>
              </div>
              <div id="global-tasks-kanban-container"></div>
              <div id="global-tasks-list-container" style="display: none;"></div>
            </div>
          </div>

          <!-- Client Detail View -->
          <div class="tab-content" id="tab-client-detail">
            <!-- Client Header Card -->
            <div class="portal-project-card portal-shadow cd-header-card">
              <div class="cd-header-top">
                <div class="cd-header-info">
                  <div class="detail-title-row">
                    <div class="detail-title-group">
                      <h2 class="detail-title" id="cd-client-name">Client Name</h2>
                      <span class="status-badge" id="cd-status-badge">Active</span>
                    </div>
                    <div class="detail-actions">
                      <!-- Quick Action Buttons -->
                      <button class="icon-btn" id="cd-btn-send-invite" title="Send Invitation" aria-label="Send invitation to client">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg>
                      </button>
                      <button class="icon-btn" id="cd-btn-edit" title="Edit Client" aria-label="Edit client details">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                      </button>
                      <!-- More Menu -->
                      <div class="table-dropdown detail-more-menu" id="cd-more-menu">
                        <button class="custom-dropdown-trigger" aria-label="More actions">
                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>
                        </button>
                        <ul class="custom-dropdown-menu">
                          <li class="custom-dropdown-item" data-action="resend-invite">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg>
                            Resend Invitation
                          </li>
                          <li class="custom-dropdown-item" data-action="reset-password">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                            Reset Password
                          </li>
                          <li class="custom-dropdown-item" data-action="archive">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="4" width="20" height="5" rx="1"/><path d="M4 9v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9"/><path d="M10 13h4"/></svg>
                            Archive Client
                          </li>
                          <li class="dropdown-divider"></li>
                          <li class="custom-dropdown-item danger" data-action="delete">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                            Delete Client
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <!-- Contact Info in Header -->
                  <div class="cd-header-contact">
                    <div class="cd-contact-item">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
                      <span id="cd-email">-</span>
                    </div>
                    <div class="cd-contact-item">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
                      <span id="cd-phone">-</span>
                    </div>
                    <div class="cd-contact-item">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/></svg>
                      <span id="cd-company">-</span>
                    </div>
                  </div>
                  <!-- Account Details in Header -->
                  <div class="cd-header-account">
                    <div class="cd-account-item">
                      <span class="cd-account-label">Type</span>
                      <span class="cd-account-value" id="cd-client-type">-</span>
                    </div>
                    <div class="cd-account-item">
                      <span class="cd-account-label">Since</span>
                      <span class="cd-account-value" id="cd-created">-</span>
                    </div>
                    <div class="cd-account-item">
                      <span class="cd-account-label">Last Login</span>
                      <span class="cd-account-value" id="cd-last-login">-</span>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Tags in header card -->
              <div id="cd-header-tags" class="cd-header-tags"></div>
            </div>

            <!-- Client Detail Tabs -->
            <div class="client-detail-tabs portal-tabs" id="client-detail-tabs">
              <button class="active" data-cd-tab="overview">Overview</button>
              <button data-cd-tab="contacts">Contacts</button>
              <button data-cd-tab="activity">Activity</button>
              <button data-cd-tab="projects">Projects</button>
              <button data-cd-tab="invoices">Invoices</button>
              <button data-cd-tab="notes">Notes</button>
            </div>

            <!-- Overview Tab - Two Column Layout -->
            <div class="client-detail-tab-content portal-tab-panel active" id="cd-tab-overview">
              <div class="cd-overview-grid">
                <!-- LEFT COLUMN -->
                <div class="cd-overview-main">
                  <!-- Projects Summary -->
                  <div class="portal-project-card portal-shadow">
                    <div class="card-header-with-action">
                      <h3>Projects</h3>
                      <button class="btn btn-sm btn-secondary" data-action="view-projects">View All</button>
                    </div>
                    <div class="cd-projects-summary" id="cd-overview-projects">
                      <p class="empty-state">Loading...</p>
                    </div>
                  </div>

                  <!-- CRM Details -->
                  <div class="portal-project-card portal-shadow">
                    <h3>CRM Details</h3>
                    <div class="cd-contact-grid">
                      <div class="meta-item">
                        <span class="field-label">Industry</span>
                        <span class="meta-value" id="cd-crm-industry">-</span>
                      </div>
                      <div class="meta-item">
                        <span class="field-label">Company Size</span>
                        <span class="meta-value" id="cd-crm-company-size">-</span>
                      </div>
                      <div class="meta-item">
                        <span class="field-label">Acquisition Source</span>
                        <span class="meta-value" id="cd-crm-acquisition-source">-</span>
                      </div>
                      <div class="meta-item">
                        <span class="field-label">Website</span>
                        <span class="meta-value" id="cd-crm-website">-</span>
                      </div>
                      <div class="meta-item">
                        <span class="field-label">Last Contact</span>
                        <span class="meta-value" id="cd-crm-last-contact">-</span>
                      </div>
                      <div class="meta-item">
                        <span class="field-label">Next Follow-up</span>
                        <span class="meta-value" id="cd-crm-next-followup">-</span>
                      </div>
                    </div>
                  </div>

                  <!-- Custom Fields (hidden when empty) -->
                  <div class="portal-project-card portal-shadow" id="cd-custom-fields-card" style="display: none;">
                    <h3>Custom Fields</h3>
                    <div id="cd-custom-fields-container"></div>
                  </div>
                </div>

                <!-- RIGHT COLUMN (Sidebar) -->
                <div class="cd-overview-sidebar">
                  <!-- Health & Stats Combined -->
                  <div class="portal-project-card portal-shadow cd-health-stats-card">
                    <h3>Client Health</h3>
                    <div id="cd-health-score-container">
                      <p class="empty-state">Loading...</p>
                    </div>
                    <div class="cd-stats-compact" id="cd-stats-container">
                      <!-- Stats rendered by JS -->
                    </div>
                  </div>
                </div>

                <!-- Recent Activity - Full Width spanning both columns -->
                <div class="portal-project-card portal-shadow cd-recent-activity-full">
                  <h3>Recent Activity</h3>
                  <div id="cd-recent-activity">
                    <p class="empty-state">Loading...</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Contacts Tab -->
            <div class="client-detail-tab-content portal-tab-panel" id="cd-tab-contacts">
              <div class="portal-project-card portal-shadow">
                <h3>Contacts</h3>
                <div id="cd-contacts-list">
                  <p class="empty-state">Loading contacts...</p>
                </div>
              </div>
            </div>

            <!-- Activity Tab -->
            <div class="client-detail-tab-content portal-tab-panel" id="cd-tab-activity">
              <div class="portal-project-card portal-shadow">
                <h3>Activity Timeline</h3>
                <div id="cd-activity-list">
                  <p class="empty-state">Loading activity...</p>
                </div>
              </div>
            </div>

            <!-- Projects Tab -->
            <div class="client-detail-tab-content portal-tab-panel" id="cd-tab-projects">
              <div class="portal-project-card portal-shadow">
                <h3>Projects</h3>
                <div class="client-projects-list" id="cd-projects-list">
                  <p class="empty-state">No projects found for this client.</p>
                </div>
              </div>
            </div>

            <!-- Invoices Tab -->
            <div class="client-detail-tab-content portal-tab-panel" id="cd-tab-invoices">
              <!-- Billing Summary -->
              <div class="portal-project-card portal-shadow">
                <h3>Billing Summary</h3>
                <div class="billing-summary">
                  <div class="meta-item">
                    <span class="field-label">Total Invoiced</span>
                    <span class="meta-value" id="cd-total-invoiced">$0.00</span>
                  </div>
                  <div class="meta-item">
                    <span class="field-label">Total Paid</span>
                    <span class="meta-value" id="cd-total-paid">$0.00</span>
                  </div>
                  <div class="meta-item">
                    <span class="field-label">Outstanding</span>
                    <span class="meta-value" id="cd-outstanding">$0.00</span>
                  </div>
                </div>
              </div>
              <!-- Billing Address -->
              <div class="portal-project-card portal-shadow">
                <div class="card-header-with-action">
                  <h3>Billing Address</h3>
                  <button class="icon-btn" id="cd-btn-edit-billing-invoices" title="Edit Billing Details" aria-label="Edit billing details">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                  </button>
                </div>
                <div class="billing-info-grid">
                  <div class="meta-item">
                    <span class="field-label">Name</span>
                    <span class="meta-value" id="cd-billing-name-full">-</span>
                  </div>
                  <div class="meta-item">
                    <span class="field-label">Email</span>
                    <span class="meta-value" id="cd-billing-email-full">-</span>
                  </div>
                  <div class="meta-item">
                    <span class="field-label">Address</span>
                    <span class="meta-value" id="cd-billing-address">-</span>
                  </div>
                  <div class="meta-item">
                    <span class="field-label">City</span>
                    <span class="meta-value" id="cd-billing-city">-</span>
                  </div>
                  <div class="meta-item">
                    <span class="field-label">State/Province</span>
                    <span class="meta-value" id="cd-billing-state">-</span>
                  </div>
                  <div class="meta-item">
                    <span class="field-label">ZIP/Postal Code</span>
                    <span class="meta-value" id="cd-billing-zip">-</span>
                  </div>
                  <div class="meta-item">
                    <span class="field-label">Country</span>
                    <span class="meta-value" id="cd-billing-country">-</span>
                  </div>
                </div>
              </div>
              <!-- Invoice List -->
              <div class="portal-project-card portal-shadow">
                <h3>Invoice History</h3>
                <div class="client-invoices-list" id="cd-invoices-list">
                  <p class="empty-state">No invoices found for this client.</p>
                </div>
              </div>
            </div>

            <!-- Notes Tab -->
            <div class="client-detail-tab-content portal-tab-panel" id="cd-tab-notes">
              <div class="portal-project-card portal-shadow">
                <h3>Notes</h3>
                <div id="cd-notes-list">
                  <p class="empty-state">Loading notes...</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Messages Tab -->
          <div class="tab-content" id="tab-messages">
            <!-- Messages Layout - Split View -->
            <div class="messages-layout portal-shadow">
              <!-- Full-width Search Bar -->
              <div class="messages-global-search">
                <div class="search-bar">
                  <span class="search-bar-icon" aria-hidden="true">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                  </span>
                  <input type="text" id="messages-search-input" class="search-bar-input" placeholder="Search clients and messages..." aria-label="Search clients and messages" />
                </div>
              </div>

              <!-- Left Column: Clients List -->
              <div class="messages-clients-column">
                <div class="thread-list-header">
                  <span>Clients</span>
                </div>
                <div class="thread-list" id="admin-thread-list" role="listbox" aria-label="Client conversations">
                  <!-- Threads populated by JS -->
                </div>
              </div>

              <!-- Right Column: Thread + Compose -->
              <div class="messages-thread-column">
                <h3 class="sr-only" id="admin-thread-header">Conversation</h3>

                <!-- Pinned Messages Section -->
                <div class="pinned-messages hidden" id="pinned-messages-section">
                  <div class="pinned-messages-header">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><path d="M12 2L12 12M12 22L12 12M12 12L20 4M12 12L4 4"/></svg>
                    <span>Pinned</span>
                  </div>
                  <div class="pinned-message-preview" id="pinned-message-preview"></div>
                </div>

                <!-- Messages Thread -->
                <div class="messages-thread" id="admin-messages-thread" aria-live="polite" aria-atomic="false" aria-label="Messages thread">
                  <p class="empty-state">No conversation selected</p>
                </div>

                <!-- Compose Message -->
                <div class="message-compose" id="admin-compose-area">
                  <div id="admin-attachment-preview" class="attachment-preview hidden"></div>
                  <div class="message-input-wrapper">
                    <label for="admin-message-text" class="sr-only">Message</label>
                    <textarea
                      id="admin-message-text"
                      class="form-textarea"
                      placeholder="Type a message or drop files here..."
                      aria-label="Type your message to the client"
                      tabindex="0"
                      disabled
                    ></textarea>
                  </div>
                  <div class="message-compose-actions">
                    <button type="button" class="btn-attach" id="admin-attach-btn" title="Attach files">
                      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg>
                    </button>
                    <button class="btn btn-secondary" id="admin-send-message" tabindex="0" disabled>Send Message</button>
                  </div>
                  <input type="file" id="admin-attachment-input" class="attachment-input" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg,.gif,.txt,.zip" />
                </div>
              </div>
            </div>
          </div>

          <!-- Analytics Tab -->
          <div class="tab-content" id="tab-analytics">
            <!-- Overview Sub-Tab -->
            <div class="analytics-subtab-content active" id="analytics-subtab-overview">
              <h3 class="tab-section-heading">Overview</h3>
              <!-- Business KPI Cards -->
              <div class="card-grid-4" id="business-kpi-section">
                <div class="stat-card" id="kpi-revenue">
                  <div class="kpi-card-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                  </div>
                  <span class="stat-number" id="kpi-revenue-value">$0</span>
                  <span class="stat-label">Revenue MTD</span>
                  <div class="kpi-card-change" id="kpi-revenue-change">
                    <span class="change-value">-</span>
                    <span class="kpi-card-change-label">vs last month</span>
                  </div>
                </div>
                <div class="stat-card" id="kpi-pipeline">
                  <div class="kpi-card-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>
                  </div>
                  <span class="stat-number" id="kpi-pipeline-value">$0</span>
                  <span class="stat-label">Pipeline Value</span>
                  <div class="kpi-card-change" id="kpi-pipeline-count">
                    <span class="change-value">-</span>
                    <span class="kpi-card-change-label">active leads</span>
                  </div>
                </div>
                <div class="stat-card" id="kpi-projects">
                  <div class="kpi-card-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
                  </div>
                  <span class="stat-number" id="kpi-projects-value">0</span>
                  <span class="stat-label">Active Projects</span>
                  <div class="kpi-card-change" id="kpi-projects-completion">
                    <span class="change-value">-</span>
                    <span class="kpi-card-change-label">avg completion</span>
                  </div>
                </div>
                <div class="stat-card" id="kpi-invoices">
                  <div class="kpi-card-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>
                  </div>
                  <span class="stat-number" id="kpi-invoices-value">$0</span>
                  <span class="stat-label">Outstanding Invoices</span>
                  <div class="kpi-card-change" id="kpi-invoices-count">
                    <span class="change-value">-</span>
                    <span class="kpi-card-change-label">invoices pending</span>
                  </div>
                </div>
              </div>

            <!-- Lead Funnel -->
            <div class="portal-project-card portal-shadow" id="lead-funnel-section">
              <h3>Lead Conversion Funnel</h3>
              <div class="funnel-container" id="lead-funnel">
                <div class="funnel-stage" data-stage="new">
                  <span class="funnel-stage-value" id="funnel-new">0</span>
                  <span class="funnel-stage-label">New Leads</span>
                </div>
                <div class="funnel-arrow">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg>
                </div>
                <div class="funnel-stage" data-stage="contacted">
                  <span class="funnel-stage-value" id="funnel-contacted">0</span>
                  <span class="funnel-stage-label">Contacted</span>
                </div>
                <div class="funnel-arrow">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg>
                </div>
                <div class="funnel-stage" data-stage="qualified">
                  <span class="funnel-stage-value" id="funnel-qualified">0</span>
                  <span class="funnel-stage-label">Qualified</span>
                </div>
                <div class="funnel-arrow">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg>
                </div>
                <div class="funnel-stage" data-stage="proposal">
                  <span class="funnel-stage-value" id="funnel-proposal">0</span>
                  <span class="funnel-stage-label">Proposal</span>
                </div>
                <div class="funnel-arrow">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg>
                </div>
                <div class="funnel-stage funnel-stage-success" data-stage="won">
                  <span class="funnel-stage-value" id="funnel-won">0</span>
                  <span class="funnel-stage-label">Won</span>
                </div>
              </div>
              <div class="funnel-stats" id="funnel-stats">
                <span class="funnel-stat" id="funnel-conversion-rate">Conversion Rate: -</span>
                <span class="funnel-stat" id="funnel-avg-value">Avg Deal Value: -</span>
              </div>
            </div>
            </div><!-- End Overview Sub-Tab -->

            <!-- Business Sub-Tab -->
            <div class="analytics-subtab-content" id="analytics-subtab-business">
              <h3 class="tab-section-heading">Business</h3>
              <div class="analytics-card-grid">
                <div class="portal-project-card portal-shadow">
                  <h3>Revenue by Month</h3>
                  <div class="chart-canvas-wrapper" id="revenue-chart-container">
                    <canvas id="revenue-chart"></canvas>
                  </div>
                </div>
                <div class="portal-project-card portal-shadow">
                  <h3>Project Status</h3>
                  <div class="chart-canvas-wrapper" id="project-status-chart-container">
                    <canvas id="project-status-chart"></canvas>
                  </div>
                </div>
              </div>

              <!-- Ad Hoc Revenue Widget -->
              <div class="portal-project-card portal-shadow">
                <h3>Ad Hoc Revenue Analytics</h3>
                <div id="ad-hoc-analytics-widget" class="loading-text">Loading ad hoc analytics...</div>
              </div>

              <!-- Lead Analytics & Scoring -->
              <div class="portal-project-card portal-shadow leads-analytics-section" id="leads-analytics-section">
                <h3>Lead Analytics</h3>
                <div class="analytics-columns-2col">
                  <div class="analytics-column" id="conversion-funnel-card">
                    <span class="field-label">Conversion Funnel</span>
                    <div class="funnel-container" id="leads-conversion-funnel">
                      <div class="loading-text">Loading funnel data...</div>
                    </div>
                  </div>
                  <div class="analytics-column" id="source-performance-card">
                    <span class="field-label">Lead Sources</span>
                    <div class="source-list" id="leads-source-performance">
                      <div class="loading-text">Loading source data...</div>
                    </div>
                  </div>
                </div>
                <div class="analytics-column analytics-column-full" id="scoring-rules-card">
                  <div class="analytics-column-header">
                    <span class="field-label">Scoring Rules</span>
                    <button type="button" class="icon-btn" id="add-scoring-rule-btn" title="Add rule" aria-label="Add scoring rule">
                      <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M5 12h14"/><path d="M12 5v14"/></svg></span>
                    </button>
                  </div>
                  <div class="scoring-rules-list" id="scoring-rules-list">
                    <div class="loading-text">Loading scoring rules...</div>
                  </div>
                </div>
              </div>
            </div><!-- End Business Sub-Tab -->

            <!-- Visitors Sub-Tab -->
            <div class="analytics-subtab-content" id="analytics-subtab-visitors">
              <h3 class="tab-section-heading">Visitors</h3>
              <!-- Site Breakdown -->
              <div class="analytics-card-grid">
                <div class="portal-project-card portal-shadow">
                  <h3>Main Portfolio Site</h3>
                  <div class="quick-stats analytics-breakdown-stats">
                    <div class="stat-card">
                      <span class="stat-number" id="analytics-portfolio-visitors">-</span>
                      <span class="stat-label">Total Visitors</span>
                    </div>
                    <div class="stat-card">
                      <span class="stat-number" id="analytics-portfolio-pageviews">-</span>
                      <span class="stat-label">Page Views</span>
                    </div>
                    <div class="stat-card">
                      <span class="stat-number" id="analytics-portfolio-sessions">-</span>
                      <span class="stat-label">Avg. Session</span>
                    </div>
                  </div>
                </div>
                <div class="portal-project-card portal-shadow">
                  <h3>The Backend (Client Portal)</h3>
                  <div class="quick-stats analytics-breakdown-stats">
                    <div class="stat-card">
                      <span class="stat-number" id="analytics-backend-visitors">-</span>
                      <span class="stat-label">Total Visitors</span>
                    </div>
                    <div class="stat-card">
                      <span class="stat-number" id="analytics-backend-pageviews">-</span>
                      <span class="stat-label">Page Views</span>
                    </div>
                    <div class="stat-card">
                      <span class="stat-number" id="analytics-backend-sessions">-</span>
                      <span class="stat-label">Avg. Session</span>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Legacy IDs for dashboard visitor-stats -->
              <div class="sr-only" aria-hidden="true">
                <span id="analytics-visitors">-</span>
                <span id="analytics-pageviews">-</span>
                <span id="analytics-sessions">-</span>
              </div>

              <!-- Visitor Charts -->
              <div class="analytics-card-grid">
                <div class="portal-project-card portal-shadow">
                  <h3>Visitors Over Time</h3>
                  <div class="chart-canvas-wrapper">
                    <canvas id="visitors-chart"></canvas>
                  </div>
                </div>
                <div class="portal-project-card portal-shadow">
                  <h3>Traffic Sources</h3>
                  <div class="chart-canvas-wrapper">
                    <canvas id="sources-chart"></canvas>
                  </div>
                </div>
              </div>

              <!-- Analytics Data Grid -->
              <div class="analytics-card-grid">
                <div class="portal-project-card portal-shadow">
                  <h3>Popular Pages</h3>
                  <div class="data-list" id="popular-pages">
                    <div class="data-item"><span class="data-label">Loading...</span></div>
                  </div>
                </div>
                <div class="portal-project-card portal-shadow">
                  <h3>Device Breakdown</h3>
                  <div class="data-list" id="device-breakdown">
                    <div class="data-item"><span class="data-label">Loading...</span></div>
                  </div>
                </div>
                <div class="portal-project-card portal-shadow">
                  <h3>Geographic Distribution</h3>
                  <div class="data-list" id="geo-distribution">
                    <div class="data-item"><span class="data-label">Loading...</span></div>
                  </div>
                </div>
                <div class="portal-project-card portal-shadow">
                  <h3>Engagement Events</h3>
                  <div class="data-list" id="engagement-events">
                    <div class="data-item"><span class="data-label">Loading...</span></div>
                  </div>
                </div>
              </div>

              <!-- Visitors Table -->
              <div class="visitors-dashboard">
                <div class="admin-table-card portal-shadow">
                  <div class="admin-table-header">
                    <h3>Recent Sessions</h3>
                  </div>
                  <div class="admin-table-container">
                    <div class="admin-table-scroll-wrapper">
                      <table class="admin-table visitors-table">
                        <thead>
                          <tr>
                            <th scope="col">Session ID</th>
                            <th scope="col">Started</th>
                            <th scope="col">Duration</th>
                            <th scope="col">Pages</th>
                            <th scope="col">Device</th>
                            <th scope="col">Location</th>
                          </tr>
                        </thead>
                        <tbody id="visitors-table-body" aria-live="polite" aria-atomic="false" aria-relevant="additions removals">
                          <tr>
                            <td colspan="6" class="loading-row">Loading visitor data...</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div><!-- End Visitors Sub-Tab -->

            <!-- Reports & Alerts Sub-Tab -->
            <div class="analytics-subtab-content" id="analytics-subtab-reports">
              <h3 class="tab-section-heading">Reports & Alerts</h3>
              <!-- Saved Reports Section -->
              <div class="portal-project-card portal-shadow" id="saved-reports-section">
                <div class="section-header-with-actions">
                  <h3>Saved Reports</h3>
                  <button type="button" class="icon-btn" id="create-report-btn" title="New report" aria-label="Create new report">
                    <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M5 12h14"/><path d="M12 5v14"/></svg></span>
                  </button>
                </div>
                <div class="reports-list" id="saved-reports-list">
                  <div class="loading-text">Loading reports...</div>
                </div>
              </div>

              <!-- Scheduled Reports Section -->
              <div class="portal-project-card portal-shadow" id="scheduled-reports-section">
                <div class="section-header-with-actions">
                  <h3>Scheduled Reports</h3>
                </div>
                <div class="reports-list" id="scheduled-reports-list">
                  <div class="loading-text">Loading scheduled reports...</div>
                </div>
              </div>

              <!-- Metric Alerts Section -->
              <div class="portal-project-card portal-shadow" id="metric-alerts-section">
                <div class="section-header-with-actions">
                  <h3>Metric Alerts</h3>
                  <button type="button" class="icon-btn" id="create-alert-btn" title="New alert" aria-label="Create new metric alert">
                    <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M5 12h14"/><path d="M12 5v14"/></svg></span>
                  </button>
                </div>
                <div class="alerts-list" id="metric-alerts-list">
                  <div class="loading-text">Loading alerts...</div>
                </div>
              </div>

              <!-- Performance Metrics -->
              <div class="portal-project-card portal-shadow">
                <h3>Core Web Vitals</h3>
                <div class="vitals-grid">
                  <div class="vital-card">
                    <h4>LCP <span class="info-icon-wrapper" data-tooltip="Largest Contentful Paint - Time until the largest visible element loads.&#10;&#10;Good: <2.5s&#10;Needs Improvement: 2.5-4s&#10;Poor: >4s"><svg class="info-icon" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></span></h4>
                    <div class="vital-value" id="lcp-value">-</div>
                    <span class="vital-status" id="lcp-status">-</span>
                  </div>
                  <div class="vital-card">
                    <h4>FID <span class="info-icon-wrapper" data-tooltip="First Input Delay - Time from first interaction to browser response.&#10;&#10;Good: <100ms&#10;Needs Improvement: 100-300ms&#10;Poor: >300ms"><svg class="info-icon" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></span></h4>
                    <div class="vital-value" id="fid-value">-</div>
                    <span class="vital-status" id="fid-status">-</span>
                  </div>
                  <div class="vital-card">
                    <h4>CLS <span class="info-icon-wrapper" data-tooltip="Cumulative Layout Shift - Visual stability score measuring unexpected layout shifts.&#10;&#10;Good: <0.1&#10;Needs Improvement: 0.1-0.25&#10;Poor: >0.25"><svg class="info-icon" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></span></h4>
                    <div class="vital-value" id="cls-value">-</div>
                    <span class="vital-status" id="cls-status">-</span>
                  </div>
                  <div class="vital-card">
                    <h4>TTFB <span class="info-icon-wrapper" data-tooltip="Time to First Byte - Server response time.&#10;&#10;Good: <800ms&#10;Needs Improvement: 800-1800ms&#10;Poor: >1800ms"><svg class="info-icon" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></span></h4>
                    <div class="vital-value" id="ttfb-value">-</div>
                    <span class="vital-status" id="ttfb-status">-</span>
                  </div>
                </div>
              </div>

              <!-- Bundle Analysis -->
              <div class="portal-project-card portal-shadow">
                <h3>Bundle Analysis</h3>
                <div class="bundle-info">
                  <div class="bundle-item">
                    <span>Total Bundle Size</span>
                    <span id="total-bundle-size">-</span>
                  </div>
                  <div class="bundle-item">
                    <span>Main JS</span>
                    <span id="js-bundle-size">-</span>
                  </div>
                  <div class="bundle-item">
                    <span>Vendor JS</span>
                    <span id="css-bundle-size">-</span>
                  </div>
                  <div class="bundle-item">
                    <span>Performance Score</span>
                    <span id="performance-score">-</span>
                  </div>
                </div>
              </div>
            </div><!-- End Reports & Alerts Sub-Tab -->

          </div><!-- End Analytics Tab -->

          <!-- Document Requests Tab -->
          <div class="tab-content" id="tab-document-requests">
            <div class="admin-table-card portal-shadow">
              <div class="admin-table-header">
                <h3>Requests</h3>
                <div class="admin-table-actions" id="dr-filter-container">
                  <button type="button" class="icon-btn" id="dr-export" title="Export to CSV" aria-label="Export to CSV">
                    <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg></span>
                  </button>
                  <button type="button" class="icon-btn" id="dr-refresh" title="Refresh" aria-label="Refresh">
                    <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg></span>
                  </button>
                  <button type="button" class="icon-btn" id="dr-add-request" title="Add Request" aria-label="Add Request">
                    <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M5 12h14"/><path d="M12 5v14"/></svg></span>
                  </button>
                </div>
              </div>
              <div id="dr-bulk-toolbar" class="bulk-action-toolbar"></div>
              <div class="admin-table-container">
                <div class="admin-table-scroll-wrapper">
                <table class="admin-table" aria-label="Document requests">
                  <thead>
                    <tr>
                      <th scope="col" class="bulk-select-cell">
                        <div class="portal-checkbox">
                          <input type="checkbox" id="document-requests-select-all" class="bulk-select-all" aria-label="Select all document requests" />
                        </div>
                      </th>
                      <th scope="col">Title</th>
                      <th scope="col" class="contact-col">Client</th>
                      <th scope="col" class="type-col">Type</th>
                      <th scope="col" class="status-col">Status</th>
                      <th scope="col" class="date-col">Due</th>
                      <th scope="col" class="actions-col">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="document-requests-table-body" aria-live="polite" aria-atomic="false" aria-relevant="additions removals">
                    <tr>
                      <td colspan="6" class="loading-row">Loading requests...</td>
                    </tr>
                  </tbody>
                </table>
                </div>
              </div>
              <!-- Pagination -->
              <div id="document-requests-pagination" class="table-pagination"></div>
            </div>
            <div class="admin-modal-overlay hidden" id="dr-create-modal" role="dialog" aria-modal="true" aria-labelledby="dr-create-modal-title">
              <div class="admin-modal">
                <div class="admin-modal-header">
                  <div class="admin-modal-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                    <h2 id="dr-create-modal-title">New Document Request</h2>
                  </div>
                  <button class="admin-modal-close" id="dr-create-modal-close" aria-label="Close modal">&times;</button>
                </div>
                <div class="admin-modal-tabs">
                  <button type="button" class="admin-modal-tab active" data-dr-tab="single">Single Request</button>
                  <button type="button" class="admin-modal-tab" data-dr-tab="templates">From Templates</button>
                </div>
                <!-- Single Request Tab -->
                <form id="dr-create-form" data-dr-tab-content="single">
                  <div class="admin-modal-body">
                    <div class="form-group">
                      <label class="field-label" for="dr-create-client">Client *</label>
                      <select id="dr-create-client" name="dr-create-client" class="form-input" required>
                        <option value="">Select client</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label class="field-label" for="dr-create-title">Title *</label>
                      <input type="text" id="dr-create-title" class="form-input" placeholder="Document title" required />
                    </div>
                    <div class="form-group">
                      <label class="field-label" for="dr-create-description">Description</label>
                      <textarea id="dr-create-description" class="form-input" rows="3" placeholder="Additional details about the document request"></textarea>
                    </div>
                    <div class="form-group">
                      <label class="field-label" for="dr-create-due">Due Date</label>
                      <input type="date" id="dr-create-due" class="form-input" />
                    </div>
                  </div>
                  <div class="admin-modal-footer">
                    <button type="button" class="btn btn-secondary" id="dr-create-cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Request</button>
                  </div>
                </form>
                <!-- From Templates Tab -->
                <form id="dr-from-templates-form" data-dr-tab-content="templates" style="display: none;">
                  <div class="admin-modal-body">
                    <div class="form-group">
                      <label class="field-label" for="dr-templates-client">Client *</label>
                      <select id="dr-templates-client" name="dr-templates-client" class="form-input" required>
                        <option value="">Select client</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label class="field-label">Select Templates *</label>
                      <div id="dr-templates-list" class="dr-templates-checkboxes" aria-label="Select templates"></div>
                    </div>
                  </div>
                  <div class="admin-modal-footer">
                    <button type="button" class="btn btn-secondary" id="dr-templates-cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Requests</button>
                  </div>
                </form>
              </div>
            </div>
            <div class="admin-modal-overlay hidden" id="dr-detail-modal" role="dialog" aria-modal="true" aria-labelledby="dr-detail-modal-title">
              <div class="admin-modal admin-modal--wide">
                <div class="admin-modal-header">
                  <div class="admin-modal-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                    <h2 id="dr-detail-modal-title">Document Request</h2>
                  </div>
                  <button class="admin-modal-close" id="dr-detail-modal-close" aria-label="Close modal">&times;</button>
                </div>
                <div id="dr-detail-body" class="admin-modal-body"></div>
                <div id="dr-detail-footer" class="admin-modal-footer"></div>
              </div>
            </div>
          </div>

          <!-- Questionnaires Tab -->
          <div class="tab-content" id="tab-questionnaires">
            <div class="admin-table-card portal-shadow">
              <div class="admin-table-header">
                <h3>Questionnaires</h3>
                <div class="admin-table-actions" id="questionnaires-filter-container">
                  <button type="button" class="icon-btn" id="questionnaires-refresh" title="Refresh" aria-label="Refresh questionnaires">
                    <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg></span>
                  </button>
                  <button type="button" class="icon-btn icon-btn-primary" id="questionnaires-add" title="Create Questionnaire" aria-label="Create questionnaire">
                    <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M5 12h14"/><path d="M12 5v14"/></svg></span>
                  </button>
                </div>
              </div>
              <div class="admin-table-container">
                <div class="admin-table-scroll-wrapper">
                <table class="admin-table" aria-label="Questionnaires">
                  <thead>
                    <tr>
                      <th scope="col">Name</th>
                      <th scope="col">Description</th>
                      <th scope="col" class="type-col">Project Type</th>
                      <th scope="col" class="status-col">Status</th>
                      <th scope="col" class="actions-col">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="questionnaires-table-body" aria-live="polite" aria-atomic="false" aria-relevant="additions removals">
                    <tr>
                      <td colspan="5" class="loading-row">Loading questionnaires...</td>
                    </tr>
                  </tbody>
                </table>
                </div>
              </div>
              <div id="questionnaires-pagination" class="table-pagination"></div>
            </div>

            <!-- Pending Responses Card -->
            <div class="admin-table-card portal-shadow" style="margin-top: var(--space-lg);">
              <div class="admin-table-header">
                <h3>Pending Responses</h3>
                <div class="admin-table-actions">
                  <button type="button" class="icon-btn" id="responses-refresh" title="Refresh" aria-label="Refresh responses">
                    <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg></span>
                  </button>
                </div>
              </div>
              <div class="admin-table-container">
                <div class="admin-table-scroll-wrapper">
                <table class="admin-table" aria-label="Pending questionnaire responses">
                  <thead>
                    <tr>
                      <th scope="col">Questionnaire</th>
                      <th scope="col" class="contact-col">Client</th>
                      <th scope="col" class="status-col">Status</th>
                      <th scope="col" class="date-col">Due Date</th>
                      <th scope="col" class="actions-col">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="responses-table-body" aria-live="polite" aria-atomic="false" aria-relevant="additions removals">
                    <tr>
                      <td colspan="5" class="loading-row">Loading responses...</td>
                    </tr>
                  </tbody>
                </table>
                </div>
              </div>
            </div>

            <!-- Create/Edit Questionnaire Modal -->
            <div class="admin-modal-overlay hidden" id="questionnaire-modal" role="dialog" aria-modal="true" aria-labelledby="questionnaire-modal-title">
              <div class="admin-modal admin-modal--lg">
                <div class="admin-modal-header">
                  <div class="admin-modal-title">
                    <h2 id="questionnaire-modal-title">Create Questionnaire</h2>
                  </div>
                  <button class="admin-modal-close" id="questionnaire-modal-close" aria-label="Close modal">&times;</button>
                </div>
                <div class="admin-modal-body">
                  <form id="questionnaire-form">
                    <div class="form-row">
                      <div class="form-group">
                        <label for="questionnaire-name">Internal Name</label>
                        <input type="text" id="questionnaire-name" name="name" required placeholder="e.g., website_discovery" />
                      </div>
                      <div class="form-group">
                        <label for="questionnaire-project-type">Project Type</label>
                        <select id="questionnaire-project-type" name="project_type">
                          <option value="">All Types</option>
                          <option value="website">Website</option>
                          <option value="branding">Branding</option>
                          <option value="ecommerce">E-commerce</option>
                          <option value="marketing">Marketing</option>
                          <option value="other">Other</option>
                        </select>
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="questionnaire-description">Description (shown to clients)</label>
                      <textarea id="questionnaire-description" name="description" rows="2" placeholder="Help us understand your project needs..."></textarea>
                    </div>
                    <div class="form-row">
                      <div class="form-group form-group--checkbox">
                        <label>
                          <input type="checkbox" id="questionnaire-active" name="is_active" checked />
                          Active
                        </label>
                      </div>
                      <div class="form-group form-group--checkbox">
                        <label>
                          <input type="checkbox" id="questionnaire-auto-send" name="auto_send_on_project_create" />
                          Auto-send on project creation
                        </label>
                      </div>
                    </div>
                    <hr />
                    <div class="form-group">
                      <label>Questions</label>
                      <div id="questions-builder">
                        <!-- Questions will be added dynamically -->
                      </div>
                      <button type="button" class="btn btn-secondary btn-sm" id="add-question-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                        Add Question
                      </button>
                    </div>
                  </form>
                </div>
                <div class="admin-modal-footer">
                  <button type="button" class="btn btn-secondary" id="questionnaire-cancel">Cancel</button>
                  <button type="submit" form="questionnaire-form" class="btn btn-primary" id="questionnaire-save">Save Questionnaire</button>
                </div>
              </div>
            </div>

            <!-- Send Questionnaire Modal -->
            <div class="admin-modal-overlay hidden" id="send-questionnaire-modal" role="dialog" aria-modal="true" aria-labelledby="send-questionnaire-modal-title">
              <div class="admin-modal">
                <div class="admin-modal-header">
                  <div class="admin-modal-title">
                    <h2 id="send-questionnaire-modal-title">Send Questionnaire</h2>
                  </div>
                  <button class="admin-modal-close" id="send-questionnaire-modal-close" aria-label="Close modal">&times;</button>
                </div>
                <div class="admin-modal-body">
                  <form id="send-questionnaire-form">
                    <input type="hidden" id="send-questionnaire-id" name="questionnaire_id" />
                    <div class="form-group">
                      <label for="send-questionnaire-client">Client</label>
                      <select id="send-questionnaire-client" name="client_id" required>
                        <option value="">Select a client...</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="send-questionnaire-due">Due Date (optional)</label>
                      <input type="date" id="send-questionnaire-due" name="due_date" />
                    </div>
                  </form>
                </div>
                <div class="admin-modal-footer">
                  <button type="button" class="btn btn-secondary" id="send-questionnaire-cancel">Cancel</button>
                  <button type="submit" form="send-questionnaire-form" class="btn btn-primary" id="send-questionnaire-submit">Send</button>
                </div>
              </div>
            </div>

            <!-- View Response Modal -->
            <div class="admin-modal-overlay hidden" id="view-response-modal" role="dialog" aria-modal="true" aria-labelledby="view-response-modal-title">
              <div class="admin-modal admin-modal--lg">
                <div class="admin-modal-header">
                  <div class="admin-modal-title">
                    <h2 id="view-response-modal-title">Questionnaire Response</h2>
                  </div>
                  <button class="admin-modal-close" id="view-response-modal-close" aria-label="Close modal">&times;</button>
                </div>
                <div id="view-response-body" class="admin-modal-body">
                  <!-- Response content will be populated dynamically -->
                </div>
                <div class="admin-modal-footer">
                  <button type="button" class="btn btn-secondary" id="view-response-close">Close</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Knowledge Base Tab -->
          <div class="tab-content" id="tab-knowledge-base">
            <div class="admin-table-card portal-shadow" id="kb-categories-card">
              <div class="admin-table-header">
                <h3>Categories</h3>
                <div class="admin-table-actions">
                  <button type="button" class="icon-btn" id="kb-refresh-categories" title="Refresh" aria-label="Refresh categories">
                    <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg></span>
                  </button>
                  <button type="button" class="icon-btn" id="kb-add-category" title="Add Category" aria-label="Add Category">
                    <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M5 12h14"/><path d="M12 5v14"/></svg></span>
                  </button>
                </div>
              </div>
              <div class="admin-table-container">
                <div class="admin-table-scroll-wrapper">
                <table class="admin-table" aria-label="Knowledge base categories">
                  <thead>
                    <tr>
                      <th scope="col">Name</th>
                      <th scope="col">Slug</th>
                      <th scope="col" class="count-col">Articles</th>
                      <th scope="col" class="status-col">Active</th>
                      <th scope="col" class="actions-col">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="kb-categories-table-body" aria-live="polite" aria-atomic="false" aria-relevant="additions removals">
                    <tr>
                      <td colspan="4" class="loading-row">Loading categories...</td>
                    </tr>
                  </tbody>
                </table>
                </div>
              </div>
            </div>
            <div class="admin-table-card portal-shadow" id="kb-articles-card">
              <div class="admin-table-header">
                <h3>Articles</h3>
                <div class="admin-table-actions" id="kb-articles-filter-container">
                  <button type="button" class="icon-btn" id="kb-export" title="Export to CSV" aria-label="Export articles to CSV">
                    <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg></span>
                  </button>
                  <button type="button" class="icon-btn" id="kb-refresh-articles" title="Refresh" aria-label="Refresh articles">
                    <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg></span>
                  </button>
                  <button type="button" class="icon-btn" id="kb-add-article" title="Add Article" aria-label="Add Article">
                    <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M5 12h14"/><path d="M12 5v14"/></svg></span>
                  </button>
                </div>
              </div>
              <div class="admin-table-container">
                <div class="admin-table-scroll-wrapper">
                <table class="admin-table" aria-label="Knowledge base articles">
                  <thead>
                    <tr>
                      <th scope="col">Title</th>
                      <th scope="col" class="type-col">Category</th>
                      <th scope="col">Slug</th>
                      <th scope="col" class="status-col">Featured</th>
                      <th scope="col" class="status-col">Published</th>
                      <th scope="col" class="date-col">Updated</th>
                      <th scope="col" class="actions-col">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="kb-articles-table-body" aria-live="polite" aria-atomic="false" aria-relevant="additions removals">
                    <tr>
                      <td colspan="5" class="loading-row">Loading articles...</td>
                    </tr>
                  </tbody>
                </table>
                </div>
              </div>
              <!-- Pagination -->
              <div id="kb-articles-pagination" class="table-pagination"></div>
            </div>
            <!-- KB category and article modals are created by createPortalModal in admin-knowledge-base.ts -->
          </div>

          <!-- System Status Tab -->
          <div class="tab-content" id="tab-system">
            <!-- Health Check -->
            <div class="portal-project-card portal-shadow">
              <div class="section-header-with-actions">
                <h3>Health Check</h3>
                <button type="button" class="icon-btn" id="btn-refresh-health" title="Refresh health status" aria-label="Refresh health status">
                  <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg></span>
                </button>
              </div>
              <div class="health-check-grid" id="health-check-status">
                <div class="health-item">
                  <span class="health-indicator health-loading" id="health-database"></span>
                  <span class="health-label">Database</span>
                  <span class="health-status" id="health-database-status">Checking...</span>
                </div>
                <div class="health-item">
                  <span class="health-indicator health-loading" id="health-email"></span>
                  <span class="health-label">Email Service</span>
                  <span class="health-status" id="health-email-status">Checking...</span>
                </div>
                <div class="health-item">
                  <span class="health-indicator health-loading" id="health-storage"></span>
                  <span class="health-label">File Storage</span>
                  <span class="health-status" id="health-storage-status">Checking...</span>
                </div>
                <div class="health-item">
                  <span class="health-indicator health-loading" id="health-scheduler"></span>
                  <span class="health-label">Scheduler</span>
                  <span class="health-status" id="health-scheduler-status">Checking...</span>
                </div>
              </div>
            </div>

            <!-- Quick Actions -->
            <div class="portal-project-card portal-shadow">
              <h3>Quick Actions</h3>
              <div class="quick-actions-grid">
                <button type="button" class="btn btn-secondary" id="btn-clear-cache" title="Clear application cache">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                  Clear Cache
                </button>
                <button type="button" class="btn btn-secondary" id="btn-test-email" title="Send test email">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
                  Test Email
                </button>
                <button type="button" class="btn btn-secondary" id="btn-run-scheduler" title="Force run scheduled tasks">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                  Run Scheduler
                </button>
              </div>
            </div>

            <!-- Recent Errors -->
            <div class="portal-project-card portal-shadow">
              <h3>Recent Errors</h3>
              <div class="recent-errors-list" id="recent-errors-list">
                <p class="empty-state-text">No recent errors</p>
              </div>
            </div>

            <!-- Build Information -->
            <details class="portal-project-card portal-shadow system-details">
              <summary><h3>Build Information</h3></summary>
              <div class="system-info-grid">
                <div class="system-info-row">
                  <span>Version</span>
                  <span id="sys-version">10.0.0</span>
                </div>
                <div class="system-info-row">
                  <span>Environment</span>
                  <span id="sys-environment">development</span>
                </div>
                <div class="system-info-row">
                  <span>Build Date</span>
                  <span id="sys-build-date">-</span>
                </div>
              </div>
            </details>

            <!-- Browser Information -->
            <details class="portal-project-card portal-shadow system-details">
              <summary><h3>Browser Information</h3></summary>
              <div class="system-info-grid">
                <div class="system-info-row">
                  <span>User Agent</span>
                  <span id="sys-useragent" class="truncate-text">-</span>
                </div>
                <div class="system-info-row">
                  <span>Screen Resolution</span>
                  <span id="sys-screen">-</span>
                </div>
                <div class="system-info-row">
                  <span>Viewport Size</span>
                  <span id="sys-viewport">-</span>
                </div>
              </div>
            </details>

            <!-- Legacy Module/Service Status (hidden, for backwards compat) -->
            <div class="sr-only" aria-hidden="true">
              <div id="modules-status"></div>
              <div id="services-status"></div>
            </div>
          </div>

          <!-- Project Detail View (mirrors client portal view) -->
          <div class="tab-content" id="tab-project-detail">
            <!-- Project Header Card (matches client detail pattern) -->
            <div class="portal-project-card portal-shadow pd-header-card">
              <div class="pd-header-top">
                <div class="pd-header-info">
                  <div class="detail-title-row">
                    <div class="detail-title-group">
                      <h2 class="detail-title" id="pd-project-name">Project Name</h2>
                      <span class="status-badge" id="pd-status">-</span>
                    </div>
                    <div class="detail-actions">
                      <button class="icon-btn" id="pd-btn-edit" title="Edit Project" aria-label="Edit project details">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                      </button>
                      <div class="table-dropdown detail-more-menu" id="pd-more-menu">
                        <button type="button" class="custom-dropdown-trigger" aria-label="More actions">
                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>
                        </button>
                        <ul class="custom-dropdown-menu">
                          <li class="custom-dropdown-item" data-action="edit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                            Edit Project
                          </li>
                          <li class="custom-dropdown-item" data-action="duplicate">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                            Duplicate Project
                          </li>
                          <li class="custom-dropdown-item" data-action="archive">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="4" width="20" height="5" rx="1"/><path d="M4 9v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9"/><path d="M10 13h4"/></svg>
                            Archive Project
                          </li>
                          <li class="custom-dropdown-item" data-action="generate-docs">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                            Generate Documents
                          </li>
                          <li class="dropdown-divider"></li>
                          <li class="custom-dropdown-item danger" data-action="delete">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                            Delete Project
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <!-- Client Info in Header -->
                  <div class="pd-header-client">
                    <div class="pd-client-item clickable-client" id="pd-header-client-link">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                      <span id="pd-header-client-name">-</span>
                    </div>
                    <div class="pd-client-item" id="pd-header-company-row">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/></svg>
                      <span id="pd-header-company">-</span>
                    </div>
                    <div class="pd-client-item">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
                      <span id="pd-header-email">-</span>
                    </div>
                  </div>
                  <!-- Project Meta in Header -->
                  <div class="pd-header-meta">
                    <div class="pd-meta-item">
                      <span class="field-label">Type</span>
                      <span class="pd-meta-value" id="pd-header-type">-</span>
                    </div>
                    <div class="pd-meta-item">
                      <span class="field-label">Start</span>
                      <span class="pd-meta-value" id="pd-header-start">-</span>
                    </div>
                    <div class="pd-meta-item">
                      <span class="field-label">Target End</span>
                      <span class="pd-meta-value" id="pd-header-end">-</span>
                    </div>
                    <div class="pd-meta-item">
                      <span class="field-label">Budget</span>
                      <span class="pd-meta-value" id="pd-header-budget">-</span>
                    </div>
                  </div>
                  <!-- Project Description -->
                  <div class="pd-header-description">
                    <span class="field-label">Description</span>
                    <p class="pd-description" id="pd-description">-</p>
                  </div>
                  <!-- Financial Details -->
                  <div class="pd-header-meta">
                    <div class="pd-meta-item">
                      <span class="field-label">Timeline</span>
                      <span class="pd-meta-value" id="pd-timeline">-</span>
                    </div>
                    <div class="pd-meta-item">
                      <span class="field-label">Quoted Price</span>
                      <span class="pd-meta-value" id="pd-price">-</span>
                    </div>
                    <div class="pd-meta-item">
                      <span class="field-label">Deposit</span>
                      <span class="pd-meta-value" id="pd-deposit">-</span>
                    </div>
                  </div>
                  <!-- Project URLs -->
                  <div class="pd-header-urls" id="pd-urls-section">
                    <span class="field-label">Links</span>
                    <div class="pd-urls-row">
                      <a href="#" id="pd-preview-url-link" target="_blank" rel="noopener noreferrer" class="pd-url-link">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
                        <span>Preview</span>
                      </a>
                      <a href="#" id="pd-repo-url-link" target="_blank" rel="noopener noreferrer" class="pd-url-link">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
                        <span>Repository</span>
                      </a>
                      <a href="#" id="pd-production-url-link" target="_blank" rel="noopener noreferrer" class="pd-url-link">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>
                        <span>Production</span>
                      </a>
                    </div>
                  </div>
                  <!-- Admin Notes (Internal) -->
                  <div class="pd-header-description" id="pd-admin-notes-section" style="display: none;">
                    <span class="field-label">Admin Notes (Internal)</span>
                    <p class="pd-description" id="pd-admin-notes">-</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Project Detail Tabs -->
            <div class="project-detail-tabs portal-tabs">
              <button class="active" data-pd-tab="overview">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tab-icon"><path d="m12 14 4-4"/><path d="M3.34 19a10 10 0 1 1 17.32 0"/></svg>
                <span>Overview</span>
              </button>
              <button data-pd-tab="files">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tab-icon"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/></svg>
                <span>Files</span>
              </button>
              <button data-pd-tab="deliverables">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tab-icon"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>
                <span>Deliverables</span>
              </button>
              <button data-pd-tab="messages">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tab-icon"><path d="M16 10a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 14.286V4a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/><path d="M20 9a2 2 0 0 1 2 2v10.286a.71.71 0 0 1-1.212.502l-2.202-2.202A2 2 0 0 0 17.172 19H10a2 2 0 0 1-2-2v-1"/></svg>
                <span>Messages</span>
              </button>
              <button data-pd-tab="invoices">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tab-icon"><path d="M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z"/><path d="M14 2v5a1 1 0 0 0 1 1h5"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>
                <span>Invoices</span>
              </button>
              <button data-pd-tab="tasks">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tab-icon"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
                <span>Tasks</span>
              </button>
              <button data-pd-tab="time">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tab-icon"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                <span>Time</span>
              </button>
              <button data-pd-tab="contract">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tab-icon"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="m9 15 2 2 4-4"/></svg>
                <span>Contract</span>
              </button>
              <button data-pd-tab="notes">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tab-icon"><path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z"/></svg>
                <span>Notes</span>
              </button>
            </div>

            <!-- Overview Sub-Tab -->
            <div class="portal-tab-panel active" id="pd-tab-overview">
              <!-- Two Column Grid -->
              <div class="pd-overview-grid">
                <!-- LEFT COLUMN (Main Content) -->
                <div class="pd-overview-main">
                  <!-- Milestones Section -->
                  <div class="portal-project-card portal-shadow">
                    <div class="card-header-with-action">
                      <h3>Milestones</h3>
                      <button class="btn btn-secondary btn-sm" id="btn-add-milestone">
                        + Add Milestone
                      </button>
                    </div>
                    <div class="milestones-list" id="pd-milestones-list">
                      <p class="empty-state">
                        No milestones yet. Add milestones to track project progress.
                      </p>
                    </div>
                  </div>
                </div>

                <!-- RIGHT COLUMN (Sidebar) -->
                <div class="pd-overview-sidebar">
                  <!-- Progress Card -->
                  <div class="portal-project-card portal-shadow pd-progress-card">
                    <h3>Progress</h3>
                    <div class="pd-progress-display">
                      <div class="pd-progress-ring">
                        <span class="pd-progress-percent" id="pd-progress-percent">0%</span>
                      </div>
                      <div
                        class="progress-bar"
                        role="progressbar"
                        id="pd-progress-bar-container"
                        aria-valuenow="0"
                        aria-valuemin="0"
                        aria-valuemax="100"
                        aria-label="Project completion progress"
                      >
                        <div class="progress-fill" id="pd-progress-bar" style="width: 0%"></div>
                      </div>
                    </div>
                  </div>

                  <!-- Financial Summary -->
                  <div class="portal-project-card portal-shadow">
                    <h3>Financials</h3>
                    <div class="pd-financial-stats">
                      <div class="pd-stat-item">
                        <span class="pd-stat-label">Budget</span>
                        <span class="pd-stat-value" id="pd-sidebar-budget">-</span>
                      </div>
                      <div class="pd-stat-item">
                        <span class="pd-stat-label">Invoiced</span>
                        <span class="pd-stat-value" id="pd-sidebar-invoiced">$0</span>
                      </div>
                      <div class="pd-stat-item">
                        <span class="pd-stat-label">Paid</span>
                        <span class="pd-stat-value pd-stat-success" id="pd-sidebar-paid">$0</span>
                      </div>
                      <div class="pd-stat-item">
                        <span class="pd-stat-label">Outstanding</span>
                        <span class="pd-stat-value pd-stat-warning" id="pd-sidebar-outstanding">$0</span>
                      </div>
                    </div>
                  </div>

                  <!-- Quick Stats -->
                  <div class="portal-project-card portal-shadow">
                    <h3>Quick Stats</h3>
                    <div class="pd-quick-stats">
                      <div class="pd-stat-item">
                        <span class="pd-stat-label">Files</span>
                        <span class="pd-stat-value" id="pd-stat-files">0</span>
                      </div>
                      <div class="pd-stat-item">
                        <span class="pd-stat-label">Messages</span>
                        <span class="pd-stat-value" id="pd-stat-messages">0</span>
                      </div>
                      <div class="pd-stat-item">
                        <span class="pd-stat-label">Tasks</span>
                        <span class="pd-stat-value" id="pd-stat-tasks">0</span>
                      </div>
                      <div class="pd-stat-item">
                        <span class="pd-stat-label">Invoices</span>
                        <span class="pd-stat-value" id="pd-stat-invoices">0</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Recent Activity (Full Width, Last Section) -->
              <div class="portal-project-card portal-shadow pd-activity-card">
                <h3>Recent Activity</h3>
                <ul class="activity-list" id="pd-activity-list" aria-live="polite" aria-atomic="false">
                  <li>No activity recorded yet.</li>
                </ul>
              </div>
            </div>

            <!-- Deliverables Sub-Tab -->
            <div class="portal-tab-panel" id="pd-tab-deliverables">
              <h3 class="tab-section-heading">Deliverables</h3>
              <div class="portal-project-card portal-shadow">
                <div class="card-header-with-action">
                  <h3>Project Deliverables</h3>
                  <button class="btn btn-secondary btn-sm" id="btn-manage-deliverables" data-action="open-deliverables">
                    Manage Deliverables
                  </button>
                </div>
                <div id="pd-deliverables-list" class="deliverables-inline-list">
                  <p class="empty-state">No deliverables yet. Click "Manage Deliverables" to add and track project deliverables.</p>
                </div>
              </div>
            </div>

            <!-- Files Sub-Tab -->
            <div class="portal-tab-panel" id="pd-tab-files">
              <div class="tab-section-header">
                <h3 class="tab-section-heading">Files</h3>
                <!-- Generate Document Dropdown -->
                <div class="table-dropdown generate-document-menu" id="pd-generate-document-menu">
                  <button type="button" class="btn btn-secondary custom-dropdown-trigger" aria-label="Generate document">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
                    <span>Generate Document</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="dropdown-caret"><path d="m6 9 6 6 6-6"/></svg>
                  </button>
                  <ul class="custom-dropdown-menu">
                    <li class="custom-dropdown-item" data-action="generate-proposal">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                      Generate Proposal PDF
                    </li>
                    <li class="custom-dropdown-item" data-action="generate-contract">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                      Generate Contract PDF
                    </li>
                    <li class="custom-dropdown-item" data-action="generate-receipt">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></svg>
                      Generate Receipt PDF
                    </li>
                    <li class="custom-dropdown-item" data-action="generate-report">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
                      Generate Project Report
                    </li>
                    <li class="custom-dropdown-item" data-action="generate-sow">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></svg>
                      Generate SOW
                    </li>
                  </ul>
                </div>
              </div>
              <!-- Upload Section -->
              <div class="files-upload-section portal-shadow">
                <h3>Upload Files for Client</h3>
                <div class="upload-dropzone" id="pd-upload-dropzone">
                  <p>Drag and drop files here or</p>
                  <button class="btn btn-secondary" id="btn-pd-browse-files">Browse Files</button>
                  <input type="file" id="pd-file-input" multiple hidden accept=".jpeg,.jpg,.png,.gif,.pdf,.doc,.docx,.txt,.zip,.rar,image/*,application/pdf" />
                </div>
              </div>

              <!-- Upload Confirmation Modal -->
              <div class="admin-modal-overlay hidden" id="file-upload-modal" role="dialog" aria-modal="true" aria-labelledby="file-upload-modal-title">
                <div class="admin-modal">
                  <div class="admin-modal-header">
                    <h2 id="file-upload-modal-title">Upload Files</h2>
                    <button type="button" class="btn-icon close-modal" id="file-upload-modal-close" aria-label="Close">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                  </div>
                  <div class="admin-modal-body">
                    <div class="upload-files-preview" id="upload-files-preview">
                      <!-- Files to upload listed here -->
                    </div>
                    <div class="form-group">
                      <label for="upload-file-type" class="field-label">File Type</label>
                      <div id="upload-file-type-mount"></div>
                    </div>
                    <div class="form-group" id="pd-upload-link-request" style="display: none;">
                      <label for="upload-request-select" class="field-label">Link to pending request (optional)</label>
                      <div id="upload-request-select-mount"></div>
                    </div>
                  </div>
                  <div class="admin-modal-footer">
                    <button type="button" class="btn btn-secondary" id="file-upload-modal-cancel">Cancel</button>
                    <button type="button" class="btn btn-primary" id="file-upload-modal-confirm">Upload</button>
                  </div>
                </div>
              </div>

              <!-- Files Browser -->
              <div class="files-browser portal-shadow">
                <!-- Folder Tree Panel -->
                <div class="folder-panel">
                  <div class="folder-panel-header">
                    <h4>Folders</h4>
                    <button class="btn-icon" id="btn-create-folder" title="Create Folder" aria-label="Create folder">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path><line x1="12" y1="11" x2="12" y2="17"></line><line x1="9" y1="14" x2="15" y2="14"></line></svg>
                    </button>
                  </div>
                  <div class="folder-tree" id="pd-folder-tree">
                    <div class="folder-item root active" data-folder-id="root">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
                      <span>All Files</span>
                    </div>
                  </div>
                </div>

                <!-- Files List Panel -->
                <div class="files-panel">
                  <div class="files-panel-header">
                    <div class="files-path" id="pd-files-path">
                      <span>All Files</span>
                    </div>
                    <div class="files-panel-controls">
                      <div id="files-source-toggle-mount"></div>
                      <div id="files-view-toggle-mount"></div>
                    </div>
                  </div>
                  <div class="files-list" id="pd-files-list">
                    <p class="empty-state">No files uploaded yet.</p>
                  </div>
                  <div class="pending-requests-list hidden" id="pd-pending-requests-list">
                    <!-- Pending requests populated by JS -->
                  </div>
                </div>
              </div>

              <!-- File Detail Modal -->
              <div class="file-detail-modal hidden" id="file-detail-modal">
                <div class="file-detail-content portal-shadow">
                  <div class="file-detail-header">
                    <h2 id="file-detail-name">File Name</h2>
                    <button class="btn-icon close-modal" id="close-file-detail">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                  </div>
                  <div class="file-detail-tabs">
                    <button class="active" data-tab="info">Info</button>
                    <button data-tab="versions">Versions</button>
                    <button data-tab="comments">Comments</button>
                    <button data-tab="access">Access Log</button>
                  </div>
                  <div class="file-detail-tab-content active" data-tab-content="info">
                    <div class="file-info-grid" id="file-info-content">
                      <!-- File info populated by JS -->
                    </div>
                  </div>
                  <div class="file-detail-tab-content" data-tab-content="versions">
                    <div class="file-versions-list" id="file-versions-list">
                      <!-- Versions populated by JS -->
                    </div>
                  </div>
                  <div class="file-detail-tab-content" data-tab-content="comments">
                    <div class="file-comments-list" id="file-comments-list">
                      <!-- Comments populated by JS -->
                    </div>
                    <div class="file-comment-form">
                      <label for="file-comment-input" class="sr-only">Add a comment</label>
                      <textarea id="file-comment-input" placeholder="Add a comment..." rows="2" aria-label="Add a comment"></textarea>
                      <button class="btn btn-secondary btn-sm" id="btn-add-file-comment">Add Comment</button>
                    </div>
                  </div>
                  <div class="file-detail-tab-content" data-tab-content="access">
                    <div class="file-access-log" id="file-access-log">
                      <!-- Access log populated by JS -->
                    </div>
                  </div>
                  <div class="file-detail-actions">
                    <button class="btn btn-secondary" id="btn-download-file">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                      Download
                    </button>
                    <button class="btn btn-secondary" id="btn-lock-file">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                      Lock
                    </button>
                    <button class="btn btn-secondary" id="btn-share-file">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
                      Share with Client
                    </button>
                    <button class="btn btn-danger" id="btn-delete-file">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                      Delete
                    </button>
                  </div>
                </div>
              </div>
            </div>

              <!-- Messages Sub-Tab -->
            <div class="portal-tab-panel" id="pd-tab-messages">
              <h3 class="tab-section-heading">Messages</h3>
              <div class="messages-container portal-shadow">
                <div class="messages-thread" id="pd-messages-thread" aria-live="polite" aria-atomic="false" aria-label="Project messages thread">
                  <p class="empty-state">
                    No messages yet. Start the conversation with your client.
                  </p>
                </div>

                <div class="message-compose">
                  <div class="message-input-wrapper">
                    <label for="pd-message-input" class="sr-only">Message</label>
                    <textarea
                      id="pd-message-input"
                      class="form-textarea"
                      placeholder="Type your message to the client..."
                      aria-label="Type your message to the client"
                    ></textarea>
                  </div>
                  <button class="btn btn-secondary" id="btn-pd-send-message">Send Message</button>
                </div>
              </div>
            </div>

            <!-- Invoices Sub-Tab -->
            <div class="portal-tab-panel" id="pd-tab-invoices">
              <h3 class="tab-section-heading">Invoices</h3>
              <!-- Invoice Summary -->
              <div class="invoice-summary">
                <div class="summary-card portal-shadow">
                  <span class="summary-label">Total Outstanding</span>
                  <span class="summary-value" id="pd-outstanding">$0.00</span>
                </div>
                <div class="summary-card portal-shadow">
                  <span class="summary-label">Total Paid</span>
                  <span class="summary-value" id="pd-paid">$0.00</span>
                </div>
              </div>

              <!-- Invoice Actions -->
              <div class="portal-project-card portal-shadow">
                <div class="card-header-with-action">
                  <h3>Invoices</h3>
                  <div class="invoice-action-buttons">
                    <div id="pd-invoices-filter" class="invoice-filter-container"></div>
                    <button class="btn btn-outline" id="btn-process-late-fees" title="Apply late fees to overdue invoices">
                      Apply Late Fees
                    </button>
                    <button class="btn btn-secondary" id="btn-create-invoice">
                      + Create Invoice
                    </button>
                  </div>
                </div>
                <div class="invoices-list" id="pd-invoices-list">
                  <p class="empty-state">No invoices created yet.</p>
                </div>
              </div>

              <!-- Payment Plans & Recurring -->
              <div class="portal-project-card portal-shadow">
                <div class="card-header-with-action">
                  <h3>Payment Plans & Recurring</h3>
                  <div class="invoice-action-buttons">
                    <button class="btn btn-outline" id="btn-schedule-invoice">Schedule Invoice</button>
                    <button class="btn btn-outline" id="btn-setup-recurring">Setup Recurring</button>
                  </div>
                </div>
                <div class="payment-plans-section">
                  <h4>Scheduled Invoices</h4>
                  <div id="pd-scheduled-invoices" class="scheduled-list">
                    <p class="empty-state">No scheduled invoices.</p>
                  </div>
                  <h4>Recurring Invoices</h4>
                  <div id="pd-recurring-invoices" class="recurring-list">
                    <p class="empty-state">No recurring invoices configured.</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Tasks Sub-Tab -->
            <div class="portal-tab-panel" id="pd-tab-tasks">
              <h3 class="tab-section-heading">Tasks</h3>
              <div class="portal-project-card portal-shadow">
                <div class="card-header-with-action">
                  <div class="view-toggle-container">
                    <div id="tasks-view-toggle-mount"></div>
                    <button class="btn btn-secondary" id="btn-add-task">
                      + Add Task
                    </button>
                  </div>
                </div>
                <div id="tasks-kanban-container"></div>
                <div id="tasks-list-container" style="display: none;"></div>
              </div>
            </div>

            <!-- Time Tracking Sub-Tab -->
            <div class="portal-tab-panel" id="pd-tab-time">
              <h3 class="tab-section-heading">Time Tracking</h3>
              <div class="time-tracking-header">
                <div>
                  <button class="btn btn-secondary" id="btn-log-time">
                    + Log Time
                  </button>
                  <button class="btn btn-outline" id="btn-export-time">
                    Export CSV
                  </button>
                </div>
              </div>

              <div class="time-tracking-summary" id="time-tracking-summary">
                <!-- Summary cards rendered by JS -->
              </div>

              <div class="time-weekly-chart">
                <h4>This Week</h4>
                <div id="time-weekly-chart-container"></div>
              </div>

              <div class="portal-project-card portal-shadow">
                <h3>Time Entries</h3>
                <div id="time-entries-list">
                  <p class="empty-state">No time entries yet.</p>
                </div>
              </div>
            </div>

            <!-- Contract Sub-Tab -->
            <div class="portal-tab-panel" id="pd-tab-contract">
              <h3 class="tab-section-heading">Contract</h3>
              <div class="contract-tab-content">
                <!-- Contract Status Card -->
                <div class="portal-project-card portal-shadow">
                  <div class="contract-status-display">
                    <div class="contract-status-info">
                      <div class="status-item">
                        <span class="field-label">Status</span>
                        <span class="status-badge" id="pd-contract-status-badge">Not Signed</span>
                      </div>
                      <div class="status-item" id="pd-contract-signed-info" style="display: none;">
                        <span class="field-label">Signed On</span>
                        <span class="meta-value" id="pd-contract-date">-</span>
                      </div>
                      <div class="status-item" id="pd-contract-countersigned-info" style="display: none;">
                        <span class="field-label">Countersigned On</span>
                        <span class="meta-value" id="pd-contract-countersigned-date">-</span>
                      </div>
                      <div class="status-item" id="pd-contract-requested-info" style="display: none;">
                        <span class="field-label">Signature Requested</span>
                        <span class="meta-value" id="pd-contract-requested-date">-</span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Contract Actions Card -->
                <div class="portal-project-card portal-shadow">
                  <h3>Contract Document</h3>
                  <p class="contract-description">Preview, download, or request a signature for this project's contract.</p>
                  <div class="contract-actions-grid">
                    <a href="#" id="pd-contract-preview-btn" target="_blank" class="contract-action-card">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
                      <span>Preview Contract</span>
                    </a>
                    <a href="#" id="pd-contract-download-btn" class="contract-action-card" download>
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                      <span>Download PDF</span>
                    </a>
                    <button type="button" id="pd-contract-sign-btn" class="contract-action-card primary">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                      <span id="pd-contract-sign-btn-text">Request Signature</span>
                    </button>
                    <button type="button" id="pd-contract-countersign-btn" class="contract-action-card" style="display: none;">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 20h4"/><path d="M2 16c3-1 6-4 7-7 1-3 4-6 7-7"/><path d="M13 7l4 4"/><path d="M19 3l2 2"/></svg>
                      <span>Countersign</span>
                    </button>
                  </div>
                </div>

                <!-- Contract Builder Card -->
                <div class="portal-project-card portal-shadow">
                  <div class="card-header-with-action">
                    <div>
                      <h3>Contract Builder</h3>
                      <p class="contract-description">Build a draft, pull from templates, and preview before sending.</p>
                    </div>
                    <button type="button" class="btn btn-secondary" id="pd-contract-builder-btn">
                      Open Builder
                    </button>
                  </div>
                  <div class="contract-builder-meta">
                    <div class="status-item">
                      <span class="field-label">Template</span>
                      <span class="meta-value" id="pd-contract-template-label">Not selected</span>
                    </div>
                    <div class="status-item">
                      <span class="field-label">Draft</span>
                      <span class="meta-value" id="pd-contract-draft-status">No draft yet</span>
                    </div>
                  </div>
                </div>

                <!-- Signature History (shown when signed) -->
                <div class="portal-project-card portal-shadow" id="pd-contract-signature-card" style="display: none;">
                  <h3>Signature Details</h3>
                  <div class="signature-details">
                    <div class="signature-info-row">
                      <span class="field-label">Signed By</span>
                      <span class="meta-value" id="pd-contract-signer">-</span>
                    </div>
                    <div class="signature-info-row">
                      <span class="field-label">Date & Time</span>
                      <span class="meta-value" id="pd-contract-signed-datetime">-</span>
                    </div>
                    <div class="signature-info-row" id="pd-contract-countersign-row" style="display: none;">
                      <span class="field-label">Countersigned By</span>
                      <span class="meta-value" id="pd-contract-countersigner">-</span>
                    </div>
                    <div class="signature-info-row" id="pd-contract-countersign-date-row" style="display: none;">
                      <span class="field-label">Countersigned At</span>
                      <span class="meta-value" id="pd-contract-countersigned-datetime">-</span>
                    </div>
                    <div class="signature-info-row">
                      <span class="field-label">IP Address</span>
                      <span class="meta-value" id="pd-contract-signer-ip">-</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Notes Sub-Tab -->
            <div class="portal-tab-panel" id="pd-tab-notes">
              <h3 class="tab-section-heading">Project Notes</h3>
              <div class="portal-project-card portal-shadow">
                <div class="card-header-with-action">
                  <h3>Admin Notes (Internal)</h3>
                  <button class="btn btn-secondary btn-sm" id="btn-edit-project-notes">
                    Edit Notes
                  </button>
                </div>
                <div id="pd-notes-display" class="notes-display">
                  <p class="empty-state">No notes yet. Click "Edit Notes" to add internal notes about this project.</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Workflows Tab (Approvals + Triggers) -->
          <div class="tab-content" id="tab-workflows">
            <!-- Pending Approvals Dashboard -->
            <div id="pending-approvals-section" class="approval-dashboard-section">
              <div class="quick-stats">
                <button class="stat-card stat-card-clickable portal-shadow" data-approval-filter="all">
                  <span class="stat-number" id="approvals-total">-</span>
                  <span class="stat-label">Total Active</span>
                </button>
                <button class="stat-card stat-card-clickable portal-shadow" data-approval-filter="pending">
                  <span class="stat-number" id="approvals-pending">-</span>
                  <span class="stat-label">Pending</span>
                </button>
                <button class="stat-card stat-card-clickable portal-shadow" data-approval-filter="in_progress">
                  <span class="stat-number" id="approvals-in-progress">-</span>
                  <span class="stat-label">In Progress</span>
                </button>
                <button class="stat-card stat-card-clickable portal-shadow" data-approval-filter="approved">
                  <span class="stat-number" id="approvals-approved">-</span>
                  <span class="stat-label">Approved</span>
                </button>
              </div>

              <div class="admin-table-card portal-shadow" id="pending-approvals-card">
                <div class="admin-table-header">
                  <h3>Pending Approvals</h3>
                  <div class="admin-table-actions">
                    <button type="button" class="icon-btn" id="approvals-refresh" title="Refresh" aria-label="Refresh approvals">
                      <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg></span>
                    </button>
                  </div>
                </div>
                <!-- Bulk Action Toolbar -->
                <div class="bulk-action-toolbar hidden" id="approvals-bulk-toolbar">
                  <div class="bulk-toolbar-left">
                    <div class="bulk-selection-count">
                      <strong id="approvals-selected-count">0</strong> selected
                      <button type="button" class="bulk-clear-selection" id="bulk-clear-btn">Clear</button>
                    </div>
                  </div>
                  <div class="bulk-toolbar-actions">
                    <button type="button" class="btn btn-sm btn-success" id="bulk-approve-btn">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                      Approve All
                    </button>
                    <button type="button" class="btn btn-sm btn-danger" id="bulk-reject-btn">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                      Reject All
                    </button>
                  </div>
                </div>
                <div class="admin-table-container">
                  <div class="admin-table-scroll-wrapper">
                    <table class="admin-table" aria-label="Pending approvals">
                      <thead>
                        <tr>
                          <th scope="col" class="checkbox-col">
                            <div class="portal-checkbox">
                              <input type="checkbox" id="approvals-select-all" aria-label="Select all approvals" />
                            </div>
                          </th>
                          <th scope="col" class="type-col">Entity</th>
                          <th scope="col" class="name-col">Name</th>
                          <th scope="col" class="type-col">Workflow</th>
                          <th scope="col" class="status-col">Status</th>
                          <th scope="col" class="date-col">Initiated</th>
                          <th scope="col" class="actions-col">Actions</th>
                        </tr>
                      </thead>
                      <tbody id="pending-approvals-table-body" aria-live="polite" aria-atomic="false" aria-relevant="additions removals">
                        <tr><td colspan="7" class="loading-row">Loading approvals...</td></tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <!-- Approvals Content (Workflow Definitions) -->
            <div id="workflows-approvals-content">
              <div class="admin-table-card portal-shadow">
                <div class="admin-table-header">
                  <h3>Approval Workflows</h3>
                  <div class="admin-table-actions">
                    <button type="button" class="icon-btn" id="workflows-refresh" title="Refresh" aria-label="Refresh workflows">
                      <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg></span>
                    </button>
                    <button type="button" class="icon-btn" id="create-workflow-btn" title="Create Workflow" aria-label="Create Workflow">
                      <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M5 12h14"/><path d="M12 5v14"/></svg></span>
                    </button>
                  </div>
                </div>
                <div class="admin-table-container">
                  <div class="admin-table-scroll-wrapper">
                    <table class="admin-table" aria-label="Approval workflows">
                      <thead>
                        <tr>
                          <th scope="col" class="name-col">Name</th>
                          <th scope="col" class="type-col">Entity Type</th>
                          <th scope="col" class="type-col">Workflow Type</th>
                          <th scope="col" class="status-col">Status</th>
                          <th scope="col" class="date-col">Updated</th>
                          <th scope="col" class="actions-col">Actions</th>
                        </tr>
                      </thead>
                      <tbody id="workflows-table-body" aria-live="polite" aria-atomic="false" aria-relevant="additions removals">
                        <tr><td colspan="6" class="loading-row">Loading workflows...</td></tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <!-- Triggers Content -->
            <div id="workflows-triggers-content" class="hidden">
              <div class="admin-table-card portal-shadow">
                <div class="admin-table-header">
                  <h3>Event Triggers</h3>
                  <div class="admin-table-actions">
                    <button type="button" class="icon-btn" id="view-trigger-logs-btn" title="View Execution Logs" aria-label="View Execution Logs">
                      <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg></span>
                    </button>
                    <button type="button" class="icon-btn" id="triggers-refresh" title="Refresh" aria-label="Refresh triggers">
                      <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg></span>
                    </button>
                    <button type="button" class="icon-btn" id="create-trigger-btn" title="Create Trigger" aria-label="Create Trigger">
                      <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M5 12h14"/><path d="M12 5v14"/></svg></span>
                    </button>
                  </div>
                </div>
                <div class="admin-table-container">
                  <div class="admin-table-scroll-wrapper">
                    <table class="admin-table" aria-label="Event triggers">
                      <thead>
                        <tr>
                          <th scope="col" class="name-col">Name</th>
                          <th scope="col" class="type-col">Event</th>
                          <th scope="col" class="type-col">Action</th>
                          <th scope="col" class="status-col">Status</th>
                          <th scope="col" class="date-col">Updated</th>
                          <th scope="col" class="actions-col">Actions</th>
                        </tr>
                      </thead>
                      <tbody id="triggers-table-body" aria-live="polite" aria-atomic="false" aria-relevant="additions removals">
                        <tr><td colspan="6" class="loading-row">Loading triggers...</td></tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <!-- Email Templates Content -->
            <div id="workflows-email-templates-content" class="hidden">
              <div class="admin-table-card portal-shadow">
                <div class="admin-table-header">
                  <h3>Email Templates</h3>
                  <div class="admin-table-actions">
                    <button type="button" class="icon-btn" id="email-templates-refresh" title="Refresh" aria-label="Refresh templates">
                      <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg></span>
                    </button>
                    <button type="button" class="icon-btn" id="create-email-template-btn" title="Create Template" aria-label="Create Template">
                      <span class="icon-btn-svg"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M5 12h14"/><path d="M12 5v14"/></svg></span>
                    </button>
                  </div>
                </div>
                <!-- Category filter tabs -->
                <div class="template-category-tabs">
                  <button class="template-category-tab active" data-category="all">All</button>
                  <button class="template-category-tab" data-category="notification">Notification</button>
                  <button class="template-category-tab" data-category="invoice">Invoice</button>
                  <button class="template-category-tab" data-category="contract">Contract</button>
                  <button class="template-category-tab" data-category="project">Project</button>
                  <button class="template-category-tab" data-category="reminder">Reminder</button>
                </div>
                <div class="admin-table-container">
                  <div class="admin-table-scroll-wrapper">
                    <table class="admin-table" aria-label="Email templates">
                      <thead>
                        <tr>
                          <th scope="col" class="name-col">Name</th>
                          <th scope="col" class="type-col">Category</th>
                          <th scope="col" class="subject-col">Subject</th>
                          <th scope="col" class="status-col">Status</th>
                          <th scope="col" class="date-col">Updated</th>
                          <th scope="col" class="actions-col">Actions</th>
                        </tr>
                      </thead>
                      <tbody id="email-templates-table-body" aria-live="polite" aria-atomic="false" aria-relevant="additions removals">
                        <tr><td colspan="6" class="loading-row">Loading templates...</td></tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      </div> <!-- Close portal-body -->
    </div>

    <!-- Details Overlay (darkens page when panel is open) -->
    <div class="details-overlay hidden" id="details-overlay" onclick="window.closeDetailsPanel && window.closeDetailsPanel()"></div>

    <!-- Lead Details Panel (Hidden by default) -->
    <div class="details-panel hidden" id="lead-details-panel"></div>

    <!-- Contact Details Panel (Hidden by default) -->
    <div class="details-panel hidden" id="contact-details-panel"></div>

    <!-- Detail Modal for Leads/Contacts -->
    <div class="admin-modal-overlay hidden" id="detail-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <div class="admin-modal">
        <div class="admin-modal-header">
          <div class="admin-modal-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
            <h2 id="modal-title">Details</h2>
          </div>
          <button class="admin-modal-close" id="modal-close-btn" aria-label="Close modal">
            &times;
          </button>
        </div>
        <div class="admin-modal-body" id="modal-body">
          <!-- Dynamic content will be inserted here -->
        </div>
        <div class="admin-modal-footer">
          <button class="btn btn-secondary" id="modal-close-btn-footer">Close</button>
        </div>
      </div>
    </div>

    <!-- Add Client Modal -->
    <div class="admin-modal-overlay hidden" id="add-client-modal" role="dialog" aria-modal="true" aria-labelledby="add-client-modal-title">
      <div class="admin-modal">
        <div class="admin-modal-header">
          <div class="admin-modal-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" x2="19" y1="8" y2="14"/><line x1="22" x2="16" y1="11" y2="11"/></svg>
            <h2 id="add-client-modal-title">Add New Client</h2>
          </div>
          <button class="admin-modal-close" id="add-client-modal-close" aria-label="Close modal">
            &times;
          </button>
        </div>
        <form id="add-client-form">
          <div class="admin-modal-body">
            <fieldset>
              <legend>Contact Information</legend>
              <div class="form-group">
                <label class="field-label" for="new-client-email">Email *</label>
                <input type="email" id="new-client-email" class="form-input" placeholder="client@example.com" required />
              </div>
              <div class="form-group">
                <label class="field-label" for="new-client-name">Contact Name</label>
                <input type="text" id="new-client-name" class="form-input" placeholder="John Smith" />
              </div>
              <div class="form-group">
                <label class="field-label" for="new-client-company">Company Name</label>
                <input type="text" id="new-client-company" class="form-input" placeholder="Acme Inc." />
              </div>
              <div class="form-group">
                <label class="field-label" for="new-client-phone">Phone</label>
                <input type="tel" id="new-client-phone" class="form-input" placeholder="(555) 123-4567" />
              </div>
            </fieldset>
          </div>
          <div class="admin-modal-footer">
            <button type="button" class="btn btn-secondary" id="add-client-cancel">Cancel</button>
            <button type="submit" class="btn btn-primary">Add Client</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Add Project Modal -->
    <div class="admin-modal-overlay hidden" id="add-project-modal" role="dialog" aria-modal="true" aria-labelledby="add-project-modal-title">
      <div class="admin-modal">
        <div class="admin-modal-header">
          <div class="admin-modal-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 10v6"/><path d="M9 13h6"/><path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2h16Z"/></svg>
            <h2 id="add-project-modal-title">Add New Project</h2>
          </div>
          <button class="admin-modal-close" id="add-project-modal-close" aria-label="Close modal">
            &times;
          </button>
        </div>
        <form id="add-project-form">
          <div class="admin-modal-body">
            <!-- Client Selection -->
            <div class="form-group">
              <label class="field-label" for="new-project-client">Client *</label>
              <div id="new-project-client-mount"></div>
            </div>

            <!-- New Client Fields (hidden by default) -->
            <fieldset id="new-client-fields" class="hidden">
              <legend>New Client Details</legend>
              <div class="form-group">
                <label class="field-label" for="new-project-client-name">Contact Name *</label>
                <input type="text" id="new-project-client-name" class="form-input" placeholder="John Smith" />
              </div>
              <div class="form-group">
                <label class="field-label" for="new-project-client-email">Email *</label>
                <input type="email" id="new-project-client-email" class="form-input" placeholder="client@example.com" />
              </div>
              <div class="form-group">
                <label class="field-label" for="new-project-client-company">Company Name</label>
                <input type="text" id="new-project-client-company" class="form-input" placeholder="Acme Inc." />
              </div>
              <div class="form-group">
                <label class="field-label" for="new-project-client-phone">Phone</label>
                <input type="tel" id="new-project-client-phone" class="form-input" placeholder="(555) 123-4567" />
              </div>
            </fieldset>

            <!-- Project Fields -->
            <div class="form-group">
              <label class="field-label" for="new-project-type">Project Type *</label>
              <div id="new-project-type-mount"></div>
            </div>
            <div class="form-group">
              <label class="field-label" for="new-project-description">Description *</label>
              <textarea id="new-project-description" class="form-textarea" rows="3" placeholder="Brief project description..." required></textarea>
            </div>
            <div class="form-group">
              <label class="field-label" for="new-project-budget">Budget *</label>
              <div id="new-project-budget-mount"></div>
            </div>
            <div class="form-group">
              <label class="field-label" for="new-project-timeline">Timeline *</label>
              <div id="new-project-timeline-mount"></div>
            </div>
            <div class="form-group">
              <label class="field-label" for="new-project-notes">Additional Notes</label>
              <textarea id="new-project-notes" class="form-textarea" rows="2" placeholder="Any additional details..."></textarea>
            </div>
          </div>
          <div class="admin-modal-footer">
            <button type="button" class="btn btn-secondary" id="add-project-cancel">Cancel</button>
            <button type="submit" class="btn btn-primary">Add Project</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Edit Client Info Modal -->
    <div class="admin-modal-overlay hidden" id="edit-client-info-modal" role="dialog" aria-modal="true" aria-labelledby="edit-client-info-title">
      <div class="admin-modal">
        <div class="admin-modal-header">
          <div class="admin-modal-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
            <h2 id="edit-client-info-title">Edit Client Info</h2>
          </div>
          <button class="admin-modal-close" id="edit-client-info-close" aria-label="Close modal">
            &times;
          </button>
        </div>
        <form id="edit-client-info-form">
          <div class="admin-modal-body">
            <div class="form-group">
              <label class="field-label" for="edit-client-email">Email</label>
              <input type="email" id="edit-client-email" class="form-input" placeholder="client@example.com" />
            </div>
            <div class="form-group">
              <label class="field-label" for="edit-client-name">Contact Name</label>
              <input type="text" id="edit-client-name" class="form-input" placeholder="John Smith" />
            </div>
            <div class="form-group">
              <label class="field-label" for="edit-client-company">Company Name</label>
              <input type="text" id="edit-client-company" class="form-input" placeholder="Acme Inc." />
            </div>
            <div class="form-group">
              <label class="field-label" for="edit-client-phone">Phone</label>
              <input type="tel" id="edit-client-phone" class="form-input" placeholder="(555) 123-4567" />
            </div>
            <div class="form-group">
              <label class="field-label" for="edit-client-status">Status</label>
              <div id="edit-client-status-mount"></div>
            </div>
          </div>
          <div class="admin-modal-footer">
            <button type="button" class="btn btn-secondary" id="edit-client-info-cancel">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Edit Billing Details Modal -->
    <div class="admin-modal-overlay hidden" id="edit-billing-modal" role="dialog" aria-modal="true" aria-labelledby="edit-billing-title">
      <div class="admin-modal">
        <div class="admin-modal-header">
          <div class="admin-modal-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
            <h2 id="edit-billing-title">Edit Billing Details</h2>
          </div>
          <button class="admin-modal-close" id="edit-billing-close" aria-label="Close modal">
            &times;
          </button>
        </div>
        <form id="edit-billing-form">
          <div class="admin-modal-body">
            <div class="form-group">
              <label class="field-label" for="edit-billing-name">Billing Name</label>
              <input type="text" id="edit-billing-name" class="form-input" placeholder="John Smith" />
            </div>
            <div class="form-group">
              <label class="field-label" for="edit-billing-email">Billing Email</label>
              <input type="email" id="edit-billing-email" class="form-input" placeholder="billing@example.com" />
            </div>
            <div class="form-group">
              <label class="field-label" for="edit-billing-address">Address</label>
              <input type="text" id="edit-billing-address" class="form-input" placeholder="123 Main St" />
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="field-label" for="edit-billing-city">City</label>
                <input type="text" id="edit-billing-city" class="form-input" placeholder="New York" />
              </div>
              <div class="form-group">
                <label class="field-label" for="edit-billing-state">State/Province</label>
                <input type="text" id="edit-billing-state" class="form-input" placeholder="NY" />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="field-label" for="edit-billing-zip">ZIP/Postal Code</label>
                <input type="text" id="edit-billing-zip" class="form-input" placeholder="10001" />
              </div>
              <div class="form-group">
                <label class="field-label" for="edit-billing-country">Country</label>
                <input type="text" id="edit-billing-country" class="form-input" placeholder="USA" />
              </div>
            </div>
          </div>
          <div class="admin-modal-footer">
            <button type="button" class="btn btn-secondary" id="edit-billing-cancel">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Edit Project Modal -->
    <div class="admin-modal-overlay hidden" id="edit-project-modal" role="dialog" aria-modal="true" aria-labelledby="edit-project-modal-title">
      <div class="admin-modal">
        <div class="admin-modal-header">
          <div class="admin-modal-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
            <h2 id="edit-project-modal-title">Edit Project</h2>
          </div>
          <button class="admin-modal-close" id="edit-project-close" aria-label="Close modal">
            &times;
          </button>
        </div>
        <form id="edit-project-form">
          <div class="admin-modal-body">
            <!-- Project Basics -->
            <div class="form-group">
              <label class="field-label" for="edit-project-name">Project Name</label>
              <input type="text" id="edit-project-name" class="form-input" placeholder="Project Name" />
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="field-label" for="edit-project-type">Project Type</label>
                <div id="edit-project-type-mount"></div>
              </div>
              <div class="form-group">
                <label class="field-label" for="edit-project-status">Status</label>
                <div id="edit-project-status-mount"></div>
              </div>
            </div>

            <!-- Timeline -->
            <div class="form-group">
              <label class="field-label" for="edit-project-timeline">Timeline</label>
              <input type="text" id="edit-project-timeline" class="form-input" placeholder="4-6 weeks" />
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="field-label" for="edit-project-start-date">Start Date</label>
                <input type="date" id="edit-project-start-date" class="form-input" />
              </div>
              <div class="form-group">
                <label class="field-label" for="edit-project-end-date">Target End Date</label>
                <input type="date" id="edit-project-end-date" class="form-input" />
              </div>
            </div>

            <!-- Description -->
            <div class="form-group">
              <label class="field-label" for="edit-project-description">Project Description</label>
              <textarea id="edit-project-description" class="form-textarea" rows="4" placeholder="Describe the project scope and requirements..."></textarea>
            </div>

            <!-- Financial -->
            <div class="form-row">
              <div class="form-group">
                <label class="field-label" for="edit-project-budget">Client Budget</label>
                <input type="text" id="edit-project-budget" class="form-input" placeholder="Under 1k, 1000-2500, etc." />
              </div>
              <div class="form-group">
                <label class="field-label" for="edit-project-price">Quoted Price</label>
                <input type="text" id="edit-project-price" class="form-input" placeholder="$7,500" />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="field-label" for="edit-project-deposit">Deposit Amount</label>
                <input type="text" id="edit-project-deposit" class="form-input" placeholder="$1,000" />
              </div>
              <div class="form-group">
                <label class="field-label" for="edit-project-contract-date">Contract Signed</label>
                <input type="date" id="edit-project-contract-date" class="form-input" />
              </div>
            </div>

            <!-- URLs -->
            <div class="form-group">
              <label class="field-label" for="edit-project-preview-url">Preview URL</label>
              <input type="url" id="edit-project-preview-url" class="form-input" placeholder="https://preview.example.com" />
            </div>
            <div class="form-group">
              <label class="field-label" for="edit-project-repo-url">Repository URL</label>
              <input type="url" id="edit-project-repo-url" class="form-input" placeholder="https://github.com/..." />
            </div>
            <div class="form-group">
              <label class="field-label" for="edit-project-production-url">Production URL</label>
              <input type="url" id="edit-project-production-url" class="form-input" placeholder="https://example.com" />
            </div>
            <div class="form-group">
              <label class="field-label" for="edit-project-notes">Admin Notes (internal)</label>
              <textarea id="edit-project-notes" class="form-textarea" rows="3" placeholder="Internal notes not visible to client..."></textarea>
            </div>
          </div>
          <div class="admin-modal-footer">
            <button type="button" class="btn btn-secondary" id="edit-project-cancel">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Footer - Only visible on login page -->
    <footer class="footer admin-footer">
      <div class="footer-content">
        <p>&copy; <span id="admin-copyright-year"></span> No Bhad Codes. All rights reserved.</p>
      </div>
    </footer>
    <script>
      document.getElementById('admin-copyright-year').textContent = new Date().getFullYear();
    </script>
  </body>
</html>
