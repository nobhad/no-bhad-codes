const c={TIMERS:{FORM_AUTOSAVE:3e4,PAGE_TRANSITION:600,ANIMATION_DURATION:300,DEBOUNCE_DEFAULT:300,TOKEN_REFRESH_CHECK:5184e5,PERFORMANCE_MONITORING:3e4,INTEGRITY_CHECK:3e3,RATE_LIMIT_WINDOW:3e5},PERFORMANCE:{FCP_GOOD:1800,FCP_NEEDS_WORK:3e3,LOAD_GOOD:3e3,LOAD_NEEDS_WORK:5e3},RATE_LIMITS:{FORM_SUBMISSIONS:5,LOGIN_ATTEMPTS:3,API_REQUESTS:100},PROJECT_COLORS:{pending:"#FFA500","in-progress":"#3B82F6","in-review":"#8B5CF6",completed:"#10B981","on-hold":"#6B7280",default:"#6B7280"},THEME:{PRIMARY:"var(--color-primary, #00ff41)",SECONDARY:"var(--color-secondary, #ff6b6b)",DARK:"var(--color-dark, #000000)",LIGHT:"var(--color-light, #ffffff)",NEUTRAL:"var(--color-neutral-400, #6B7280)"},STORAGE_KEYS:{AUTH_TOKEN:"auth_token",AUTH_USER:"auth_user",THEME:"theme",FORM_BACKUP:"form_backup_"},API:{TIMEOUT:1e4,RETRY_ATTEMPTS:3,RETRY_DELAY:1e3},UPLOAD:{MAX_FILE_SIZE:10485760,MAX_FILES:5,ALLOWED_TYPES:["jpeg","jpg","png","pdf","doc","docx","txt","zip","rar"]},SECURITY:{PASSWORD_MIN_LENGTH:8,SESSION_TIMEOUT:864e5,CSRF_TOKEN_LENGTH:32},EASING:{DEFAULT:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",SMOOTH:"cubic-bezier(0.4, 0, 0.2, 1)",BOUNCE:"cubic-bezier(0.68, -0.55, 0.265, 1.55)"},BREAKPOINTS:{MOBILE:768,TABLET:1024,DESKTOP:1200,LARGE:1440},PATTERNS:{EMAIL:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,PHONE:/^[+]?[1-9][\d]{0,15}$/,URL:/^https?:\/\/.+/}};class S{constructor(e){this.metrics={},this.observers=[],this.alerts=[],this.isMonitoring=!1,this.budget={lcp:c.PERFORMANCE.FCP_GOOD,fid:100,cls:.1,bundleSize:600*1024,ttfb:200,...e}}async init(){{console.log("[PerformanceService] Skipping monitoring in development mode");return}}async startMonitoring(){this.isMonitoring||(this.isMonitoring=!0,await this.measureCoreWebVitals(),await this.measureLoadingPerformance(),await this.measureJavaScriptPerformance(),this.monitorMemoryUsage(),this.measureNetworkPerformance(),this.setupContinuousMonitoring(),console.log("[PerformanceService] Monitoring started"))}async measureCoreWebVitals(){if("PerformanceObserver"in window){try{const e=new PerformanceObserver(t=>{const s=t.getEntries(),i=s[s.length-1];this.metrics.lcp=i.startTime||0,this.metrics.lcp!==void 0&&this.checkBudget("lcp",this.metrics.lcp),console.log("[Performance] LCP:",this.metrics.lcp)});e.observe({entryTypes:["largest-contentful-paint"]}),this.observers.push(e)}catch{console.warn("[PerformanceService] LCP monitoring not supported")}try{const e=new PerformanceObserver(t=>{t.getEntries().forEach(i=>{this.metrics.fid=i.processingStart-i.startTime,this.checkBudget("fid",this.metrics.fid),console.log("[Performance] FID:",this.metrics.fid)})});e.observe({entryTypes:["first-input"]}),this.observers.push(e)}catch{console.warn("[PerformanceService] FID monitoring not supported")}try{let e=0;const t=new PerformanceObserver(s=>{s.getEntries().forEach(n=>{n.hadRecentInput||(e+=n.value)}),this.metrics.cls=e,this.checkBudget("cls",this.metrics.cls)});t.observe({entryTypes:["layout-shift"]}),this.observers.push(t)}catch{console.warn("[PerformanceService] CLS monitoring not supported")}}}async measureLoadingPerformance(){if(performance.timing){const e=performance.timing;this.metrics.ttfb=e.responseStart-e.requestStart,this.metrics.domContentLoaded=e.domContentLoadedEventEnd-e.navigationStart,this.metrics.loadComplete=e.loadEventEnd-e.navigationStart,this.checkBudget("ttfb",this.metrics.ttfb)}if("PerformanceObserver"in window)try{const e=new PerformanceObserver(t=>{t.getEntries().forEach(i=>{i.name==="first-contentful-paint"&&(this.metrics.fcp=i.startTime,console.log("[Performance] FCP:",this.metrics.fcp))})});e.observe({entryTypes:["paint"]}),this.observers.push(e)}catch{console.warn("[PerformanceService] Paint timing not supported")}}async measureJavaScriptPerformance(){if(performance.getEntriesByType){const t=performance.getEntriesByType("resource");let s=0;t.forEach(i=>{(i.name.includes(".js")||i.name.includes("/src/"))&&(s+=i.transferSize||i.decodedBodySize||0)}),this.metrics.bundleSize=s,this.checkBudget("bundleSize",s),console.log("[Performance] Estimated bundle size:",s)}const e=performance.now();await new Promise(t=>setTimeout(t,0)),this.metrics.parseTime=performance.now()-e}monitorMemoryUsage(){if("memory"in performance){const e=performance.memory;this.metrics.memoryUsage={used:e.usedJSHeapSize,total:e.totalJSHeapSize,limit:e.jsHeapSizeLimit};const t=e.usedJSHeapSize/e.jsHeapSizeLimit;t>.8&&this.addAlert({type:"warning",metric:"memoryUsage",value:t*100,threshold:80,message:"High memory usage detected",suggestions:["Review memory leaks in event listeners","Check for retained DOM references","Consider reducing bundle size"]})}}measureNetworkPerformance(){const e=navigator.connection;e&&(this.metrics.connectionType=e.effectiveType,this.metrics.downloadSpeed=e.downlink)}setupContinuousMonitoring(){setInterval(()=>{this.monitorMemoryUsage(),this.measureNetworkPerformance()},c.TIMERS.PERFORMANCE_MONITORING),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&this.recordCustomMetric("pageVisibilityResume",performance.now())})}checkBudget(e,t){const s=this.budget[e];if(t>s){const i=this.getSuggestions(e,t);this.addAlert({type:t>s*1.5?"error":"warning",metric:e,value:t,threshold:s,message:`${e.toUpperCase()} exceeded budget`,suggestions:i})}}getSuggestions(e,t){return{lcp:["Optimize images with modern formats (WebP, AVIF)","Implement critical CSS inlining","Use CDN for faster asset delivery","Preload key resources"],fid:["Minimize JavaScript execution time","Code split large bundles","Use web workers for heavy computations","Defer non-critical JavaScript"],cls:["Set explicit dimensions for images and videos","Avoid inserting content above existing content","Use CSS transforms instead of properties that trigger layout","Reserve space for dynamic content"],ttfb:["Optimize server response time","Use CDN for faster delivery","Implement proper caching strategies","Minimize server-side processing"],bundleSize:["Enable tree shaking","Split bundles by route","Remove unused dependencies","Use dynamic imports for code splitting"]}[e]||["Consider optimizing this metric"]}addAlert(e){this.alerts.push(e),e.type==="error"?console.error(`[Performance ${e.type.toUpperCase()}]`,e.message,{value:e.value,threshold:e.threshold,suggestions:e.suggestions}):console.warn(`[Performance ${e.type.toUpperCase()}]`,e.message,{value:e.value,threshold:e.threshold,suggestions:e.suggestions})}recordCustomMetric(e,t){this.metrics.customMetrics||(this.metrics.customMetrics={}),this.metrics.customMetrics[e]=t,console.log(`[Performance] Custom metric ${e}:`,t)}mark(e){performance.mark&&performance.mark(e)}measure(e,t,s){if(performance.measure&&performance.getEntriesByName)try{performance.measure(e,t,s);const i=performance.getEntriesByName(e,"measure"),n=i[i.length-1]?.duration||0;return this.recordCustomMetric(e,n),n}catch(i){return console.warn("[PerformanceService] Failed to measure:",i),null}return null}getMetrics(){return{...this.metrics}}getAlerts(){return[...this.alerts]}getScore(){let e=100;return this.metrics.lcp&&(this.metrics.lcp>c.PERFORMANCE.LOAD_NEEDS_WORK?e-=30:this.metrics.lcp>c.PERFORMANCE.FCP_NEEDS_WORK&&(e-=15)),this.metrics.fid&&(this.metrics.fid>300?e-=25:this.metrics.fid>100&&(e-=10)),this.metrics.cls&&(this.metrics.cls>.25?e-=20:this.metrics.cls>.1&&(e-=10)),Math.max(0,e)}generateReport(){const e=[];this.alerts.forEach(s=>{e.push(...s.suggestions)});const t=[...new Set(e)];return{score:this.getScore(),metrics:this.getMetrics(),alerts:this.getAlerts(),recommendations:t}}stopMonitoring(){this.observers.forEach(e=>e.disconnect()),this.observers=[],this.isMonitoring=!1,console.log("[PerformanceService] Monitoring stopped")}reset(){this.metrics={},this.alerts=[],performance.clearMarks&&performance.clearMarks(),performance.clearMeasures&&performance.clearMeasures()}}const E=Object.freeze(Object.defineProperty({__proto__:null,PerformanceService:S},Symbol.toStringTag,{value:"Module"}));class v{constructor(e={}){this.currentSession=null,this.currentPageView=null,this.eventQueue=[],this.flushTimer=null,this.isTracking=!1,this.scrollDepth=0,this.pageInteractions=0,this.pageStartTime=0,this.handleScroll=()=>{const t=Math.round(window.scrollY/(document.documentElement.scrollHeight-window.innerHeight)*100);t>this.scrollDepth&&(this.scrollDepth=Math.min(t,100),t>=25&&this.scrollDepth<25?this.trackInteraction("scroll","page",{depth:"25%"}):t>=50&&this.scrollDepth<50?this.trackInteraction("scroll","page",{depth:"50%"}):t>=75&&this.scrollDepth<75?this.trackInteraction("scroll","page",{depth:"75%"}):t>=100&&this.scrollDepth<100&&this.trackInteraction("scroll","page",{depth:"100%"}))},this.handleClick=t=>{const s=t.target;if(!s)return;let i=s.tagName.toLowerCase();if(s.id?i+=`#${s.id}`:s.className&&(i+=`.${s.className.split(" ")[0]}`),s.tagName==="A"&&this.config.trackExternalLinks){const n=s.href;n&&!n.includes(window.location.hostname)&&this.trackInteraction("external_link",i,{url:n})}if(this.config.trackDownloads&&s.tagName==="A"){const n=s.href;n&&[".pdf",".zip",".doc",".docx",".xls",".xlsx",".ppt",".pptx"].some(a=>n.includes(a))&&this.trackInteraction("download",i,{file:n})}this.trackInteraction("click",i),this.pageInteractions++},this.handleFormSubmit=t=>{const s=t.target,i=s.id||s.className||"unknown_form";this.trackInteraction("form",`submit_${i}`),this.currentSession&&(this.currentSession.bounced=!1)},this.handleVisibilityChange=()=>{document.visibilityState==="hidden"?(this.completePageView(),this.flush()):document.visibilityState==="visible"&&this.trackPageView()},this.handlePageUnload=()=>{this.completePageView(),this.flush()},this.config={enableTracking:!0,respectDoNotTrack:!0,cookieConsent:!0,sessionTimeout:30,trackScrollDepth:!0,trackClicks:!0,trackBusinessCardInteractions:!0,trackFormSubmissions:!0,trackDownloads:!0,trackExternalLinks:!0,batchSize:10,flushInterval:30,...e}}async init(){if(!this.shouldTrack()){console.log("[VisitorTracking] Tracking disabled due to privacy settings");return}this.isTracking=!0,await this.initializeSession(),this.setupEventListeners(),this.trackPageView(),this.startFlushTimer(),console.log("[VisitorTracking] Initialized with session:",this.currentSession?.sessionId)}shouldTrack(){return!(!this.config.enableTracking||this.config.respectDoNotTrack&&navigator.doNotTrack==="1"||this.config.cookieConsent&&!this.hasConsentCookie())}hasConsentCookie(){return document.cookie.includes("tracking_consent=true")}async initializeSession(){const e=this.getOrCreateVisitorId(),t=this.getOrCreateSessionId(),s=Date.now(),i=this.getStoredSession();i&&this.isSessionValid(i)?(this.currentSession=i,this.currentSession.lastActivity=s,this.currentSession.pageViews++):this.currentSession={sessionId:t,visitorId:e,startTime:s,lastActivity:s,pageViews:1,totalTimeOnSite:0,bounced:!0,referrer:document.referrer,userAgent:navigator.userAgent,screenResolution:`${screen.width}x${screen.height}`,language:navigator.language,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone},this.storeSession()}getOrCreateVisitorId(){const e=localStorage.getItem("nbw_visitor_id");if(e)return e;const t=this.generateId();return localStorage.setItem("nbw_visitor_id",t),t}getOrCreateSessionId(){const e=sessionStorage.getItem("nbw_session_id");if(e)return e;const t=this.generateId();return sessionStorage.setItem("nbw_session_id",t),t}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}getStoredSession(){try{const e=sessionStorage.getItem("nbw_session");return e?JSON.parse(e):null}catch{return null}}storeSession(){this.currentSession&&sessionStorage.setItem("nbw_session",JSON.stringify(this.currentSession))}isSessionValid(e){const t=Date.now(),s=this.config.sessionTimeout*60*1e3;return t-e.lastActivity<s}setupEventListeners(){this.config.trackScrollDepth&&this.addEventListener(window,"scroll",this.handleScroll.bind(this)),this.config.trackClicks&&this.addEventListener(document,"click",this.handleClick.bind(this)),this.addEventListener(document,"visibilitychange",this.handleVisibilityChange.bind(this)),this.addEventListener(window,"beforeunload",this.handlePageUnload.bind(this)),this.config.trackBusinessCardInteractions&&this.setupBusinessCardTracking(),this.config.trackFormSubmissions&&this.addEventListener(document,"submit",this.handleFormSubmit.bind(this))}addEventListener(e,t,s){e.addEventListener(t,s,{passive:!0})}trackPageView(){this.currentSession&&(this.currentPageView&&this.completePageView(),this.pageStartTime=Date.now(),this.scrollDepth=0,this.pageInteractions=0,this.currentPageView={sessionId:this.currentSession.sessionId,url:window.location.href,title:document.title,timestamp:this.pageStartTime,scrollDepth:0,interactions:0},this.queueEvent(this.currentPageView))}completePageView(){if(!this.currentPageView||!this.currentSession)return;const e=Date.now()-this.pageStartTime;this.currentPageView.timeOnPage=e,this.currentPageView.scrollDepth=this.scrollDepth,this.currentPageView.interactions=this.pageInteractions,this.currentSession.totalTimeOnSite+=e,this.currentSession.lastActivity=Date.now(),(e>5e3||this.pageInteractions>2)&&(this.currentSession.bounced=!1),this.storeSession()}setupBusinessCardTracking(){setTimeout(()=>{const e=document.getElementById("business-card");e&&this.addEventListener(e,"click",()=>{this.trackInteraction("business_card","card_click",{action:"flip"})}),document.querySelectorAll(".nav-btn, .navigation button").forEach(i=>{this.addEventListener(i,"click",()=>{const n=i.textContent?.trim()||"unknown";this.trackInteraction("navigation",`nav_${n.toLowerCase()}`)})});const s=document.querySelector(".contact-form, form");s&&this.addEventListener(s,"focus",i=>{const n=i.target;(n.tagName==="INPUT"||n.tagName==="TEXTAREA")&&this.trackInteraction("form",`focus_${n.getAttribute("name")||"field"}`)})},1e3)}trackInteraction(e,t,s){if(!this.currentSession)return;const i={sessionId:this.currentSession.sessionId,type:e,element:t,timestamp:Date.now(),data:s||{},url:window.location.href};this.queueEvent(i),this.currentSession.lastActivity=Date.now(),this.storeSession()}queueEvent(e){this.eventQueue.push(e),this.eventQueue.length>=this.config.batchSize&&this.flush()}startFlushTimer(){this.flushTimer=setInterval(()=>{this.flush()},this.config.flushInterval*1e3)}flush(){if(this.eventQueue.length===0)return;const e=[...this.eventQueue];this.eventQueue=[],console.log("[VisitorTracking] Flushing events:",e),this.config.endpoint&&this.sendToEndpoint(e),this.storeEventsLocally(e)}async sendToEndpoint(e){if(this.config.endpoint)try{await fetch(this.config.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session:this.currentSession,events:e})})}catch(t){console.warn("[VisitorTracking] Failed to send events:",t),this.eventQueue.unshift(...e)}}storeEventsLocally(e){try{const i=[...JSON.parse(localStorage.getItem("nbw_tracking_events")||"[]"),...e].slice(-1e3);localStorage.setItem("nbw_tracking_events",JSON.stringify(i))}catch(t){console.warn("[VisitorTracking] Failed to store events locally:",t)}}getEngagementMetrics(){const e=this.getStoredEvents(),t=e.filter(r=>"title"in r),s=e.filter(r=>"type"in r),i=new Set(t.map(r=>r.sessionId)).size,n=t.length,u=t.reduce((r,o)=>r+(o.timeOnPage||0),0),a=i>0?t.filter(r=>r.interactions===0&&(r.timeOnPage||0)<5e3).length/i*100:0,l=new Map;t.forEach(r=>{const o=l.get(r.url)||{views:0,totalTime:0};l.set(r.url,{views:o.views+1,totalTime:o.totalTime+(r.timeOnPage||0)})});const g=Array.from(l.entries()).map(([r,o])=>({url:r,views:o.views,avgTime:o.totalTime/o.views})).sort((r,o)=>o.views-r.views).slice(0,10),h=new Map;s.forEach(r=>{const o=`${r.type}:${r.element}`;h.set(o,(h.get(o)||0)+1)});const d=Array.from(h.entries()).map(([r,o])=>{const[f,p]=r.split(":");return{type:f||"",element:p||"",count:o}}).sort((r,o)=>o.count-r.count).slice(0,10);return{averageTimeOnSite:i>0?u/i:0,bounceRate:a,pagesPerSession:i>0?n/i:0,topPages:g,topInteractions:d,deviceTypes:{desktop:0,mobile:0,tablet:0},referrers:{}}}getStoredEvents(){try{return JSON.parse(localStorage.getItem("nbw_tracking_events")||"[]")}catch{return[]}}getCurrentSession(){return this.currentSession}setTrackingEnabled(e){this.config.enableTracking=e,e&&!this.isTracking?this.init():!e&&this.isTracking&&this.stop()}stop(){this.isTracking&&(this.completePageView(),this.flush(),this.flushTimer&&(clearInterval(this.flushTimer),this.flushTimer=null),this.isTracking=!1,console.log("[VisitorTracking] Stopped"))}clearData(){localStorage.removeItem("nbw_visitor_id"),localStorage.removeItem("nbw_tracking_events"),sessionStorage.removeItem("nbw_session_id"),sessionStorage.removeItem("nbw_session"),this.currentSession=null,this.currentPageView=null,this.eventQueue=[]}exportData(){return{session:this.currentSession,events:this.getStoredEvents(),metrics:this.getEngagementMetrics()}}}const T=Object.freeze(Object.defineProperty({__proto__:null,VisitorTrackingService:v},Symbol.toStringTag,{value:"Module"}));export{c as A,E as p,T as v};
