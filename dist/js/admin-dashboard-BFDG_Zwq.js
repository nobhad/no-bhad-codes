const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/theme-rguDetHn.js","js/chunk-DFiJEDgY.js","js/chunk-Dmuk_T3B.js","js/index-DIemqqyN.js","js/chunk-C20AiJlz.js","js/navigation-BX9h_yRr.js","js/chunk-DYKrrkk1.js","js/chunk-DjKJqAo0.js"])))=>i.map(i=>d[i]);
import{_ as m}from"./chunk-Dmuk_T3B.js";import"./index-DIemqqyN.js";import"./chunk-DFiJEDgY.js";import"./chunk-C20AiJlz.js";const u=class u{static checkRateLimit(){try{const t=localStorage.getItem(this.ATTEMPT_STORAGE_KEY);if(!t)return!0;const e=JSON.parse(t),a=Date.now();if(e.timestamps=e.timestamps.filter(s=>a-s<this.LOCKOUT_DURATION),e.timestamps.length>=this.MAX_LOGIN_ATTEMPTS){const s=Math.min(...e.timestamps),i=this.LOCKOUT_DURATION-(a-s);if(i>0)throw new Error(`Too many failed attempts. Try again in ${Math.ceil(i/6e4)} minutes.`)}return!0}catch(t){if(t instanceof Error)throw t;return!0}}static recordFailedAttempt(){try{const t=localStorage.getItem(this.ATTEMPT_STORAGE_KEY),e=t?JSON.parse(t):{timestamps:[]};e.timestamps.push(Date.now()),localStorage.setItem(this.ATTEMPT_STORAGE_KEY,JSON.stringify(e))}catch(t){console.error("[AdminSecurity] Error recording failed attempt:",t)}}static clearAttempts(){try{localStorage.removeItem(this.ATTEMPT_STORAGE_KEY)}catch(t){console.error("[AdminSecurity] Error clearing attempts:",t)}}static enableCSPReporting(){document.addEventListener("securitypolicyviolation",t=>{console.warn("[AdminSecurity] CSP Violation:",{directive:t.violatedDirective,blocked:t.blockedURI,source:t.sourceFile,line:t.lineNumber})})}static detectDevTools(){const t={open:!1},e=160;return setInterval(()=>{window.outerHeight-window.innerHeight>e||window.outerWidth-window.innerWidth>e?t.open||(t.open=!0,console.warn("[AdminSecurity] Developer tools detected")):t.open=!1},500),t.open}static obfuscateConsole(){}static validateReferrer(){const t=document.referrer,e=window.location.host;return!t||t.includes(e)?!0:(console.warn("[AdminSecurity] Suspicious referrer:",t),!1)}static setupIntegrityCheck(){new MutationObserver(e=>{e.forEach(a=>{a.type==="childList"&&a.addedNodes.forEach(s=>{if(s.nodeType===Node.ELEMENT_NODE){const i=s;(i.tagName==="SCRIPT"||i.innerHTML?.includes("<script>"))&&(console.warn("[AdminSecurity] Suspicious script detected"),i.remove())}})})}).observe(document.body,{childList:!0,subtree:!0})}static init(){try{this.enableCSPReporting(),this.detectDevTools(),this.obfuscateConsole(),this.setupIntegrityCheck(),this.validateReferrer()||console.warn("[AdminSecurity] Referrer validation failed")}catch(t){console.error("[AdminSecurity] Error initializing security:",t)}}};u.MAX_LOGIN_ATTEMPTS=3,u.LOCKOUT_DURATION=15*60*1e3,u.ATTEMPT_STORAGE_KEY="nbw_admin_attempts";let d=u;const h=class h{static async authenticate(t){try{d.checkRateLimit();const a=new TextEncoder().encode(t),s=await crypto.subtle.digest("SHA-256",a);if(Array.from(new Uint8Array(s)).map(n=>n.toString(16).padStart(2,"0")).join("")===this.AUTH_KEY_HASH){d.clearAttempts();const n={authenticated:!0,timestamp:Date.now()};return sessionStorage.setItem(this.SESSION_KEY,JSON.stringify(n)),!0}return d.recordFailedAttempt(),!1}catch(e){throw console.error("[AdminAuth] Authentication error:",e),d.recordFailedAttempt(),e}}static isAuthenticated(){try{const t=sessionStorage.getItem(this.SESSION_KEY);if(!t)return!1;const e=JSON.parse(t),a=e.authenticated&&Date.now()-e.timestamp<this.SESSION_DURATION;return a||this.logout(),a}catch(t){return console.error("[AdminAuth] Session validation error:",t),!1}}static logout(){sessionStorage.removeItem(this.SESSION_KEY),window.location.reload()}static extendSession(){try{const t=sessionStorage.getItem(this.SESSION_KEY);if(t){const e=JSON.parse(t);e.timestamp=Date.now(),sessionStorage.setItem(this.SESSION_KEY,JSON.stringify(e))}}catch(t){console.error("[AdminAuth] Session extension error:",t)}}};h.AUTH_KEY_HASH="5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8",h.SESSION_KEY="nbw_admin_session",h.SESSION_DURATION=60*60*1e3;let c=h;class y{constructor(){this.currentTab="overview",this.refreshInterval=null,this.init()}async init(){if(d.init(),await this.initializeModules(),!c.isAuthenticated()){this.showAuthGate();return}this.showDashboard(),this.setupEventListeners(),await this.loadDashboardData(),this.startAutoRefresh()}async initializeModules(){try{const{ThemeModule:t}=await m(async()=>{const{ThemeModule:a}=await import("./theme-rguDetHn.js");return{ThemeModule:a}},__vite__mapDeps([0,1,2,3,4]));await new t({debug:!1}).init()}catch(t){console.warn("[AdminDashboard] Theme module failed to initialize:",t)}try{const{NavigationModule:t}=await m(async()=>{const{NavigationModule:a}=await import("./navigation-BX9h_yRr.js");return{NavigationModule:a}},__vite__mapDeps([5,1,2,3,4,6,7]));await new t({debug:!1}).init()}catch(t){console.warn("[AdminDashboard] Navigation module failed to initialize:",t)}}showAuthGate(){const t=document.getElementById("auth-gate"),e=document.getElementById("admin-dashboard");t&&t.classList.remove("hidden"),e&&e.classList.add("hidden"),this.setupAuthEventListeners()}showDashboard(){const t=document.getElementById("auth-gate"),e=document.getElementById("admin-dashboard");t&&t.classList.add("hidden"),e&&e.classList.remove("hidden")}setupAuthEventListeners(){const t=document.getElementById("auth-form");document.getElementById("auth-error"),t&&t.addEventListener("submit",async e=>{e.preventDefault();const s=new FormData(t).get("authKey");try{await c.authenticate(s)?(this.showDashboard(),this.setupEventListeners(),await this.loadDashboardData(),this.startAutoRefresh()):this.showAuthError("Invalid access key. Please try again.")}catch(i){const r=i instanceof Error?i.message:"Authentication failed. Please try again.";this.showAuthError(r)}})}showAuthError(t){const e=document.getElementById("auth-error");e&&(e.textContent=t,e.classList.remove("hidden"),setTimeout(()=>{e.classList.add("hidden")},5e3))}setupEventListeners(){const t=document.getElementById("logout-btn");t&&t.addEventListener("click",()=>{c.logout()}),document.querySelectorAll(".tab-btn").forEach(s=>{s.addEventListener("click",i=>{const n=i.target.dataset.tab;n&&this.switchTab(n)})});const a=document.getElementById("refresh-analytics");a&&a.addEventListener("click",()=>{this.loadAnalyticsData()}),this.setupExportButtons(),this.setupDataManagementButtons(),document.addEventListener("click",()=>{c.extendSession()}),document.addEventListener("keydown",()=>{c.extendSession()})}setupExportButtons(){const t=document.getElementById("export-analytics"),e=document.getElementById("export-visitors"),a=document.getElementById("export-performance");t&&t.addEventListener("click",()=>{this.exportData("analytics")}),e&&e.addEventListener("click",()=>{this.exportData("visitors")}),a&&a.addEventListener("click",()=>{this.exportData("performance")})}setupDataManagementButtons(){const t=document.getElementById("clear-old-data"),e=document.getElementById("reset-analytics");t&&t.addEventListener("click",()=>{this.clearOldData()}),e&&e.addEventListener("click",()=>{this.resetAnalytics()})}switchTab(t){document.querySelectorAll(".tab-btn").forEach(e=>{e.classList.remove("active")}),document.querySelector(`[data-tab="${t}"]`)?.classList.add("active"),document.querySelectorAll(".tab-content").forEach(e=>{e.classList.remove("active")}),document.getElementById(`${t}-tab`)?.classList.add("active"),this.currentTab=t,this.loadTabData(t)}async loadDashboardData(){this.showLoading(!0);try{await Promise.all([this.loadOverviewData(),this.loadPerformanceData(),this.loadAnalyticsData(),this.loadVisitorsData(),this.loadSystemData()])}catch(t){console.error("[AdminDashboard] Error loading data:",t)}finally{this.showLoading(!1)}}async loadTabData(t){this.showLoading(!0);try{switch(t){case"overview":await this.loadOverviewData();break;case"performance":await this.loadPerformanceData();break;case"analytics":await this.loadAnalyticsData();break;case"visitors":await this.loadVisitorsData();break;case"system":await this.loadSystemData();break}}catch(e){console.error(`[AdminDashboard] Error loading ${t} data:`,e)}finally{this.showLoading(!1)}}async loadOverviewData(){await new Promise(t=>setTimeout(t,500)),this.updateElement("total-visitors","1,234"),this.updateElement("visitors-change","+12% from last week","positive"),this.updateElement("page-views","5,678"),this.updateElement("views-change","+8% from last week","positive"),this.updateElement("avg-session","2m 34s"),this.updateElement("session-change","-3% from last week","negative"),this.updateElement("card-interactions","456"),this.updateElement("interactions-change","+18% from last week","positive"),this.loadChart("visitors-chart","Line chart showing visitor trends"),this.loadChart("sources-chart","Pie chart showing traffic sources")}async loadPerformanceData(){try{const t=await this.getPerformanceMetrics();this.updateVital("lcp",t.lcp),this.updateVital("fid",t.fid),this.updateVital("cls",t.cls),this.updateElement("total-bundle-size",t.bundleSize.total),this.updateElement("js-bundle-size",t.bundleSize.js),this.updateElement("css-bundle-size",t.bundleSize.css),this.loadChart("performance-timeline","Performance metrics over time")}catch(t){console.error("[AdminDashboard] Error loading performance data:",t),this.updateVital("lcp",{value:"1.2s",status:"good"}),this.updateVital("fid",{value:"45ms",status:"good"}),this.updateVital("cls",{value:"0.05",status:"good"}),this.updateElement("total-bundle-size","156 KB"),this.updateElement("js-bundle-size","98 KB"),this.updateElement("css-bundle-size","58 KB")}}async getPerformanceMetrics(){try{if(window.opener&&window.opener.NBW_DEBUG){const a=window.opener.NBW_DEBUG;if(a.getPerformanceReport)return await a.getPerformanceReport()}if(window.NBW_DEBUG?.getPerformanceReport)return await window.NBW_DEBUG.getPerformanceReport();const{container:t}=await m(async()=>{const{container:a}=await import("./chunk-Dmuk_T3B.js").then(s=>s.d);return{container:a}},__vite__mapDeps([2,3,1,4])),e=await t.resolve("PerformanceService");if(e&&e.generateReport){const a=await e.generateReport();return{lcp:{value:a.metrics.lcp?`${Math.round(a.metrics.lcp)}ms`:"N/A",status:this.getVitalStatus("lcp",a.metrics.lcp)},fid:{value:a.metrics.fid?`${Math.round(a.metrics.fid)}ms`:"N/A",status:this.getVitalStatus("fid",a.metrics.fid)},cls:{value:a.metrics.cls?a.metrics.cls.toFixed(3):"N/A",status:this.getVitalStatus("cls",a.metrics.cls)},bundleSize:{total:a.metrics.bundleSize?`${Math.round(a.metrics.bundleSize/1024)} KB`:"N/A",js:"N/A",css:"N/A"}}}}catch(t){console.warn("[AdminDashboard] Could not get live performance data:",t)}return{lcp:{value:"1.2s",status:"good"},fid:{value:"45ms",status:"good"},cls:{value:"0.05",status:"good"},bundleSize:{total:"156 KB",js:"98 KB",css:"58 KB"}}}getVitalStatus(t,e){if(!e)return"unknown";switch(t){case"lcp":return e<=2500?"good":e<=4e3?"needs-improvement":"poor";case"fid":return e<=100?"good":e<=300?"needs-improvement":"poor";case"cls":return e<=.1?"good":e<=.25?"needs-improvement":"poor";default:return"unknown"}}async loadAnalyticsData(){try{const t=await this.getAnalyticsData();this.populateDataList("popular-pages",t.popularPages||[{label:"Homepage",value:"2,145 views"},{label:"Art Portfolio",value:"856 views"},{label:"Codes Section",value:"634 views"},{label:"Contact",value:"423 views"},{label:"About",value:"312 views"}]),this.populateDataList("device-breakdown",t.deviceBreakdown||[{label:"Desktop",value:"45%"},{label:"Mobile",value:"38%"},{label:"Tablet",value:"17%"}]),this.populateDataList("geo-distribution",t.geoDistribution||[{label:"United States",value:"42%"},{label:"Canada",value:"18%"},{label:"United Kingdom",value:"12%"},{label:"Germany",value:"8%"},{label:"Other",value:"20%"}]),this.populateDataList("engagement-events",t.engagementEvents||[{label:"Business Card Flips",value:"456"},{label:"Contact Form Submissions",value:"23"},{label:"External Link Clicks",value:"187"},{label:"Download Clicks",value:"34"}])}catch(t){console.error("[AdminDashboard] Error loading analytics data:",t),this.populateDataList("popular-pages",[{label:"Homepage",value:"2,145 views"},{label:"Art Portfolio",value:"856 views"},{label:"Codes Section",value:"634 views"},{label:"Contact",value:"423 views"},{label:"About",value:"312 views"}]),this.populateDataList("device-breakdown",[{label:"Desktop",value:"45%"},{label:"Mobile",value:"38%"},{label:"Tablet",value:"17%"}]),this.populateDataList("geo-distribution",[{label:"United States",value:"42%"},{label:"Canada",value:"18%"},{label:"United Kingdom",value:"12%"},{label:"Germany",value:"8%"},{label:"Other",value:"20%"}]),this.populateDataList("engagement-events",[{label:"Business Card Flips",value:"456"},{label:"Contact Form Submissions",value:"23"},{label:"External Link Clicks",value:"187"},{label:"Download Clicks",value:"34"}])}}async getAnalyticsData(){try{if(window.opener&&window.opener.NBW_DEBUG){const a=window.opener.NBW_DEBUG;if(a.getVisitorData)return await a.getVisitorData()}if(window.NBW_DEBUG?.getVisitorData)return await window.NBW_DEBUG.getVisitorData();const{container:t}=await m(async()=>{const{container:a}=await import("./chunk-Dmuk_T3B.js").then(s=>s.d);return{container:a}},__vite__mapDeps([2,3,1,4])),e=await t.resolve("VisitorTrackingService");if(e&&e.exportData){const a=await e.exportData();return this.formatAnalyticsData(a)}}catch(t){console.warn("[AdminDashboard] Could not get live analytics data:",t)}return{}}formatAnalyticsData(t){if(!t||!t.sessions)return{};const e=t.sessions||[],a=t.pageViews||[],s=t.interactions||[],i={};a.forEach(o=>{i[o.url]=(i[o.url]||0)+1});const r=Object.entries(i).sort(([,o],[,l])=>l-o).slice(0,5).map(([o,l])=>({label:this.formatPageUrl(o),value:`${l} views`})),n={};e.forEach(o=>{o.deviceInfo?.type&&(n[o.deviceInfo.type]=(n[o.deviceInfo.type]||0)+1)});const w=e.length,g=Object.entries(n).map(([o,l])=>({label:o.charAt(0).toUpperCase()+o.slice(1),value:`${Math.round(l/w*100)}%`})),p={};s.forEach(o=>{const l=o.type||"Unknown";p[l]=(p[l]||0)+1});const f=Object.entries(p).map(([o,l])=>({label:this.formatInteractionType(o),value:l.toString()}));return{popularPages:r.length>0?r:void 0,deviceBreakdown:g.length>0?g:void 0,engagementEvents:f.length>0?f:void 0,geoDistribution:void 0}}formatPageUrl(t){return{"/":"Homepage","/art":"Art Portfolio","/codes":"Codes Section","/contact":"Contact","/about":"About"}[t]||t}formatInteractionType(t){return{"business-card-flip":"Business Card Flips","contact-form-submit":"Contact Form Submissions","external-link-click":"External Link Clicks","download-click":"Download Clicks","scroll-depth":"Scroll Depth Events"}[t]||t}async loadVisitorsData(){const t=[{id:"v_001",firstVisit:"2024-08-30 14:23",lastVisit:"2024-08-31 09:15",sessions:3,pageViews:12,location:"San Francisco, CA",device:"Desktop"},{id:"v_002",firstVisit:"2024-08-31 08:45",lastVisit:"2024-08-31 08:52",sessions:1,pageViews:5,location:"Toronto, ON",device:"Mobile"}];this.populateVisitorsTable(t)}async loadSystemData(){const t=await this.getApplicationStatus();this.populateSystemStatus(t)}async getApplicationStatus(){try{if(window.NBW_DEBUG?.getStatus)return window.NBW_DEBUG.getStatus()}catch(t){console.error("[AdminDashboard] Error getting app status:",t)}return{modules:{ThemeModule:{status:"healthy"},NavigationModule:{status:"healthy"},ContactFormModule:{status:"healthy"}},services:{DataService:{status:"healthy"},PerformanceService:{status:"healthy"},ContactService:{status:"warning"}}}}updateElement(t,e,a){const s=document.getElementById(t);s&&(s.textContent=e,a&&(s.className=`metric-change ${a}`))}updateVital(t,e){const a=document.getElementById(`${t}-value`),s=document.getElementById(`${t}-status`);a&&(a.textContent=e.value),s&&(s.textContent=e.status.replace("-"," "),s.className=`vital-status ${e.status}`)}loadChart(t,e){const a=document.getElementById(t);a&&(a.innerHTML=`<div class="chart-placeholder">${e}</div>`)}populateDataList(t,e){const a=document.getElementById(t);a&&(a.innerHTML=e.map(s=>`
      <div class="data-item">
        <span>${s.label}</span>
        <span>${s.value}</span>
      </div>
    `).join(""))}populateVisitorsTable(t){const e=document.querySelector("#visitors-table tbody");e&&(e.innerHTML=t.map(a=>`
      <tr>
        <td>${a.id}</td>
        <td>${a.firstVisit}</td>
        <td>${a.lastVisit}</td>
        <td>${a.sessions}</td>
        <td>${a.pageViews}</td>
        <td>${a.location}</td>
        <td>${a.device}</td>
        <td>
          <button class="btn btn-secondary btn-sm" onclick="viewVisitorDetails('${a.id}')">
            View
          </button>
        </td>
      </tr>
    `).join(""))}populateSystemStatus(t){const e=document.getElementById("app-status");if(!e)return;const a={...t.modules,...t.services};e.innerHTML=Object.entries(a).map(([s,i])=>`
      <div class="status-item">
        <span>${s}</span>
        <div style="display: flex; align-items: center; gap: 8px;">
          <div class="status-indicator ${i.status}"></div>
          <span>${i.status}</span>
        </div>
      </div>
    `).join("")}showLoading(t){const e=document.getElementById("loading-indicator");e&&(t?e.classList.remove("hidden"):e.classList.add("hidden"))}startAutoRefresh(){this.refreshInterval=setInterval(()=>{this.loadTabData(this.currentTab)},5*60*1e3)}async exportData(t){try{let e,a;switch(t){case"analytics":e=await this.getAnalyticsExport(),a=`analytics-${new Date().toISOString().split("T")[0]}.json`;break;case"visitors":e=await this.getVisitorsExport(),a=`visitors-${new Date().toISOString().split("T")[0]}.json`;break;case"performance":e=await this.getPerformanceExport(),a=`performance-${new Date().toISOString().split("T")[0]}.json`;break;default:throw new Error("Unknown export type")}const s=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),i=URL.createObjectURL(s),r=document.createElement("a");r.href=i,r.download=a,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)}catch(e){console.error(`[AdminDashboard] Error exporting ${t} data:`,e),alert(`Failed to export ${t} data. Please try again.`)}}async getAnalyticsExport(){return{exportDate:new Date().toISOString(),pageViews:[],visitors:[],events:[]}}async getVisitorsExport(){return{exportDate:new Date().toISOString(),visitors:[]}}async getPerformanceExport(){return{exportDate:new Date().toISOString(),metrics:await this.getPerformanceMetrics()}}async clearOldData(){if(confirm("Are you sure you want to clear data older than 90 days? This action cannot be undone."))try{alert("Old data cleared successfully.")}catch(t){console.error("[AdminDashboard] Error clearing old data:",t),alert("Failed to clear old data. Please try again.")}}async resetAnalytics(){if(confirm("Are you sure you want to reset ALL analytics data? This action cannot be undone.")&&confirm('This will permanently delete all visitor data, page views, and analytics. Type "RESET" to confirm.'))try{localStorage.clear(),sessionStorage.clear(),alert("Analytics data has been reset."),window.location.reload()}catch(t){console.error("[AdminDashboard] Error resetting analytics:",t),alert("Failed to reset analytics. Please try again.")}}}window.viewVisitorDetails=v=>{alert(`Viewing details for visitor: ${v}`)};document.addEventListener("DOMContentLoaded",()=>{new y});export{c as AdminAuth,y as AdminDashboard};
