class o{constructor(e,t={}){this.name=e,this.isInitialized=!1,this.isDestroyed=!1,this.debug=t.debug||!1,this.reducedMotion=this.checkReducedMotion(),this.eventListeners=new Map,this.timelines=new Set,this.elements=new Map,this.lastActivity=null,this.errors=[],this.init=this.init.bind(this),this.destroy=this.destroy.bind(this),this.log=this.log.bind(this),this.warn=this.warn.bind(this),this.error=this.error.bind(this),this.getElement=this.getElement.bind(this),this.getElements=this.getElements.bind(this),this.addEventListener=this.addEventListener.bind(this)}checkReducedMotion(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}async init(){if(this.isInitialized){this.warn("Module already initialized.");return}this.log("Initializing...");try{await this.onInit(),this.isInitialized=!0,this.isDestroyed=!1,this.log("Initialized successfully"),this.dispatchEvent("initialized")}catch(e){this.error("Initialization failed:",e),this.handleInitError(e),this.isInitialized=!0,this.hasError=!0,this.dispatchEvent("init-error",{error:e})}}handleInitError(e){if(this.error(`Module ${this.name} failed to initialize properly:`,e.message),this.onErrorRecovery)try{this.onErrorRecovery(e)}catch(t){this.error("Recovery also failed:",t)}}onErrorRecovery(e){}async onInit(){return Promise.resolve()}getElement(e,t,s=!0){let i=this.elements.get(e);return i||(i=document.querySelector(t),i?(this.elements.set(e,i),this.log(`Cached element: ${e} (${t})`)):s?this.error(`Required element "${e}" with selector "${t}" not found.`):this.warn(`Optional element "${e}" with selector "${t}" not found.`)),i}getElements(e,t,s=!0){let i=this.elements.get(e);return(!i||i.length===0)&&(i=document.querySelectorAll(t),i.length>0?(this.elements.set(e,i),this.log(`Cached ${i.length} elements for: ${e} (${t})`)):s&&this.warn(`No elements found for "${e}" with selector "${t}".`)),i}addTimeline(e){e&&this.timelines.add(e)}removeTimeline(e){e&&this.timelines.delete(e)}addEventListener(e,t,s,i=`${e.id||e.tagName}-${t}-${this.eventListeners.size}`){if(!e||typeof e.addEventListener!="function"){this.warn(`Cannot add event listener: Invalid element provided for key "${i}".`);return}if(typeof s!="function"){this.warn(`Cannot add event listener: Invalid handler provided for key "${i}".`);return}e.addEventListener(t,s),this.eventListeners.set(i,{element:e,event:t,handler:s}),this.log(`Added event listener: ${i} on ${e.tagName||e.nodeName}`)}dispatchEvent(e,t={}){const s=new CustomEvent(`${this.name}:${e}`,{detail:t});document.dispatchEvent(s),this.log(`Dispatched event: ${e}`)}async destroy(){if(this.isDestroyed){this.warn("Module already destroyed.");return}this.log("Destroying...");try{this.eventListeners.forEach((e,t)=>{if(e&&typeof e=="object"){const{element:s,event:i,handler:n}=e;s&&i&&typeof n=="function"?s.removeEventListener(i,n):this.warn(`[${this.name}] Skipping removal for malformed listener (key: ${t}):`,e)}else this.warn(`[${this.name}] Skipping removal for non-object listener (key: ${t}):`,e)}),this.eventListeners.clear(),this.timelines.forEach(e=>e.kill()),this.timelines.clear(),this.onDestroy(),this.elements.clear(),this.isDestroyed=!0,this.isInitialized=!1,this.log("Destroyed successfully"),this.dispatchEvent("destroyed")}catch(e){throw this.error("Destruction failed:",e),e}}onDestroy(){}log(...e){this.debug&&console.log(`[${this.name}]`,...e)}warn(...e){console.warn(`[${this.name}]`,...e)}error(...e){console.error(`[${this.name}]`,...e)}isReady(){return this.isInitialized&&!this.isDestroyed}getStatus(){return{name:this.name,initialized:this.isInitialized,destroyed:this.isDestroyed,ready:this.isReady(),reducedMotion:this.reducedMotion,elementCount:this.elements.size,listenerCount:this.eventListeners.size,timelineCount:this.timelines.size}}}export{o as B};
