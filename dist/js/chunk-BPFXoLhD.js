import{B as c}from"./chunk-DFiJEDgY.js";import{C as l}from"./chunk-DL-eEZZ1.js";const i=class i{static escapeHtml(t){return!t||typeof t!="string"?"":t.replace(/[&<>"'`=/]/g,e=>i.HTML_ENTITIES[e]||e)}static stripHtml(t){return!t||typeof t!="string"?"":t.replace(/<[^>]*>/g,"")}static sanitizeText(t){return!t||typeof t!="string"?"":i.escapeHtml(i.stripHtml(t.trim()))}static sanitizeEmail(t){if(!t||typeof t!="string")return"";const e=i.stripHtml(t.trim().toLowerCase());return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e)?e:""}static sanitizeMessage(t){if(!t||typeof t!="string")return"";let e=t.trim();return i.DANGEROUS_TAGS.forEach(s=>{const r=new RegExp(`<\\/?${s}[^>]*>`,"gi");e=e.replace(r,"")}),i.JS_EVENT_ATTRIBUTES.forEach(s=>{const r=new RegExp(`${s}\\s*=\\s*[^\\s>]*`,"gi");e=e.replace(r,"")}),e=e.replace(/javascript:/gi,""),e=e.replace(/data:/gi,""),e=e.replace(/vbscript:/gi,""),i.escapeHtml(e)}static sanitizeUrl(t){if(!t||typeof t!="string")return"";const e=t.trim(),s=/^(https?|mailto):/i;return/^[a-z][a-z0-9+.-]*:/i.test(e)&&!s.test(e)?"":i.escapeHtml(i.stripHtml(e))}static sanitizePhone(t){if(!t||typeof t!="string")return"";const e=i.stripHtml(t.trim()).replace(/[^0-9\s\-()+ ext.]/g,"");return i.escapeHtml(e)}static sanitizeFormData(t){const e={};for(const[s,r]of Object.entries(t)){if(r==null){e[s]="";continue}const a=String(r),n=i.sanitizeText(s);switch(s.toLowerCase()){case"email":e[n]=i.sanitizeEmail(a);break;case"phone":case"telephone":case"mobile":e[n]=i.sanitizePhone(a);break;case"website":case"url":case"link":e[n]=i.sanitizeUrl(a);break;case"message":case"comment":case"description":case"notes":e[n]=i.sanitizeMessage(a);break;default:e[n]=i.sanitizeText(a)}}return e}static detectXss(t){return!t||typeof t!="string"?!1:[/<script/i,/javascript:/i,/vbscript:/i,/data:text\/html/i,/onload=/i,/onerror=/i,/onclick=/i,/<iframe/i,/<object/i,/<embed/i,/expression\(/i,/url\(/i,/@import/i,/behavior:/i].some(s=>s.test(t))}static checkRateLimit(t,e=5,s=3e5){const r=Date.now(),a=i.submissionAttempts.get(t);return a?r-a.firstAttempt>s?(i.submissionAttempts.set(t,{count:1,firstAttempt:r}),!0):a.count>=e?!1:(a.count++,!0):(i.submissionAttempts.set(t,{count:1,firstAttempt:r}),!0)}static generateNonce(){const t=new Uint8Array(16);return crypto.getRandomValues(t),Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}static logSecurityViolation(t,e,s){const r={type:t,timestamp:new Date().toISOString(),data:i.sanitizeText(JSON.stringify(e)),userAgent:s?i.sanitizeText(s):"unknown",url:window.location.href};console.warn("ðŸš¨ Security violation detected:",r)}};i.HTML_ENTITIES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&#96;","=":"&#x3D;"},i.DANGEROUS_TAGS=["script","iframe","object","embed","form","input","textarea","button","select","option","link","meta","style","title","base","svg","math"],i.JS_EVENT_ATTRIBUTES=["onload","onerror","onclick","onmouseover","onmouseout","onkeydown","onkeyup","onkeypress","onfocus","onblur","onchange","onsubmit","onreset","onselect","onabort","onunload","onresize","onscroll"],i.submissionAttempts=new Map;let o=i;class m extends c{constructor(t={}){super("ContactForm",{debug:!0,...t}),this.form=null,this.submitButton=null,this.isSubmitting=!1,this.contactService=new l({backend:t.backend||"netlify",formId:t.formId||"",apiKey:t.apiKey||"",endpoint:t.endpoint||""}),this.handleSubmit=this.handleSubmit.bind(this),this.handleInputChange=this.handleInputChange.bind(this)}async onInit(){await this.contactService.init(),this.form=this.getElement("Contact form",".contact-form",!0),this.submitButton=this.getElement("Submit button",".form-button",!0),this.form&&(this.setupEventListeners(),this.log("Contact form initialized with backend:",this.contactService.getConfig().backend))}setupEventListeners(){this.addEventListener(this.form,"submit",this.handleSubmit),this.form.querySelectorAll("input, select, textarea").forEach(e=>{this.addEventListener(e,"input",this.handleInputChange),this.addEventListener(e,"blur",this.handleInputChange)}),this.setupFormValidation()}setupFormValidation(){if(!this.form||!this.submitButton)return;const t=()=>{const s=this.form.querySelectorAll("input[required], select[required], textarea[required]"),r=Array.from(s).every(a=>{const n=a;return n.value&&n.value.trim()!==""});this.submitButton&&(r?this.submitButton.classList.add("form-valid"):this.submitButton.classList.remove("form-valid"))};this.form.querySelectorAll("input, select, textarea").forEach(s=>{this.addEventListener(s,"input",t),this.addEventListener(s,"change",t)}),t()}handleInputChange(t){this.validateField(t.target),this.checkForSecurityIssues(t.target)}validateField(t){const e=t,s=e.value.trim();let r=!0,a="";switch(t.classList.remove("error"),this.removeErrorMessage(t),e.type){case"email":this.isValidEmail(s)||(r=!1,a="Please enter a valid email address");break;case"text":e.required&&s.length<2&&(r=!1,a="This field must be at least 2 characters");break;case"textarea":e.required&&s.length<10&&(r=!1,a="Please provide a more detailed message");break}return r||this.showFieldError(t,a),r}isValidEmail(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}showFieldError(t,e){t.classList.add("error");const s=document.createElement("div");s.className="field-error",s.textContent=e,t.parentNode?.insertBefore(s,t.nextSibling)}removeErrorMessage(t){const e=t.parentNode?.querySelector(".field-error");e&&e.remove()}async handleSubmit(t){if(t.preventDefault(),this.isSubmitting)return;this.log("Form submission started");const e=this.gatherFormData(),s=this.contactService.validateFormData(e);if(!s.valid){this.showValidationErrors(s.errors);return}this.isSubmitting=!0,this.setSubmitButtonState(!0);try{const r=await this.contactService.submitForm(e);if(r.success)this.showFormMessage(r.message,"success"),this.form?.reset(),this.clearAllErrors();else throw new Error(r.error||"Failed to send message")}catch(r){this.error("Form submission failed:",r),this.showFormMessage("Sorry, there was an error sending your message. Please try again.","error")}finally{this.isSubmitting=!1,this.setSubmitButtonState(!1)}}gatherFormData(){if(!this.form)return{};const t=new FormData(this.form),e={firstName:t.get("First-Name")?.toString().trim()||"",lastName:t.get("Last-Name")?.toString().trim()||"",email:t.get("Email")?.toString().trim()||"",companyName:t.get("Company-Name")?.toString().trim(),businessSize:t.get("Business-Size")?.toString()||"",helpOption:t.get("help-options")?.toString()||"",message:t.get("Message")?.toString().trim()||""};return{firstName:o.sanitizeText(e.firstName),lastName:o.sanitizeText(e.lastName),email:o.sanitizeEmail(e.email),companyName:e.companyName?o.sanitizeText(e.companyName):"",businessSize:o.sanitizeText(e.businessSize),helpOption:o.sanitizeText(e.helpOption),message:o.sanitizeMessage(e.message)}}showValidationErrors(t){this.clearAllErrors(),t.forEach(e=>{this.log("Validation error:",e)}),this.showFormMessage(t.join("<br>"),"error")}clearAllErrors(){this.form?.querySelectorAll(".field-error")?.forEach(s=>s.remove()),this.form?.querySelectorAll(".error")?.forEach(s=>s.classList.remove("error"))}validateForm(){const t=this.form.querySelectorAll("input[required], select[required], textarea[required]");let e=!0;return t.forEach(s=>{this.validateField(s)||(e=!1)}),e}setSubmitButtonState(t){this.submitButton&&(t?(this.submitButton.disabled=!0,this.submitButton.textContent="Sending...",this.submitButton.classList.add("loading")):(this.submitButton.disabled=!1,this.submitButton.textContent="Let's Talk",this.submitButton.classList.remove("loading")))}showFormMessage(t,e){const s=this.form.querySelector(".form-message");s&&s.remove();const r=document.createElement("div");r.className=`form-message ${e}`,r.textContent=t,this.form.insertBefore(r,this.form.firstChild),e==="success"&&setTimeout(()=>{r.parentNode&&r.remove()},5e3)}async submitToNetlify(t){const e=new URLSearchParams;e.append("form-name","contact-form"),Object.entries(t).forEach(([r,a])=>{e.append(r,String(a))});const s=await fetch("/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e});if(s.ok)return{success:!0};throw new Error(`HTTP error! status: ${s.status}`)}async submitToFormspree(t){const e=await fetch("https://formspree.io/f/your-form-id",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(e.ok)return{success:!0};const s=await e.json();throw new Error(s.message||"Formspree submission failed")}async submitToEmailJS(t){return{success:!1,error:"EmailJS not configured"}}checkForSecurityIssues(t){const e=t.value;o.detectXss(e)&&(this.showFieldError(t,"Invalid characters detected. Please remove any HTML or script tags."),o.logSecurityViolation("client_xss_attempt",{fieldName:t.name||t.id,fieldType:t.type,value:o.sanitizeText(e)},navigator.userAgent)),e.length>5e3&&(this.showFieldError(t,"Input too long. Please shorten your message."),o.logSecurityViolation("input_length_violation",{fieldName:t.name||t.id,length:e.length},navigator.userAgent))}onDestroy(){this.isSubmitting=!1,super.onDestroy()}}const f=Object.freeze(Object.defineProperty({__proto__:null,ContactFormModule:m},Symbol.toStringTag,{value:"Module"}));export{o as S,f as c};
