/**
 * ===============================================
 * PAGE TRANSITIONS CSS
 * ===============================================
 * @file src/styles/components/page-transitions.css
 *
 * Virtual pages layout and transition styles.
 * Salcosta-style full-viewport page architecture.
 * Desktop only - mobile uses scroll behavior.
 */

/* ============================================
 * CSS VARIABLES FOR TRANSITIONS
 * ============================================ */

:root {
  --page-transition-duration-in: 0.5s;
  --page-transition-duration-out: 0.4s;
  --page-transition-stagger: 0.1s;
  --page-transition-ease: cubic-bezier(0.3, 0.9, 0.3, 0.9);
  --page-blur-amount: 8px;
}

/* ============================================
 * PAGE TRANSITION OVERLAY
 * Covers main content area only (between header and footer)
 * Used during page transitions - NOT for intro animation
 * ============================================ */

.page-transition-overlay {
  position: fixed;
  top: var(--header-height);
  left: 0;
  width: 100vw;
  height: calc(100vh - var(--header-height) - var(--footer-height));
  z-index: 50; /* Above main content (1) but below nav (100) */
  background-color: var(--color-neutral-300);
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  /* GSAP handles overlay transition - see page-transition.ts */
}

/* Active state during transitions */
.page-transition-overlay.transitioning {
  opacity: 1;
  visibility: visible;
}

/* ============================================
 * PAGE STATE CLASSES (Mobile + Desktop)
 * ============================================ */

/* Hidden page state - completely hide non-active pages */
section.page-hidden {
  display: none !important;
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  z-index: 1;
}

/* Active page state - when page-active is present, page-hidden is removed */
/* Base rule for sections that use block display */
section.page-active:not(.contact-section):not(.about-section):not(.business-card-section) {
  display: block; /* Override base section { display: flex } from layout.css */
  visibility: visible;
  pointer-events: auto;
  opacity: 1;
  z-index: 100;
}

/* Contact section needs grid display when active */
/* Specificity: section.contact-section.page-active (0,2,1) > section (0,0,1) */
section.contact-section.page-active {
  display: grid;
  visibility: visible;
  opacity: 1;
  pointer-events: auto;
  z-index: 100;
}

/* About section needs grid display when active */
/* Specificity: section.about-section.page-active (0,2,1) > section (0,0,1) */
section.about-section.page-active {
  display: grid;
  visibility: visible;
  opacity: 1;
  pointer-events: auto;
  z-index: 100;
}

  /* Ensure virtual pages sections are visible when active - even higher specificity */
  main[data-virtual-pages] > section.contact-section.page-active,
  main[data-virtual-pages] > section.about-section.page-active {
    display: grid;
    visibility: visible;
    opacity: 1;
    pointer-events: auto;
    z-index: 100; /* Ensure active page is on top */
  }

/* About section scroll - ensure scrolling on mobile */
@media screen and (max-width: 767px) {
  /* Force about section to be scrollable on mobile - highest specificity */
  section#about.about-section.page-active,
  section.about-section#about.page-active {
    overflow-y: scroll !important;
    overflow-x: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    touch-action: pan-y !important;
    overscroll-behavior-y: contain !important;
  }
}

/* Intro page should allow other pages to appear on top */
section#intro,
section.business-card-section {
  z-index: 10;
}

section#intro.page-active,
section.business-card-section.page-active {
  z-index: 50 !important; /* Lower than other active pages, visible during transitions */
}

/* CRITICAL: Force hide intro page when page-hidden is present, even with !important rules */
section#intro.page-hidden,
section.business-card-section.page-hidden {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
  z-index: -1 !important;
}

/* Also hide intro children when page is hidden */
section#intro.page-hidden .business-card-container,
section#intro.page-hidden .business-card,
section#intro.page-hidden .intro-nav,
section.business-card-section.page-hidden .business-card-container,
section.business-card-section.page-hidden .business-card,
section.business-card-section.page-hidden .intro-nav {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
}

/* ============================================
 * VIRTUAL PAGE LAYOUT (Desktop Only)
 * ============================================ */

@media screen and (min-width: 768px) {
  /* Main container for virtual pages */
  main[data-virtual-pages] {
    position: fixed;
    top: var(--header-height);
    bottom: var(--footer-height);
    left: 0;
    right: 0;
    width: 100%;
    height: calc(100vh - var(--header-height) - var(--footer-height));
    height: calc(100dvh - var(--header-height) - var(--footer-height));
    overflow: hidden;
    background-color: var(--color-neutral-300); /* Solid background fill */
  }

  /* Virtual page sections - card centered, nav positioned absolutely */
  /* Projects section - left aligned like about section */
  main[data-virtual-pages] > .projects-section[data-page].page-active {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: flex-start; /* Left align like about section */
    overflow: hidden;
    box-sizing: border-box;
    padding: clamp(1rem, 4vw, 2rem);
  }

  /* Other virtual page sections - centered */
  main[data-virtual-pages] > section[data-page]:not(.tech-stack-section):not(.contact-section):not(.about-section):not(.business-card-section):not(.projects-section) {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: grid;
    place-items: center;
    overflow: hidden;
    box-sizing: border-box;
  }

  /* Business card section - needs overflow visible for nav links below card */
  main[data-virtual-pages] > .business-card-section[data-page] {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    padding: 0 !important;
    margin: 0 !important;
    overflow: visible;
    box-sizing: border-box;
  }

  /* Business card container - centered in viewport height */
  main[data-virtual-pages] > .business-card-section[data-page] > .business-card-container {
    position: absolute !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    margin: 0 !important;
    display: block !important;
  }

  /* Intro nav positioned absolutely below centered card */
  main[data-virtual-pages] > .business-card-section .intro-nav {
    position: absolute;
    top: calc(50% + 294.19px / 2 + 1rem);
    left: 50%;
    transform: translateX(-50%);
    z-index: 100;
    pointer-events: auto;
  }

  /* Ensure nav links are clickable */
  main[data-virtual-pages] > .business-card-section .intro-nav-link {
    pointer-events: auto;
    cursor: pointer;
  }

  /* About section - grid centered for content */
  /* Only applies when page-active (not page-hidden) */
  main[data-virtual-pages] > .about-section[data-page].page-active {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    min-height: 100%; /* Override base section { min-height: 0 } */
    display: grid;
    place-items: center;
    overflow: hidden;
    box-sizing: border-box;
    padding: clamp(1rem, 4vw, 2rem);
    visibility: visible;
    opacity: 1;
    pointer-events: auto;
  }

  /* About content centered in viewport */
  main[data-virtual-pages] > .about-section .about-content {
    max-width: min(1000px, 90vw);
    overflow: hidden;
    /* Ensure content is centered vertically within the grid */
    align-self: center;
    justify-self: center;
  }

  /* Contact section - uses CSS Grid for proper h2/form alignment */
  /* Only applies when page-active (not page-hidden) */
  main[data-virtual-pages] > .contact-section[data-page].page-active {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    min-height: 100%; /* Override base section { min-height: 0 } */
    display: grid;
    place-content: center center;
    overflow: visible;
    box-sizing: border-box;
    padding: clamp(1rem, 4vw, 2rem);
    visibility: visible;
    opacity: 1;
    pointer-events: auto;
  }

  /* Tech stack section is mobile-only - keep hidden on desktop */
  main[data-virtual-pages] > .tech-stack-section {
    display: none !important;
  }

  /* Hero section with text animation - handled separately, not a virtual page */
  /* It's tied to the intro and controlled by TextAnimationModule */
  main[data-virtual-pages] > .hero-section {
    display: none !important;
  }


  /* Page content wrapper for animations */
  section[data-page] > * {
    will-change: transform, opacity, filter;
  }

  /* Disable scroll on body when virtual pages active */
  body.virtual-pages-active {
    overflow: hidden;
  }
}

/* ============================================
 * TRANSITION STATES
 * ============================================ */

/* Blur-in animation (entering) */
.page-entering {
  opacity: 0;
  filter: blur(var(--page-blur-amount));
}

.page-entering.page-enter-active {
  opacity: 1;
  filter: blur(0);
  /* GSAP handles page enter transition - see page-transition.ts */
}

/* Blur-out animation (leaving) */
.page-leaving {
  opacity: 1;
  filter: blur(0);
}

.page-leaving.page-leave-active {
  opacity: 0;
  filter: blur(var(--page-blur-amount));
  /* GSAP handles page leave transition - see page-transition.ts */
}

/* ============================================
 * DROP-IN/OUT ANIMATIONS FOR CHILDREN
 * ============================================ */

/* Child elements drop-in (from top) */
.page-child-entering {
  transform: translateY(-105%);
}

.page-child-entering.page-child-enter-active {
  transform: translateY(0);
  /* GSAP handles child enter transition - see page-transition.ts */
}

/* Child elements drop-out (to bottom) */
.page-child-leaving {
  transform: translateY(0);
}

.page-child-leaving.page-child-leave-active {
  transform: translateY(105%);
  /* GSAP handles child leave transition - see page-transition.ts */
}

/* ============================================
 * REDUCED MOTION
 * ============================================ */

@media (prefers-reduced-motion: reduce) {
  :root {
    --page-transition-duration-in: 0s;
    --page-transition-duration-out: 0s;
    --page-transition-stagger: 0s;
    --page-blur-amount: 0;
  }

  .page-entering,
  .page-leaving,
  .page-child-entering,
  .page-child-leaving {
    transition: none !important;
    animation: none !important;
  }
}

