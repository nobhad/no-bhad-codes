/**
 * ===============================================
 * PAGE TRANSITIONS CSS
 * ===============================================
 * @file src/styles/components/page-transitions.css
 *
 * Virtual pages layout and transition styles.
 * Full-viewport page architecture.
 * Desktop only - mobile uses scroll behavior.
 */

/* ============================================
 * CSS VARIABLES FOR TRANSITIONS
 * ============================================ */

:root {
  --page-transition-duration: 0.5s;
  --page-blur-amount: 12px;
}

/* ============================================
 * PAGE TRANSITION OVERLAY (DISABLED)
 * Overlay no longer used - direct blur crossfade instead
 * ============================================ */

/* .page-transition-overlay - removed, no longer needed */

/* ============================================
 * PAGE STATE CLASSES (Mobile + Desktop)
 * ============================================ */

/* Hidden page state - completely hide non-active pages */
/* page-states layer ensures these override page-specific CSS */
/* GSAP inline styles are cleared via clearProps before adding this class */
section.page-hidden {
  display: none;
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  z-index: -1;
}

/* Page entering state - MUST be invisible before GSAP animates in */
/* This class is added before page-active and removed after animation completes */
section.page-entering {
  visibility: hidden;
  opacity: 0;
}

/* Active page state - when page-active is present, page-hidden is removed */
/* GSAP controls opacity AND visibility via autoAlpha - CSS only handles display */
section.page-active:not(.contact-section):not(.about-section):not(.business-card-section) {
  display: block;
  /* visibility controlled by GSAP autoAlpha */
  pointer-events: auto;
  z-index: 100;
}

/* Contact section needs grid display when active */
section.contact-section.page-active {
  display: grid;
  /* visibility controlled by GSAP autoAlpha */
  pointer-events: auto;
  z-index: 100;
}

/* About section needs grid display when active */
section.about-section.page-active {
  display: grid;
  /* visibility controlled by GSAP autoAlpha */
  pointer-events: auto;
  z-index: 100;
}

/* Projects section needs flex display when active */
section.projects-section.page-active {
  display: flex;
  /* visibility controlled by GSAP autoAlpha */
  pointer-events: auto;
  z-index: 100;
}

/* Project detail section needs flex display when active */
section.project-detail-section.page-active {
  display: flex;
  /* visibility controlled by GSAP autoAlpha */
  pointer-events: auto;
  z-index: 100;
}

/* Admin login section needs grid display when active */
section.admin-login-section.page-active {
  display: grid;
  place-items: center;
  /* visibility controlled by GSAP autoAlpha */
  pointer-events: auto;
  z-index: 100;
}

/* Ensure virtual pages sections use correct display when active */
main[data-virtual-pages] > section.contact-section.page-active,
main[data-virtual-pages] > section.about-section.page-active {
  display: grid;
  /* visibility controlled by GSAP autoAlpha */
  pointer-events: auto;
  z-index: 100;
}

/* About section scroll - ensure scrolling on mobile */
@media (--mobile) {
  /* Force about section to be scrollable on mobile */
  section#about.about-section.page-active,
  section.about-section#about.page-active {
    overflow-y: scroll;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
    touch-action: pan-y;
    overscroll-behavior-y: contain;
  }
}

/* Intro page should allow other pages to appear on top */
section#intro,
section.business-card-section {
  z-index: 10;
}

section#intro.page-active,
section.business-card-section.page-active {
  z-index: 50; /* Lower than other active pages, visible during transitions */
}

/* Hide intro page when page-hidden is present */
section#intro.page-hidden,
section.business-card-section.page-hidden {
  display: none;
  visibility: hidden;
  opacity: 0;
  pointer-events: none;
  z-index: -1;
}

/* Also hide intro children when page is hidden - use !important to override GSAP inline styles */
section#intro.page-hidden .business-card-container,
section#intro.page-hidden .business-card,
section#intro.page-hidden .intro-nav,
section.business-card-section.page-hidden .business-card-container,
section.business-card-section.page-hidden .business-card,
section.business-card-section.page-hidden .intro-nav {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* ============================================
 * VIRTUAL PAGE LAYOUT (Desktop Only)
 * ============================================ */

@media (--tablet) {
  /* Main container for virtual pages */
  main[data-virtual-pages] {
    position: fixed;
    top: var(--header-height);
    bottom: var(--footer-height);
    left: 0;
    right: 0;
    width: 100%;
    height: calc(100vh - var(--header-height) - var(--footer-height));
    height: calc(100dvh - var(--header-height) - var(--footer-height));
    overflow: hidden;
    background-color: var(--color-neutral-300); /* Solid background fill */
  }

  /* Virtual page sections - card centered, nav positioned absolutely */
  /* Projects section - left aligned like about section */
  main[data-virtual-pages] > .projects-section[data-page].page-active {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: flex-start; /* Left align like about section */
    overflow: hidden;
    box-sizing: border-box;
    padding: clamp(1rem, 4vw, 2rem);
  }

  /* Project detail section - scrollable content area */
  main[data-virtual-pages] > .project-detail-section[data-page].page-active {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    overflow-y: auto;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
    box-sizing: border-box;
  }

  /* Other virtual page sections - centered */
  main[data-virtual-pages] > section[data-page]:not(.tech-stack-section):not(.contact-section):not(.about-section):not(.business-card-section):not(.projects-section):not(.project-detail-section) {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: grid;
    place-items: center;
    overflow: hidden;
    box-sizing: border-box;
  }

  /* Business card section - needs overflow visible for nav links below card */
  main[data-virtual-pages] > .business-card-section[data-page] {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    padding: 0;
    margin: 0;
    overflow: visible;
    box-sizing: border-box;
    display: block;
  }

  /* Business card container - centered using explicit calc
   * Card height: 294.19px, so offset from center: 147.1px
   * Section height = 100% of main = viewport - header - footer */
  main[data-virtual-pages] > .business-card-section[data-page] > .business-card-container {
    position: absolute;
    /* Center: 50% of section height minus half card height */
    top: calc(50% - 147.1px);
    left: calc(50% - 262.5px);
    transform: none;
    margin: 0;
    display: block;
  }

  /* Intro nav positioned absolutely below centered card */
  main[data-virtual-pages] > .business-card-section .intro-nav {
    position: absolute;
    top: calc(50% + 294.19px / 2 + 1rem);
    left: 50%;
    transform: translateX(-50%);
    z-index: 100;
    pointer-events: auto;
  }

  /* Ensure nav links are clickable */
  main[data-virtual-pages] > .business-card-section .intro-nav-link {
    pointer-events: auto;
    cursor: pointer;
  }

  /* About section - grid centered for content */
  /* Only applies when page-active (not page-hidden) */
  main[data-virtual-pages] > .about-section[data-page].page-active {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    min-height: 100%; /* Override base section { min-height: 0 } */
    display: grid;
    place-items: center;
    overflow: hidden;
    box-sizing: border-box;
    padding: clamp(1rem, 4vw, 2rem);
    /* visibility controlled by GSAP autoAlpha */
    pointer-events: auto;
  }

  /* About content centered in viewport */
  main[data-virtual-pages] > .about-section .about-content {
    max-width: min(1000px, 90vw);
    overflow: hidden;
    align-self: center;
    justify-self: center;
  }

  /* Contact section - uses CSS Grid for proper h2/form alignment */
  main[data-virtual-pages] > .contact-section[data-page].page-active {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    min-height: 100%; /* Override base section { min-height: 0 } */
    display: grid;
    place-content: center center;
    overflow: visible;
    box-sizing: border-box;
    padding: clamp(1rem, 4vw, 2rem);
    /* visibility controlled by GSAP autoAlpha */
    pointer-events: auto;
  }

  /* Admin login section - centered grid layout */
  main[data-virtual-pages] > .admin-login-section[data-page].page-active {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    min-height: 100%;
    display: grid;
    place-content: center center;
    overflow: visible;
    box-sizing: border-box;
    padding: clamp(1rem, 4vw, 2rem);
    /* visibility controlled by GSAP autoAlpha */
    pointer-events: auto;
  }

  /* Tech stack section is mobile-only - keep hidden on desktop */
  main[data-virtual-pages] > .tech-stack-section {
    display: none;
  }

  /* Hero section with text animation - handled separately, not a virtual page */
  /* It's tied to the intro and controlled by TextAnimationModule */
  main[data-virtual-pages] > .hero-section {
    display: none;
  }


  /* Page content wrapper for animations */
  section[data-page] > * {
    will-change: transform, opacity, filter;
  }

  /* Disable scroll on body when virtual pages active */
  body.virtual-pages-active {
    overflow: hidden;
  }
}

/* ============================================
 * TRANSITION STATES (Blur effect)
 * GSAP handles all animations - these are fallback states
 * ============================================ */

/* Entering page state */
.page-entering {
  opacity: 0;
  filter: blur(var(--page-blur-amount));
}

/* Leaving page state */
.page-leaving {
  opacity: 0;
  filter: blur(var(--page-blur-amount));
}

/* ============================================
 * DEFENSIVE PAGE VISIBILITY RULES
 * Ensures no page overlap during transitions
 * ============================================ */

/* Project detail should always be above intro when active */
section.project-detail-section.page-active {
  z-index: 150; /* Higher than intro's z-index of 50 */
}

/* Reinforce page-hidden state on all sections to prevent overlap */
section[data-page].page-hidden {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  z-index: -1 !important;
  pointer-events: none !important;
}

/* ============================================
 * REDUCED MOTION
 * ============================================ */

@media (prefers-reduced-motion: reduce) {
  :root {
    --page-transition-duration: 0s;
    --page-blur-amount: 0;
  }

  .page-entering,
  .page-leaving {
    transition: none !important;
    animation: none !important;
  }
}

