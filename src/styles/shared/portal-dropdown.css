/**
 * ===============================================
 * PORTAL DROPDOWN COMPONENT
 * ===============================================
 * @file src/styles/shared/portal-dropdown.css
 *
 * Reusable custom dropdown component for forms and modals.
 * Based on Messages dropdown pattern (seamless trigger + menu)
 *
 * Override these CSS custom properties in context:
 *   --dropdown-bg: background color for trigger and menu
 *   --dropdown-border-color: border color when closed (match bg for invisible)
 *   --dropdown-border-width: border width (default 1px)
 *   --dropdown-radius: border radius (default var(--border-radius-sm))
 */

/* ================================================
   Modal/Form Dropdown Component
   ================================================
   Pattern (matches Messages dropdown):
   - Same background on trigger and menu
   - Trigger: border-bottom: none when open
   - Menu: margin-top negative to overlap
   - No visible seam between trigger and menu
   ================================================ */

/* Dropdown wrapper - just positioning */
.custom-dropdown[data-modal-dropdown] {
  position: relative;
  width: 100%;
  background: transparent;
  border: none;
  border-radius: 0;

  /* Default values - override in context */
  --dropdown-bg: var(--color-black);
  --dropdown-border-color: var(--portal-border-dark);
  --dropdown-border-width: 1px;
  --dropdown-radius: var(--portal-radius-lg);
}

/* Dropdown trigger button - CLOSED state; left padding matches menu so text aligns */
.custom-dropdown[data-modal-dropdown] .custom-dropdown-trigger {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-3) var(--space-4);
  padding-right: var(--space-2); /* Half of space-4 so less gap to right of caret */
  background-color: var(--dropdown-bg);
  border: var(--dropdown-border-width) solid var(--dropdown-border-color);
  border-radius: var(--dropdown-radius);
  font-size: var(--font-size-base);
  font-weight: 400;
  color: var(--portal-text-light);
  cursor: pointer;
  text-align: left;
  box-shadow: none;
  box-sizing: border-box;
}

.custom-dropdown[data-modal-dropdown] .custom-dropdown-trigger:focus {
  outline: none;
}

.custom-dropdown[data-modal-dropdown] .custom-dropdown-trigger:hover {
  border-color: var(--color-primary);
}

/* Trigger - OPEN state */
.custom-dropdown[data-modal-dropdown].open .custom-dropdown-trigger {
  border-color: var(--color-primary);
  border-bottom: none;
  border-radius: var(--dropdown-radius) var(--dropdown-radius) 0 0;
  z-index: var(--z-index-portal-dropdown);
  position: relative;
  background-color: var(--dropdown-bg);
}

/* Trigger text - left align so it lines up with menu item labels */
.custom-dropdown[data-modal-dropdown] .custom-dropdown-text {
  flex: 1;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  text-align: left;
}

/* Caret icon */
.custom-dropdown[data-modal-dropdown] .custom-dropdown-caret {
  width: 12px;
  height: 12px;
  flex-shrink: 0;
  color: var(--portal-text-muted);
  transition: transform 0.15s ease;
  margin-left: var(--space-2);
}

.custom-dropdown[data-modal-dropdown].open .custom-dropdown-caret {
  transform: rotate(180deg);
}

/* Dropdown menu - connects seamlessly to trigger */
.custom-dropdown[data-modal-dropdown] .custom-dropdown-menu {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  width: 100%;
  max-height: 200px;
  overflow-y: auto;
  background-color: var(--dropdown-bg);
  border: var(--dropdown-border-width) solid var(--color-primary);
  border-top: none;
  border-radius: 0 0 var(--dropdown-radius) var(--dropdown-radius);
  z-index: var(--z-index-portal-dropdown);
  list-style: none;
  margin: 0;
  margin-top: calc(var(--dropdown-border-width) * -1);
  padding: 0;
  box-shadow: none;
  box-sizing: border-box;
}

.custom-dropdown[data-modal-dropdown].open .custom-dropdown-menu {
  display: block;
}

/* Dropdown items - align text with trigger (same left padding so labels line up) */
.custom-dropdown[data-modal-dropdown] .custom-dropdown-item {
  display: flex;
  justify-content: flex-start;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-3) var(--space-4);
  font-size: var(--font-size-base);
  color: var(--portal-text-light);
  cursor: pointer;
  transition: background-color 0.1s ease;
  text-align: left;
}

.custom-dropdown[data-modal-dropdown] .custom-dropdown-item:hover {
  background-color: var(--color-primary);
}

/* Item name text */
.custom-dropdown[data-modal-dropdown] .dropdown-item-name {
  display: block;
}

/* ================================================
   Scrollbar Styling for Dropdown Menu
   ================================================ */

.custom-dropdown[data-modal-dropdown] .custom-dropdown-menu::-webkit-scrollbar {
  width: 6px;
}

.custom-dropdown[data-modal-dropdown] .custom-dropdown-menu::-webkit-scrollbar-track {
  background: var(--dropdown-bg);
  border-radius: 3px;
}

.custom-dropdown[data-modal-dropdown] .custom-dropdown-menu::-webkit-scrollbar-thumb {
  background: var(--portal-border-medium);
  border-radius: 3px;
}

.custom-dropdown[data-modal-dropdown] .custom-dropdown-menu::-webkit-scrollbar-thumb:hover {
  background: var(--portal-text-muted);
}

/* ================================================
   Fixed Positioning Mode (escapes modal overflow)
   ================================================
   When JS applies position: fixed, the menu escapes
   modal overflow constraints. These styles handle
   the flip-above variant when menu appears above trigger.
   ================================================ */

/* When flipped above, adjust trigger border radius */
.custom-dropdown[data-modal-dropdown].flip-above.open .custom-dropdown-trigger {
  border-radius: 0 0 var(--dropdown-radius) var(--dropdown-radius);
  border-bottom: var(--dropdown-border-width) solid var(--color-primary);
  border-top: none;
}

/* When flipped above, adjust menu border radius */
.custom-dropdown[data-modal-dropdown].flip-above .custom-dropdown-menu {
  border-radius: var(--dropdown-radius) var(--dropdown-radius) 0 0;
  border-bottom: none;
  border-top: var(--dropdown-border-width) solid var(--color-primary);
}

/* ================================================
   Table dropdown (reusable in tables)
   ================================================
   Status dropdowns, pagination "Per page", etc.
   Single source of truth: compact padding so caret
   sits close to right edge; no overrides needed.
   ================================================ */

:is([data-page="admin"], [data-page="client-portal"]) .table-dropdown {
  position: relative;
  width: fit-content;
  min-width: 100px;
}

:is([data-page="admin"], [data-page="client-portal"]) .table-dropdown .custom-dropdown-trigger {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  min-width: 0;
  padding: var(--space-2) var(--space-3);
  padding-right: var(--space-1-5); /* Half of space-3 so less gap to right of caret */
  border-radius: var(--portal-radius-lg);
  box-sizing: border-box;
  text-align: left;
}

/* Status dropdowns: same padding between status dot and left edge as between caret and right edge (space-1-5) */
:is([data-page="admin"], [data-page="client-portal"]) .table-dropdown .custom-dropdown-trigger:has(.status-dot) {
  padding-left: var(--space-1-5);
}

/* Table dropdown trigger: suppress global outline; focus ring is border + box-shadow in admin.css */
:is([data-page="admin"], [data-page="client-portal"]) .table-dropdown .custom-dropdown-trigger:focus,
:is([data-page="admin"], [data-page="client-portal"]) .table-dropdown .custom-dropdown-trigger:focus-visible {
  outline: none !important;
  outline-offset: 0 !important;
}

:is([data-page="admin"], [data-page="client-portal"]) .table-dropdown .custom-dropdown-text {
  flex: 1;
  min-width: 0;
  text-align: left;
}

:is([data-page="admin"], [data-page="client-portal"]) .table-dropdown .custom-dropdown-menu {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  right: auto;
  min-width: 100%; /* Match trigger width at minimum */
  max-height: 300px;
  overflow-y: auto;
  background-color: var(--dropdown-bg, var(--color-surface-primary));
  border: 1px solid var(--portal-border);
  border-radius: var(--portal-radius-md);
  z-index: var(--z-index-portal-dropdown);
  list-style: none;
  margin: 4px 0 0 0;
  padding: var(--space-1) 0;
  box-shadow: var(--shadow-md);
  text-align: left;
}

:is([data-page="admin"], [data-page="client-portal"]) .table-dropdown.open .custom-dropdown-menu {
  display: block;
}

:is([data-page="admin"], [data-page="client-portal"]) .table-dropdown .custom-dropdown-menu .custom-dropdown-item {
  display: flex;
  align-items: center;
  gap: var(--space-1-5); /* Tighter gap to match trigger */
  padding: var(--space-2) var(--space-2);
  padding-left: var(--space-1-5); /* Match trigger left padding so status dots align */
  font-size: var(--font-size-sm);
  color: var(--color-text-primary);
  cursor: pointer;
  transition: background-color 0.1s ease;
  text-align: left;
  justify-content: flex-start;
}

:is([data-page="admin"], [data-page="client-portal"]) .table-dropdown .custom-dropdown-menu .custom-dropdown-item:hover {
  background-color: var(--color-state-hover);
}

:is([data-page="admin"], [data-page="client-portal"]) .table-dropdown .custom-dropdown-menu .custom-dropdown-item svg {
  width: 16px;
  height: 16px;
  flex-shrink: 0;
}
